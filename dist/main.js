!function(t){var e={};function i(n){if(e[n])return e[n].exports;var s=e[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(n,s,function(e){return t[e]}.bind(null,s));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=14)}([function(t,e,i){t.exports=i.p+"background-62637a7f.jpg"},function(t,e,i){t.exports=i.p+"assets-91d3235f.png"},function(t,e,i){t.exports=i.p+"assets-bb278b62.json"},function(t,e,i){t.exports=i.p+"background-a19d0544.mp3"},function(t,e,i){t.exports=i.p+"kill-1da4ec2f.mp3"},function(t,e,i){t.exports=i.p+"select-1-45650db9.mp3"},function(t,e,i){t.exports=i.p+"select-2-57c36c77.mp3"},function(t,e,i){t.exports=i.p+"select-3-51bcf21a.mp3"},function(t,e,i){t.exports=i.p+"select-4-41cade2f.mp3"},function(t,e,i){t.exports=i.p+"select-5-8d20de55.mp3"},function(t,e,i){t.exports=i.p+"select-6-3db3d428.mp3"},function(t,e,i){t.exports=i.p+"select-7-5fb67905.mp3"},function(t,e,i){t.exports=i.p+"select-8-c9d087cc.mp3"},function(t,e,i){t.exports=i.p+"select-9-1b64e2db.mp3"},function(t,e,i){"use strict";function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t,e,i){return(s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,i){var n=[null];n.push.apply(n,e);var s=new(Function.bind.apply(t,n));return i&&u(s,i.prototype),s}).apply(null,arguments)}function r(t,e,i){return(r="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=h(t)););return t}(t,e);if(n){var s=Object.getOwnPropertyDescriptor(n,e);return s.get?s.get.call(i):s.value}})(t,e,i||t)}function a(t,e){return!e||"object"!==n(e)&&"function"!=typeof e?o(t):e}function o(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function h(t){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function l(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&u(t,e)}function u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function c(t){return function(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function m(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function d(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function f(t,e,i){return e&&d(t.prototype,e),i&&d(t,i),t}i.r(e);var y=function(){function t(){m(this,t),t.assert(!1,"Static class.")}return f(t,null,[{key:"isNumber",value:function(){for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];i.forEach(function(e){if("number"!=typeof e||!1!==isNaN(parseFloat(e))||!0!==isFinite(e)){if(t.logOnFail&&console.error("[ASSERT]","Not a number."),t.throwOnFail)throw new Error("Not a number.")}})}},{key:"assert",value:function(e,i){if(!0!==e&&(i=null==i?"Assertion failed.":i,t.logOnFail&&console.error("[ASSERT]",i),t.throwOnFail))throw new Error(i)}},{key:"assertWarn",value:function(e,i){!0!==e&&(i=null==i?"Assertion warning.":i,t.warn(i))}},{key:"assertInfo",value:function(e,i){!0!==e&&(i=null==i?"Assertion info.":i,t.info(i))}},{key:"log",value:function(){for(var t,e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];(t=console).info.apply(t,["%c%s","color: #000000","LOG:"].concat(i))}},{key:"info",value:function(){for(var t,e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];(t=console).info.apply(t,["%c%s","color: #003bd2","INFO:"].concat(i))}},{key:"warn",value:function(){for(var t,e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];(t=console).info.apply(t,["%c%s","color: #f67400","WARN:"].concat(i))}},{key:"error",value:function(){for(var t,e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];(t=console).info.apply(t,["%c%s","color: #d50000","ERROR:"].concat(i))}},{key:"time",value:function(e){t.timeProfiles[e]=performance.now()}},{key:"timeEnd",value:function(e){t.timeProfiles[e]=performance.now()-t.timeProfiles[e]}}]),t}();y.throwOnFail=!0,y.logOnFail=!1,y.timeProfiles={};var v=function(){function t(){m(this,t)}return f(t,null,[{key:"randomBetween",value:function(t,e){return Math.floor(Math.random()*(e-t+1)+t)}},{key:"clamp",value:function(t,e,i){return t<e?e:t>i?i:t}},{key:"distance",value:function(t,e,i,n){var s=t-i,r=e-n;return Math.sqrt(s*s+r*r)}},{key:"distanceSqr",value:function(t,e,i,n){var s=t-i,r=e-n;return s*s+r*r}},{key:"angleBetween",value:function(t,e,i,n){return Math.atan2(n-e,i-t)}},{key:"mapRange",value:function(t,e,i,n,s){return n+(s-n)*(t-e)/(i-e)}},{key:"lerp",value:function(t,e,i){return t+i*(e-t)}},{key:"equals",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.EPSILON;return t-i<e&&t+i>e}}]),t}();v.PI_Q=Math.PI/4,v.PI2=2*Math.PI,v.DEG2RAD=.017453292519943295,v.RAD2DEG=57.29577951308232,(function(){function t(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];m(this,t),this.mRepeat=0,this.mPerm=[];for(var e=0;e<512;e++)this.mPerm.push(t.__permutation[e%256])}return f(t,[{key:"__perlin",value:function(t,e,i){this.mRepeat>0&&(t%=this.mRepeat,e%=this.mRepeat,i%=this.mRepeat);var n=this.mPerm,s=255&~~t,r=255&~~e,a=255&~~i,o=t-~~t,h=e-~~e,l=i-~~i,u=o*o*o*(o*(6*o-15)+10),c=h*h*h*(h*(6*h-15)+10),m=l*l*l*(l*(6*l-15)+10),d=n[n[n[s]+r]+a],f=n[n[n[s]+this.inc(r)]+a],y=n[n[n[s]+r]+this.inc(a)],v=n[n[n[s]+this.inc(r)]+this.inc(a)],p=n[n[n[this.inc(s)]+r]+a],g=n[n[n[this.inc(s)]+this.inc(r)]+a],k=n[n[n[this.inc(s)]+r]+this.inc(a)],b=n[n[n[this.inc(s)]+this.inc(r)]+this.inc(a)],w=this.lerp(this.grad(d,o,h,l),this.grad(p,o-1,h,l),u),_=this.lerp(this.grad(f,o,h-1,l),this.grad(g,o-1,h-1,l),u),x=this.lerp(w,_,c);w=this.lerp(this.grad(y,o,h,l-1),this.grad(k,o-1,h,l-1),u),_=this.lerp(this.grad(v,o,h-1,l-1),this.grad(b,o-1,h-1,l-1),u);var C=this.lerp(w,_,c);return.5*(this.lerp(x,C,m)+1)}},{key:"perlin",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;if(1===n&&1===s)return this.__perlin(t,e,i);for(var r=0,a=1,o=1,h=0,l=0;l<n;l++)r+=this.__perlin(t*a,e*a,i*a)*o,h+=o,o*=s,a*=2;return r/h}},{key:"inc",value:function(t){return t++,this.mRepeat>0&&(t%=this.mRepeat),t}},{key:"grad",value:function(t,e,i,n){switch(15&t){case 0:return e+i;case 1:return-e+i;case 2:return e-i;case 3:return-e-i;case 4:return e+n;case 5:return-e+n;case 6:return e-n;case 7:return-e-n;case 8:return i+n;case 9:return-i+n;case 10:return i-n;case 11:return-i-n;case 12:return i+e;case 13:return-i+n;case 14:return i-e;case 15:return-i-n}}},{key:"lerp",value:function(t,e,i){return t+i*(e-t)}}]),t}()).__permutation=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180];var p=function(){function t(){m(this,t),this.mMap=new Map}return f(t,[{key:"has",value:function(t,e){return this.mMap.has(t)&&this.mMap.get(t).has(e)}},{key:"set",value:function(t,e,i){var n=this.mMap.get(t);null==n&&(n=new Map,this.mMap.set(t,n)),n.set(e,i)}},{key:"get",value:function(t,e){return null!=this.mMap.get(t)?this.mMap.get(t)&&this.mMap.get(t).get(e):null}}]),t}(),g=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;m(this,t),this.mReleased=[],this.mCapacity=i,this.mType=e}return f(t,[{key:"releaseAll",value:function(){this.mReleased.splice(0,this.mReleased.length)}},{key:"get",value:function(){return this.mReleased.length>0?this.mReleased.pop():new this.mType}},{key:"release",value:function(t){(-1===this.mCapacity||this.mReleased.length<this.mCapacity)&&this.mReleased.push(t)}},{key:"capacity",get:function(){return this.mCapacity},set:function(t){y.assert(0!==t,"Capacity cannot be equal to zero."),y.assert(t>-1,"Capacity cannot be smaller then -1."),this.mCapacity=t,this.mCapacity>this.mReleased.length&&this.mReleased.splice(0,this.mReleased.length-this.mCapacity)}}]),t}(),k=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;m(this,t),this.r=e,this.g=i,this.b=n},b=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;m(this,t),this.h=e,this.s=i,this.v=n},w=function(){function t(){m(this,t)}return f(t,null,[{key:"hex2rgb",value:function(t){return new k(t>>16&255,t>>8&255,255&t)}},{key:"rgb2hex",value:function(t){return t.r<<16|t.g<<8|t.b}},{key:"hsv2rgb",value:function(t){var e=t.h,i=t.s,n=t.v,s=0,r=0,a=0,o=Math.floor(6*e),h=6*e-o,l=n*(1-i),u=n*(1-h*i),c=n*(1-(1-h)*i);switch(o%6){case 0:s=n,r=c,a=l;break;case 1:s=u,r=n,a=l;break;case 2:s=l,r=n,a=c;break;case 3:s=l,r=u,a=n;break;case 4:s=c,r=l,a=n;break;case 5:s=n,r=l,a=u}return new k(s*=255,r*=255,a*=255)}},{key:"rgb2hsv",value:function(t){var e=t.r,i=t.g,n=t.b;e/=255,i/=255,n/=255;var s,r=Math.max(e,i,n),a=Math.min(e,i,n),o=0,h=r,l=r-a;if(s=0===r?0:l/r,r===a)o=0;else{switch(r){case e:o=(i-n)/l+(i<n?6:0);break;case i:o=(n-e)/l+2;break;case n:o=(e-i)/l+4}o/=6}return new b(o,s,h)}},{key:"lerpHSV",value:function(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5,s=t.rgb2hsv(t.hex2rgb(e)),r=t.rgb2hsv(t.hex2rgb(i)),a=0,o=r.h-s.h;if(s.h>r.h){var h=r.h;r.h=s.h,s.h=h,o=-o,n=1-n}o>.5&&(s.h=s.h+1,a=(s.h+n*(r.h-s.h))%1),o<=.5&&(a=s.h+n*o);var l=s.s+n*(r.s-s.s),u=s.v+n*(r.v-s.v);return t.rgb2hex(t.hsv2rgb(new b(a,l,u)))}},{key:"hexColorToString",value:function(t){var e=t.toString(16);return"#000000".substring(0,7-e.length)+e}},{key:"intToRGBA",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=t>>8&255,n=255&t;return"rgba(".concat(t>>16&255,", ").concat(i,", ").concat(n,", ").concat(e,")")}}]),t}(),_=function(){function t(e){m(this,t),this.mRegExp=new RegExp("^".concat(e.replace(/\./g,"\\.").replace(/\*\*$/g,".+").replace(/(?:\*\*\/|\*\*|\*)/g,function(e){return t.mPatterns[e]}),"$"))}return f(t,[{key:"test",value:function(t){return this.mRegExp.test(t)}}]),t}();_.mPatterns={"*":"[^/]+","**":".+/?[^/]+","**/":".+/?"};var x=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;m(this,t),y.isNumber(e,i),this.x=e,this.y=i}return f(t,[{key:"set",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return y.isNumber(t,e),this.x=t,this.y=e,this}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this}},{key:"subtract",value:function(t){return this.x-=t.x,this.y-=t.y,this}},{key:"distance",value:function(t){var e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)}},{key:"distanceSqr",value:function(t){var e=this.x-t.x,i=this.y-t.y;return e*e+i*i}},{key:"multiply",value:function(t){return this.x*=t.x,this.y*=t.y,this}},{key:"multiplyScalar",value:function(t){return y.isNumber(t),this.x*=t,this.y*=t,this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"lengthSqr",value:function(){return this.x*this.x+this.y*this.y}},{key:"normalize",value:function(){var t=this.lengthSqr();return t>0?(t=Math.sqrt(t),this.x/=t,this.y/=t):(this.x=0,this.y=0),this}},{key:"clamp",value:function(t,e){return y.isNumber(t,e),this.x=v.clamp(this.x,t,e),this.y=v.clamp(this.y,t,e),this}},{key:"clampLength",value:function(t,e){y.isNumber(t,e);var i=v.clamp(this.length(),t,e);return this.normalize(),this.multiplyScalar(i),this}},{key:"lerp",value:function(t,e){return y.isNumber(e),this.x=v.lerp(this.x,t.x,e),this.y=v.lerp(this.y,t.y,e),this}},{key:"copyTo",value:function(t){return t.x=this.x,t.y=this.y,t}},{key:"copyFrom",value:function(t){return this.x=t.x,this.y=t.y,this}},{key:"clone",value:function(){return new t(this.x,this.y)}},{key:"equals",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.EPSILON;return null!==t&&Math.abs(t.x-this.x)<e&&Math.abs(t.y-this.y)<e}},{key:"isEmpty",value:function(){return 0===this.x&&0===this.y}},{key:"setRotationFrom",value:function(t,e){return y.isNumber(e),this.subtract(t).setRotation(e).add(t)}},{key:"setRotation",value:function(t){y.isNumber(t);var e=Math.cos(t),i=Math.sin(t);return this.set(this.x*e-this.y*i,this.x*i+this.y*e)}},{key:"angleBetween",value:function(t){return Math.atan2(t.y-this.y,t.x-this.x)}},{key:"angle",value:function(){return Math.atan2(this.y,this.x)}},{key:"perp",value:function(){return this.set(this.y,-this.x)}},{key:"toString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;return"Vector: { x: ".concat(this.x.toFixed(t),", y: ").concat(this.y.toFixed(t)," }")}}],[{key:"fromAngle",value:function(e,i){return y.isNumber(e),(i=i||new t).set(Math.cos(e),Math.sin(e))}},{key:"randomRange",value:function(e,i,n){return(n=n||new t).x=Math.random()*(i.x-e.x)+e.x,n.y=Math.random()*(i.y-e.y)+e.y,n}}]),t}();x.__cache=new x,x.pool=new g(x);var C=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;m(this,t),this.data=new Float32Array(6),this.set(e,i,n,s,r,a)}return f(t,[{key:"set",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;y.isNumber(t,e,i,n,s,r);var a=this.data;return a[0]=t,a[1]=e,a[2]=i,a[3]=n,a[4]=s,a[5]=r,this}},{key:"translate",value:function(t,e){y.isNumber(t,e);var i=this.data,n=i[0],s=i[1],r=i[2],a=i[3],o=i[4],h=i[5];return this.data[4]=n*t+r*e+o,this.data[5]=s*t+a*e+h,this}},{key:"setTranslation",value:function(t,e){return y.isNumber(t,e),this.data[4]=t,this.data[5]=e,this}},{key:"setRotation",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;y.isNumber(t,e);var i=this.data;return i[0]=Math.cos(t)*e,i[2]=Math.sin(t)*e,i[1]=-i[2],i[3]=i[0],this}},{key:"rotate",value:function(t){y.isNumber(t);var e=this.data,i=Math.cos(t),n=Math.sin(t),s=e[0],r=e[2],a=e[4];return e[0]=s*i-e[1]*n,e[1]=s*n+e[1]*i,e[2]=r*i-e[3]*n,e[3]=r*n+e[3]*i,e[4]=a*i-e[5]*n,e[5]=a*n+e[5]*i,this}},{key:"scale",value:function(t,e){y.isNumber(t,e);var i=this.data,n=i[0],s=i[1],r=i[2],a=i[3];i[4],i[5];return this.data[0]=n*t,this.data[1]=s*t,this.data[2]=r*e,this.data[3]=a*e,this}},{key:"skew",value:function(t,e){var i=Math.sin(t),n=Math.cos(t),s=Math.sin(e),r=Math.cos(e),a=this.data;this.set(a[0]*r-a[1]*i,a[0]*s+a[1]*n,a[2]*r-a[3]*i,a[2]*s+a[3]*n,a[4]*r-a[5]*i,a[4]*s+a[5]*n)}},{key:"identity",value:function(){return this.set(1,0,0,1,0,0)}},{key:"prepend",value:function(t){var e=this.data,i=t.data,n=e[0],s=e[1],r=e[2],a=e[3],o=e[4],h=e[5],l=i[0],u=i[1],c=i[2],m=i[3],d=i[4],f=i[5];if(1!==l||0!==u||0!==c||1!==m){var y=n*l+s*c;e[1]=n*u+s*m,e[0]=y;var v=r*l+a*c;e[3]=r*u+a*m,e[2]=v}var p=o*l+h*c+d;return e[5]=o*u+h*m+f,e[4]=p,this}},{key:"append",value:function(t){var e=this.data,i=t.data,n=e[0],s=e[1],r=e[2],a=e[3],o=e[4],h=e[5],l=i[0],u=i[1],c=i[2],m=i[3],d=i[4],f=i[5];return e[0]=n*l+r*u,e[1]=s*l+a*u,e[2]=n*c+r*m,e[3]=s*c+a*m,e[4]=n*d+r*f+o,e[5]=s*d+a*f+h,this}},{key:"transformXY",value:function(t,e,i){y.isNumber(t,e),i=i||new x;var n=this.data;return i.x=n[0]*t+n[2]*e+n[4],i.y=n[1]*t+n[3]*e+n[5],i}},{key:"transformDirectionXY",value:function(t,e,i){y.isNumber(t,e);var n=this.data;return(i=i||new x).x=n[0]*t+n[2]*e,i.y=n[1]*t+n[3]*e,i}},{key:"transformVector",value:function(t,e){e=e||new x;var i=this.data;return e.x=i[0]*t.x+i[2]*t.y+i[4],e.y=i[1]*t.x+i[3]*t.y+i[5],e}},{key:"transformRect",value:function(t,e){e=e||new S;for(var i=Number.MAX_VALUE,n=-Number.MAX_VALUE,s=Number.MAX_VALUE,r=-Number.MAX_VALUE,a=this.data,o=x.pool.get(),h=[t.x,t.y,t.x+t.width,t.y,t.x,t.y+t.height,t.x+t.width,t.y+t.height],l=0;l<h.length;l+=2)o.x=a[0]*h[l]+a[2]*h[l+1]+a[4],o.y=a[1]*h[l]+a[3]*h[l+1]+a[5],i>o.x&&(i=o.x),n<o.x&&(n=o.x),s>o.y&&(s=o.y),r<o.y&&(r=o.y);return x.pool.release(o),e.set(i,s,n-i,r-s)}},{key:"invert",value:function(){var t=this.data,e=t[0],i=t[1],n=t[2],s=t[3],r=t[4],a=t[5],o=e*s-i*n;return 0===o?(t[0]=t[1]=t[2]=t[3]=0,t[4]=-r,t[5]=-a,this):(o=1/o,t[0]=s*o,t[1]=-i*o,t[2]=-n*o,t[3]=e*o,t[4]=(n*a-s*r)*o,t[5]=(i*r-e*a)*o,this)}},{key:"__decompose",value:function(){var t=this.data,e=t[0],i=t[1],n=t[2],s=t[3],r=t[4],a=t[5],o=-Math.atan2(-n,s),h=Math.atan2(i,e),l=0,u=0,c=0;return Math.abs(o+h)<1e-5?(l=h,e<0&&s>=0&&(l+=l<=0?Math.PI:-Math.PI)):(u=o,c=h),[r,a,l,Math.sqrt(e*e+i*i),Math.sqrt(n*n+s*s),u,c]}},{key:"clone",value:function(){var e=new t,i=this.data;return e.set(i[0],i[1],i[2],i[3],i[4],i[5]),e}},{key:"copyTo",value:function(t){var e=this.data,i=t.data;return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],t}},{key:"copyFrom",value:function(t){return t.copyTo(this)}},{key:"exactEquals",value:function(t){if(!t)return!1;var e=this.data,i=t.data;return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]&&e[4]===i[4]&&e[5]===i[5]}},{key:"equals",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.EPSILON;if(!t)return!1;var i=this.data,n=t.data;return Math.abs(i[0]-n[0])<e&&Math.abs(i[1]-n[1])<e&&Math.abs(i[2]-n[2])<e&&Math.abs(i[3]-n[3])<e&&Math.abs(i[4]-n[4])<e&&Math.abs(i[5]-n[5])<e}},{key:"toString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;return"        | ".concat(this.value[0].toFixed(t)," | ").concat(this.value[1].toFixed(t)," | ").concat(this.value[4].toFixed(t)," |\nMatrix: | ").concat(this.value[2].toFixed(t)," | ").concat(this.value[3].toFixed(t)," | ").concat(this.value[5].toFixed(t)," |")}},{key:"isIdentity",get:function(){return this.exactEquals(t.__identity)}},{key:"value",get:function(){return this.data}}]),t}();C.__cache=new C,C.__identity=new C,C.pool=new g(C);var S=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;m(this,t),y.isNumber(e,i,n,s),this.x=e,this.y=i,this.width=n,this.height=s}return f(t,[{key:"set",value:function(t,e,i,n){return y.isNumber(t,e,i,n),this.x=t,this.y=e,this.width=i,this.height=n,this}},{key:"copyFrom",value:function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}},{key:"copyTo",value:function(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}},{key:"size",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;return(t=t||new x).set(this.width,this.height)}},{key:"zero",value:function(){return this.set(0,0,0,0)}},{key:"equals",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.EPSILON;return null!==t&&Math.abs(this.x-t.x)<e&&Math.abs(this.y-t.y)<e&&Math.abs(this.width-t.width)<e&&Math.abs(this.height-t.height)<e}},{key:"containsXY",value:function(t,e){return t>=this.x&&t<=this.right&&e>=this.y&&e<=this.bottom}},{key:"contains",value:function(t){return t.x>=this.x&&t.y>=this.y&&t.right<=this.right&&t.bottom<=this.bottom}},{key:"intersects",value:function(t){return t.right>this.x&&t.bottom>this.y&&t.x<this.right&&t.y<this.bottom}},{key:"intersection",value:function(e,i){i=i||new t;var n=this.x<e.x?e.x:this.x,s=this.right>e.right?e.right:this.right;if(s<=n)return new t;var r=this.y<e.y?e.y:this.y,a=this.bottom>e.bottom?e.bottom:this.bottom;return a<=r?new t:(i.set(n,r,s-n,a-r),i)}},{key:"union",value:function(t){var e=this.x>t.x?t.x:this.x,i=this.right<t.right?t.right:this.right,n=this.y>t.y?t.y:this.y,s=this.bottom<t.bottom?t.bottom:this.bottom;return this.set(e,n,i-e,s-n)}},{key:"expand",value:function(t,e,i,n){if(y.isNumber(t,e,i,n),0===this.volume)return this.set(t,e,i,n);var s=this.right,r=this.bottom;return this.x>t&&(this.x=t,this.width=s-t),this.y>e&&(this.y=e,this.height=r-e),s<t+i&&(this.width=t+i-this.x),r<e+n&&(this.height=e+n-this.y),this}},{key:"expandXY",value:function(t,e){return t<this.x&&(this.width+=this.x-t,this.x=t),e<this.y&&(this.height+=this.y-e,this.y=e),t>this.x+this.width&&(this.width=t-this.x),e>this.y+this.height&&(this.height=e-this.y),this}},{key:"inflate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return y.isNumber(t,e),this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e,this}},{key:"clone",value:function(){return new t(this.x,this.y,this.width,this.height)}},{key:"center",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;return(t=t||new x).set(this.x+.5*this.width,this.y+.5*this.height)}},{key:"scale",value:function(t,e){return this.width*=t,this.height*=e,this}},{key:"toString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;return"Rectangle { x: ".concat(this.x.toFixed(t),", y: ").concat(this.y.toFixed(t),", width: ").concat(this.width.toFixed(t),", height: ").concat(this.height.toFixed(t)," }")}},{key:"left",get:function(){return this.x},set:function(t){y.isNumber(t),this.x=t}},{key:"right",get:function(){return this.x+this.width},set:function(t){y.isNumber(t),this.x=t-this.width}},{key:"top",get:function(){return this.y},set:function(t){y.isNumber(t),this.y=t}},{key:"bottom",get:function(){return this.y+this.height},set:function(t){y.isNumber(t),this.y=t-this.height}},{key:"topLeft",get:function(){return new x(this.x,this.y)},set:function(t){this.left=t.x,this.top=t.y}},{key:"topRight",get:function(){return new x(this.right,this.y)},set:function(t){this.right=t.x,this.top=t.y}},{key:"bottomRight",get:function(){return new x(this.right,this.bottom)},set:function(t){this.right=t.x,this.bottom=t.y}},{key:"bottomLeft",get:function(){return new x(this.x,this.bottom)},set:function(t){this.x=t.x,this.bottom=t.y}},{key:"volume",get:function(){return this.width*this.height}},{key:"perimeter",get:function(){return 2*(this.width+this.height)}},{key:"isEmpty",get:function(){return this.width<=0||this.height<=0}},{key:"lines",get:function(){return[new P(this.topLeft,this.topRight),new P(this.topRight,this.bottomRight),new P(this.bottomRight,this.bottomLeft),new P(this.bottomLeft,this.topLeft)]}}],[{key:"fromPoints",value:function(e){var i=new t;if(0===e.length)return i;for(var n=e.length,s=e[0].x,r=e[0].y,a=e[0].x,o=e[0].y,h=1;h<n;h++){var l=e[h],u=l.x,c=l.y;s=Math.min(u,s),a=Math.max(u,a),r=Math.min(c,r),o=Math.max(c,o)}return i.x=s,i.y=r,i.width=a-s,i.height=o-r,i}},{key:"fromPointsXY",value:function(e){var i=new t;if(e.length<2)return i;for(var n=e.length,s=e[0],r=e[1],a=e[0],o=e[1],h=2;h<n;h+=2){var l=e[h],u=e[h+1];s=Math.min(l,s),a=Math.max(l,a),r=Math.min(u,r),o=Math.max(u,o)}return i.x=s,i.y=r,i.width=a-s,i.height=o-r,i}}]),t}();S.__cache=new S,S.pool=new g(S);var T=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;m(this,t),this.x=e,this.y=i,this.r=n}return f(t,[{key:"set",value:function(t,e,i){return this.x=t,this.y=e,this.r=i,this}},{key:"clone",value:function(){return new t(this.x,this.y,this.r)}},{key:"copyTo",value:function(t){return t.set(this.x,this.y,this.r)}},{key:"copyFrom",value:function(t){return this.set(t.x,t.y,t.r)}},{key:"equals",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.EPSILON;return null!==t&&Math.abs(this.x-t.x)<e&&Math.abs(this.y-t.y)<e&&Math.abs(this.r-t.r)<e}},{key:"containsXY",value:function(t,e){return this.contains(new x(t,e))}},{key:"contains",value:function(t){return new x(this.x,this.y).subtract(t).length()<=this.r}},{key:"zero",value:function(){return this.set(0,0,0)}},{key:"intersects",value:function(t){var e=new x(this.x,this.y).distance(new x(t.x,t.y));return e<=this.r+t.r&&e>=this.r-t.r}},{key:"collide",value:function(t){return new x(this.x,this.y).distance(new x(t.x,t.y))<=this.r+t.r}},{key:"overlap",value:function(t){return!(this.r<t.r)&&new x(this.x,this.y).distance(new x(t.x,t.y))<=this.r-t.r}},{key:"center",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;return(t=t||new x).set(this.x,this.y)}},{key:"toString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;return"Circle { x: ".concat(this.x.toFixed(t),", y: ").concat(this.y.toFixed(t),", r: ").concat(this.r.toFixed(t)," }")}},{key:"volume",get:function(){return Math.PI*this.r*this.r}},{key:"perimeter",get:function(){return 2*Math.PI*this.r}},{key:"left",get:function(){return this.x-this.r}},{key:"right",get:function(){return this.x+this.r}},{key:"top",get:function(){return this.y-this.r}},{key:"bottom",get:function(){return this.y+this.r}},{key:"topPoint",get:function(){return new x(this.x,this.top)}},{key:"bottomPoint",get:function(){return new x(this.x,this.bottom)}}],[{key:"getCircumferencePoint",value:function(t,e,i,n){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;return(s=s||new x).set(t+i*Math.sin(n),e+i*-Math.cos(n)),s}}]),t}();T.__cache=new T;var P=function(){function t(e,i){m(this,t),this.start=e,this.end=i}return f(t,[{key:"set",value:function(t,e){return this.start=t,this.end=e,this}},{key:"clone",value:function(){return new t(this.start.clone(),this.end.clone())}},{key:"copyTo",value:function(t){return t.set(this.start.clone(),this.end.clone())}},{key:"copyFrom",value:function(t){return this.set(t.start.clone(),t.end.clone())}},{key:"equals",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.EPSILON;return this.start.equals(t.start,e)&&this.end.equals(t.end,e)||this.start.equals(t.end,e)&&this.end.equals(t.start,e)}},{key:"reverse",value:function(){var t=this.start;return this.start=this.end,this.end=t,this}},{key:"normalize",value:function(){return this.end.subtract(this.start).normalize().add(this.start),this}},{key:"scale",value:function(t){return this.end.subtract(this.start).multiplyScalar(t).add(this.start),this}},{key:"zero",value:function(){return this.set(new x,new x)}},{key:"length",value:function(){return this.start.distance(this.end)}},{key:"center",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;return(t=t||new x).set((this.start.x+this.end.x)/2,(this.start.y+this.end.y)/2)}},{key:"containsXY",value:function(t,e){return this.contains(new x(t,e))}},{key:"contains",value:function(t){return this.start.distance(t)+this.end.distance(t)===this.length()}},{key:"intersects",value:function(t){var e=this.start,i=this.end,n=t.start,s=t.end,r=(s.y-n.y)*(i.x-e.x)-(s.x-n.x)*(i.y-e.y);if(0===r)return!1;var a=e.y-n.y,o=e.x-n.x,h=(s.x-n.x)*a-(s.y-n.y)*o;return o=((i.x-e.x)*a-(i.y-e.y)*o)/r,(a=h/r)>=0&&a<=1&&o>0&&o<1}},{key:"intersectsCircle",value:function(t){var e=this.start,i=this.end;if(t.contains(e)||t.contains(i))return!0;var n=e.distance(i),s=(i.x-e.x)/n,r=(i.y-e.y)/n,a=s*(t.x-e.x)+r*(t.y-e.y),o=new x(a*s+e.x,a*r+e.y).distance(new x(t.x,t.y));if(o<t.r){var h=Math.sqrt(Math.pow(t.r,2)-Math.pow(o,2)),l=(a-h)*s+e.x,u=(a-h)*r+e.y,c=(a+h)*s+e.x,m=(a+h)*r+e.y;return this.__isInBoundsXY(l,u)||this.__isInBoundsXY(c,m)}return!1}},{key:"__isInBoundsXY",value:function(t,e){var i=this.start.x,n=this.start.y,s=this.end.x,r=this.end.y;return t>Math.min(i,s)&&t<Math.max(i,s)&&e>Math.min(n,r)&&e<Math.max(n,r)}},{key:"toString",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;return"Line { start: ".concat(this.start.toString(t),", end: ").concat(this.end.toString(t)," }")}},{key:"left",get:function(){return Math.min(this.start.x,this.end.x)}},{key:"right",get:function(){return Math.max(this.start.x,this.end.x)}},{key:"top",get:function(){return Math.min(this.start.y,this.end.y)}},{key:"bottom",get:function(){return Math.max(this.start.y,this.end.y)}},{key:"type",get:function(){return"Line"}}]),t}();P.__cache=new P(new x,new x);var A=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];m(this,t),this.mVertices=e,this.mLines=[],this.mBounds=new S,this.mCenter=new x,e.length>2&&this.refresh()}return f(t,[{key:"set",value:function(t){return this.mVertices=t,this.refresh(),this}},{key:"copyTo",value:function(t){for(var e=this.mVertices.length,i=[],n=0;n<e;n++)i.push(this.mVertices[n].clone());return t.set(i)}},{key:"copyFrom",value:function(t){for(var e=t.mVertices,i=e.length,n=[],s=0;s<i;s++)n.push(e[s].clone());return this.set(n)}},{key:"clone",value:function(){for(var e=this.mVertices,i=e.length,n=[],s=0;s<i;s++)n.push(e[s].clone());return new t(n)}},{key:"containsXY",value:function(t,e){return this.contains(new x(t,e))}},{key:"contains",value:function(t){var e=this.mCenter,i=this.mLines,n=i.length;if(e.equals(t))return!0;var s=new P(t,e.clone()),r=0;s.scale((this.width+this.height)/s.length());for(var a=0;a<n;a++)r+=i[a].intersects(s)?1:0;return r%2!=0}},{key:"collide",value:function(t){if(!this.mBounds.intersects(t.mBounds))return!1;for(var e=this.mLines,i=e.length,n=t.mLines,s=n.length,r=0;r<i;r++)for(var a=0;a<s;a++)if(e[r].intersects(n[a]))return!0;return!1}},{key:"collideCircle",value:function(t){var e=this.mBounds,i=this.mLines;if(e.left>t.right||e.right<t.left||e.top>t.bottom||e.bottom<t.top)return!1;for(var n=i.length,s=0;s<n;s++)if(i[s].intersectsCircle(t))return!0;return!1}},{key:"collideRectangle",value:function(t){if(!this.mBounds.intersects(t))return!1;for(var e=this.mLines,i=e.length,n=t.lines,s=n.length,r=0;r<i;r++)for(var a=0;a<s;a++)if(e[r].intersects(n[a]))return!0;return!1}},{key:"overlap",value:function(t){if(this.mBounds.width<t.mBounds.width||this.mBounds.height<t.mBounds.height)return!1;if(!this.contains(t.mCenter))return!1;for(var e=this.mLines,i=e.length,n=t.mLines,s=n.length,r=0;r<i;r++)for(var a=0;a<s;a++)if(e[r].intersects(n[a]))return!1;return!0}},{key:"overlapCircle",value:function(t){if(!this.containsXY(t.x,t.y))return!1;for(var e=this.mLines,i=e.length,n=0;n<i;n++)if(e[n].intersectsCircle(t))return!1;return!0}},{key:"overlapRectangle",value:function(t){if(!this.contains(t.center()))return!1;for(var e=this.mLines,i=e.length,n=t.lines,s=n.length,r=0;r<i;r++)for(var a=0;a<s;a++)if(e[r].intersects(n[a]))return!1;return!0}},{key:"refresh",value:function(){var t=this.mCenter,e=this.mBounds,i=this.mVertices,n=this.mLines=[];t.set(0,0);for(var s=-Number.MAX_VALUE,r=-Number.MAX_VALUE,a=Number.MAX_VALUE,o=Number.MAX_VALUE,h=0;h<i.length;h++){var l=i[h];t.add(l);var u=l.x,c=l.y;s=u>s?u:s,r=c>r?c:r,a=u<a?u:a,o=c<o?c:o,n.push(new P(l,i[h+1]||i[0]))}return t.multiplyScalar(1/i.length),e.set(a,o,s-a,r-o),this}},{key:"refreshCenter",value:function(){var t=this.mCenter,e=this.mVertices,i=e.length;t.set(0,0);for(var n=0;n<i;n++)t.add(e[n]);return t.multiplyScalar(1/e.length),this}},{key:"refreshBounds",value:function(){for(var t,e,i=this.mBounds,n=this.mVertices,s=-Number.MAX_VALUE,r=-Number.MAX_VALUE,a=Number.MAX_VALUE,o=Number.MAX_VALUE,h=n.length,l=0;l<h;l++)t=n[l].x,e=n[l].y,s=t>s?t:s,r=e>r?e:r,a=t<a?t:a,o=e<o?e:o;return i.set(a,o,s-a,r-o),this}},{key:"refreshLines",value:function(){for(var t=this.mVertices,e=this.mLines=[],i=0;i<t.length;i+=2)e.push(new P(t[i],t[i+1]||t[0]));return this}},{key:"setRotation",value:function(t){for(var e=this.mCenter,i=this.mVertices,n=Math.cos(t),s=Math.sin(t),r=0,a=i.length;r<a;r++){var o=i[r];o.subtract(e).set(o.x*n-o.y*s,o.x*s+o.y*n).add(e)}return this.refresh()}},{key:"setTranslation",value:function(t){var e=this.mCenter,i=this.mVertices,n=i.length;t.subtract(e);for(var s=0;s<n;s++)i[s].add(t);return this.refresh()}},{key:"toString",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2,e=this.mLines,i=this.mVertices,n=e.length,s="",r="",a=0;a<n;a++)r+=e[a].toString(t);n=i.length;for(var o=0;o<n;o++)s+=i[o].toString(t);return"Polygon { vertices: ".concat(s,", bounds: ").concat(this.mBounds.toString(t),", center: ").concat(this.mCenter.toString(),", lines: ").concat(r," }")}},{key:"width",get:function(){return this.mBounds.width}},{key:"height",get:function(){return this.mBounds.height}},{key:"perimeter",get:function(){for(var t=this.mLines,e=t.length,i=0,n=0;n<e;n++)i+=t[n].length();return i}},{key:"vertices",get:function(){return this.mVertices}},{key:"center",get:function(){return this.mCenter}}],[{key:"fromPath",value:function(e){for(var i=[],n=e.split(" "),s=0;s<n.length;s+=2)i.push(new x(Number(n[s]),Number(n[s+1])));return new t(i)}}]),t}();A.__cache=new A;var R=function(){function t(){m(this,t),this.mPoints=[],this.mLookup=null,this.mBaked=!1,this.mStep=1/60,this.mEachT=[]}return f(t,[{key:"set",value:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return this.mPoints=this.__initPoints(e),this.__refreshEachT(),this.mBaked&&this.__refreshCache(),this}},{key:"__initPoints",value:function(t){for(var e=[],i=6;i<t.length;i+=6)e=e.concat(t.slice(i-6,i+2));return e}},{key:"__refreshCache",value:function(){for(var e=this.mLookup=[],i=this.getFullLength(),n=this.mPoints,s=n.length,r=0;r<s;r+=8)for(var a=t.getLength.apply(t,c(n.slice(r,r+8))),o=this.mStep*i/a,h=o;h<1;h+=o)e.push(t.lerp.apply(t,[h].concat(c(n.slice(r,r+8)))));return this}},{key:"__refreshEachT",value:function(){for(var e=this.mPoints,i=this.mEachT=[],n=e.length,s=[],r=0;r<n;r+=8)s.push(t.getLength.apply(t,c(e.slice(r,r+8))));for(var a=this.getFullLength(),o=0,h=0;h<n;h+=8)o+=s[h/8],i.push(o/a);return this}},{key:"interpolate",value:function(e,i){var n=i||new x,s=this.mLookup;if(this.mBaked){var r=s[Math.ceil((s.length-1)*e)];return n.copyFrom(r),n}for(var a=this.mEachT,o=this.mPoints,h=0;a[h]<e;)h++;var l=a[h-1]||0,u=a[h],m=o.slice(8*h,8*h+8);return t.lerp.apply(t,[(e-l)/(u-l)].concat(c(m),[n]))}},{key:"getFullLength",value:function(){for(var e=this.mPoints,i=e.length,n=0,s=0;s<i;s+=8)n+=t.getLength.apply(t,c(e.slice(s,s+8)));return n}},{key:"baked",get:function(){return this.mBaked},set:function(t){this.mBaked=t,!this.mLookup&&this.mPoints&&this.__refreshCache()}}],[{key:"lerp",value:function(t,e,i,n,s,r,a,o,h,l){var u=1-t,c=t*t,m=u*u,d=m*u,f=c*t,y=l||new x;return y.set(e,i),y.x*=d,y.y*=d,y.x+=3*m*t*n,y.y+=3*m*t*s,y.x+=3*u*c*r,y.y+=3*u*c*a,y.x+=f*o,y.y+=f*h,y}},{key:"getLength",value:function(){var t=new x(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1]),e=new x(arguments.length<=2?void 0:arguments[2],arguments.length<=3?void 0:arguments[3]),i=new x(arguments.length<=4?void 0:arguments[4],arguments.length<=5?void 0:arguments[5]),n=new x(arguments.length<=6?void 0:arguments[6],arguments.length<=7?void 0:arguments[7]);return(n.distance(t)+t.distance(e)+e.distance(i)+i.distance(n))/2}}]),t}();R.__cache=new R;var E={DIRECT:"direct",BUBBLE:"bubble"},O={REGULAR:"regular",OVERHEARD:"overheard"},N=function(){function t(){m(this,t),this.sender=null,this.name="",this.target=null,this.origin=null,this.canceled=!1,this.type=E.DIRECT}return f(t,[{key:"cancel",value:function(){this.canceled=!0}},{key:"toString",value:function(){var t="";return!0===this.sender instanceof G&&(t=this.sender.name),"MESSAGE: { name: '".concat(this.name,"', sender: '").concat(t,"', target: '").concat(this.target.name,"', path: '").concat(this.path,"' }")}},{key:"__reset",value:function(){return this.sender=null,this.name="",this.target=null,this.canceled=!1,this.type=E.DIRECT,this}}]),t}();N.pool=new g(N),N.PROGRESS="progress",N.COMPLETE="complete",N.ERROR="error",N.CHANGE="change",N.READY="ready",N.UPDATE="update",N.RESIZE="resize";var D=function(){function t(e,i,n,s){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:O.REGULAR,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;m(this,t),this.owner=e,this.name=i,this.callback=n,this.isOnce=s,this.context=r,this.pathPattern=o,this.glob=null==o?null:new _(o),this.type=a}return f(t,[{key:"off",value:function(){this.owner.__off(this)}},{key:"__reset",value:function(){return this.owner=null,this.pathPattern=null,this}}]),t}(),M=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];m(this,t),this.mBindings=null,this.checkForStage=e}return f(t,[{key:"on",value:function(t,e,i){return this.__on(t,e,!1,i)}},{key:"off",value:function(){for(var t=0;t<arguments.length;t++){var e=t<0||arguments.length<=t?void 0:arguments[t];if(-1!==e.indexOf("@"))return void y.error("Removing overheard bindings is not allowed.");if(null!==this.mBindings&&!0===this.mBindings.hasOwnProperty(e))for(var i=this.mBindings[e].slice(),n=0;n<i.length;n++)this.__off(i[n])}}},{key:"once",value:function(t,e,i){return this.__on(t,e,!0,i)}},{key:"post",value:function(t){for(var e=this.__draftMessage(t),i=arguments.length,n=new Array(i>1?i-1:0),s=1;s<i;s++)n[s-1]=arguments[s];e.type===E.DIRECT?this.__invoke.apply(this,[this,e].concat(n)):e.type===E.BUBBLE&&this.__postBubbles.apply(this,[this,e,!0].concat(n)),!1===e.canceled&&this.__invokeOverheard.apply(this,[this,e].concat(n)),N.pool.release(e)}},{key:"__on",value:function(e,i){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;y.assert(null!==e,"name cannot be null."),y.assert(e.trim().length>0,"name cannot be null."),y.assert(!(0===e.indexOf("~")),"Using `~` is not tot allowed here."),y.assert(null!==i,"callback cannot be null.");var r=e.indexOf("@");if(-1!==r){var a=e.substring(0,r),o=e.substring(r+1),h=t.mOverheardHandlers;!1===h.hasOwnProperty(a)&&(h[a]=[]);var l=h[a],u=new D(this,a,i,n,s,O.OVERHEARD,o);return l.push(u),u}null===this.mBindings&&(this.mBindings={}),!1===this.mBindings.hasOwnProperty(e)&&(this.mBindings[e]=[]);var c=new D(this,e,i,n,s,O.REGULAR);return this.mBindings[e].push(c),c}},{key:"__off",value:function(e){if(e.type===O.REGULAR){if(null===this.mBindings)return;if(!1===this.mBindings.hasOwnProperty(e.name))return;var i=this.mBindings[e.name],n=i.indexOf(e);if(-1===n)return;i.splice(n,1)}else if(e.type===O.OVERHEARD){var s=t.mOverheardHandlers;if(!1===s.hasOwnProperty(e.name))return;var r=s[e.name],a=r.indexOf(e);if(-1===a)return;r.splice(a,1)}}},{key:"__invoke",value:function(t,e){if(!0!==e.canceled&&null!==this.mBindings&&(!0!==this.checkForStage||this===ei.stage||null!==this.stage)){var i=this.mBindings[e.name];if(void 0!==i&&0!==i.length){for(var n=i.slice(0),s=arguments.length,r=new Array(s>2?s-2:0),a=2;a<s;a++)r[a-2]=arguments[a];for(var o=0;o<n.length;o++){var h;e.target=this;var l=n[o];if((!0!==this.checkForStage||l.owner.stage!==ei.stage||null!==l.owner.stage)&&((h=l.callback).call.apply(h,[l.context,e].concat(r)),!0===l.isOnce&&this.__off(l),!0===e.canceled))return}}}}},{key:"__invokeOverheard",value:function(e,i){if(!0!==i.canceled){var n=t.mOverheardHandlers[i.name];if(void 0!==n&&0!==n.length){for(var s=n.slice(0),r=arguments.length,a=new Array(r>2?r-2:0),o=2;o<r;o++)a[o-2]=arguments[o];for(var h=0;h<s.length;h++){var l,u=s[h];if((!0!==this.checkForStage||u.owner.stage!==ei.stage||null!==u.owner.stage)&&(this.__checkPath(e.path,u)&&(i.target=this,(l=u.callback).call.apply(l,[u.context,i].concat(a)),!0===u.isOnce&&this.__off(u),!0===i.canceled)))return}}}}},{key:"__postBubbles",value:function(t,e,i){e.origin=this;for(var n=[this],s=this;null!==s.parent;)n.push(s.parent),s=s.parent;for(var r=arguments.length,a=new Array(r>3?r-3:0),o=3;o<r;o++)a[o-3]=arguments[o];for(var h=0;h<n.length;h++){var l=n[h];if(l.__invoke.apply(l,[t,e].concat(a)),!0===e.canceled)return}}},{key:"__draftMessage",value:function(t){var e=N.pool.get();return e.__reset(),e.sender=this,!0===t.startsWith("~")?(e.name=t.substr(1),e.type=E.BUBBLE):e.name=t,e}},{key:"__checkPath",value:function(t,e){return null!==t&&null!==e.pathPattern&&(t===e.pathPattern||(-1===e.pathPattern.indexOf("*")?t===e.pathPattern:e.glob.test(t)))}},{key:"parent",get:function(){return null}},{key:"stage",get:function(){return null}},{key:"path",get:function(){return null}}]),t}();M.mOverheardHandlers={};var L=function(){function t(e){m(this,t),null===t.__CONTEXT&&(t.__CANVAS=document.createElement("canvas"),t.__CONTEXT=t.__CANVAS.getContext("2d"),t.__CANVAS.width=10,t.__CANVAS.height=200),e.size=100,this.mCanvas=t.__CANVAS,this.mCtx=t.__CONTEXT,this.mStyle=e;var i=Math.floor(.7766*t.__CANVAS.height);this.mCtx.clearRect(0,0,this.mCanvas.width,this.mCanvas.height),this.mCtx.font="".concat(e.weight," ").concat(e.size,"px ").concat(e.family),this.mCtx.fillText("x",0,i,1);for(var n=this.mCtx.getImageData(0,0,1,this.mCanvas.height).data,s=this.__getBottom(n)-this.__getTop(n),r=65;r<=122;r++)r>90&&r<97||this.mCtx.fillText(String.fromCharCode(r),0,i,1);n=this.mCtx.getImageData(0,0,1,this.mCanvas.height).data;var a=this.__getTop(n),o=i-a,h=this.__getBottom(n)-a;this.baseline=o,this.bottom=h,this.ascent=o-s,this.descent=h-o,this.xHeight=s,this.capHeight=o}return f(t,[{key:"__getTop",value:function(t){for(var e=3,i=t.length;e<i;e+=4)if(t[e]>0)return(e-3)/4;return t.length/4}},{key:"__getBottom",value:function(t){for(var e=t.length-1;e>0;e-=4)if(t[e]>0)return(e+1)/4;return 0}},{key:"capHeightNormalized",get:function(){return this.capHeight/this.mStyle.size}},{key:"xHeightNormalized",get:function(){return this.xHeight/this.mStyle.size}},{key:"ascentNormalized",get:function(){return this.ascent/this.mStyle.size}},{key:"descentNormalized",get:function(){return this.descent/this.mStyle.size}},{key:"baselineNormalized",get:function(){return this.baseline/this.mStyle.size}},{key:"bottomNormalized",get:function(){return this.bottom/this.mStyle.size}}],[{key:"get",value:function(e){var i=t.CACHE[e];null==i&&(i=new t(new Gt(e,0,24)),t.CACHE[e]=i);return i}}]),t}();L.CACHE={},L.__CONTEXT=null,L.__CANVAS=null,L.CHAR_CAPITAL_HEIGHT="s",L.CHAR_BASELINE="a",L.CHAR_XHEIGHT="x",L.CHAR_DESCENT="p",L.CHAR_ASCENT="h";var I=function t(e,i,n,s){m(this,t),this.text=e,this.style=i,this.lineIndex=n,this.bounds=s},B=function(){function t(){throw m(this,t),new Error("Singleton")}return f(t,null,[{key:"measure",value:function(e,i){for(var n,s=[],r=/(~{([^}]+)}|^)(.+?(?=~{.+}|$|^))|(\n)/gm,a="def",o=0,h=arguments.length,l=new Array(h>2?h-2:0),u=2;u<h;u++)l[u-2]=arguments[u];for(;null!==(n=r.exec(e));)n[4]&&o++,n[2]&&(a=n[2]),n[3]&&s.push({tag:a,text:n[3],style:l.find(function(t){return t.name===a}),lineIndex:o});for(var c,d=new function t(){m(this,t),this.segments=[],this.bounds=new S,this.strokeBounds=null,this.shadowBounds=null,this.lineWidth=[]},f=l.find(function(t){return"def"===t.name})||Gt.default,y=f.size*i,v=new S,p=new S,g=-1,k=0,b=0,w=L.get(f.family).baselineNormalized*f.size,_=0;_<s.length;_++){var x=s[_],C=x.style,T=t.__measure(x.text,C),P=L.get(C.family).baselineNormalized*C.size;if(g!==x.lineIndex&&(d.lineWidth[x.lineIndex]=0,k=0),b=y*x.lineIndex+w-P,T.x=k,T.y=b,k+=T.width,g=x.lineIndex,x.bounds=T,d.lineWidth[x.lineIndex]+=T.width,v.union(T),p.union(T.clone().inflate(C.strokeThickness,C.strokeThickness)),!0===C.dropShadow){var A=T.clone();A.inflate(C.shadowBlur,C.shadowBlur),A.x+=C.shadowDistanceX,A.y+=C.shadowDistanceY,(c=c||A).union(A)}d.segments.push(new I(x.text,C,x.lineIndex,x.bounds))}return d.bounds=v,d.strokeBounds=p,d.shadowBounds=c||new S,d}},{key:"__measure",value:function(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;y.assert(null!=i,"Style cannot be null"),(n=n||new S).zero();var s=t.__span;null===t.__span&&(t.__span=document.createElement("span"),(s=t.__span).id="font",s.style.position="absolute",s.style.width="auto",s.style.height="auto",s.style.top="0px",s.style.left="0px",s.style.display="inline-block",s.style.border="1px solid green",s.style.color="#00ff00",s.style.verticalAlign="baseline",s.style.whiteSpace="nowrap",s.style.lineHeight="normal",s.style.top="-9999px",s.style.left="-9999px",document.body.appendChild(s)),s.style.fontFamily=i.family,s.style.fontSize="".concat(i.size,"px"),s.style.fontWeight=i.weight,s.style.fontStyle=i.style;var r=L.get(i.family);return s.innerHTML=e.replace(/ /g,"&nbsp"),n.set(0,r.baselineNormalized*i.size,s.offsetWidth,r.bottomNormalized*i.size),n}},{key:"measureBitmap",value:function(t,e,i,n){n=n||new S;for(var s=-1,r=0,a=0,o=0,h=0,l=0;l<t.length;l++){var u=t.charCodeAt(l);if(/(?:\r\n|\r|\n)/.test(t.charAt(l)))r=0,a+=e.lineHeight*i,s=-1;else{var c=e.chars[u];null!=c&&(s>=0&&c.kerning[s]&&(r+=c.kerning[s]),r+=c.xAdvance,h=Math.max(h,r+c.xOffset),o=Math.max(o,a+c.height+c.yOffset),s=u)}}return n.set(0,0,h,o)}}]),t}();B.__span=null,B.NEWLINE_REGEX=/\r?\n/;var H=function(){function t(){m(this,t)}return f(t,null,[{key:"now",get:function(){return t.mTime}},{key:"dt",get:function(){return t.mDeltaTime*t.mScale}},{key:"alpha",get:function(){return t.mAlphaTime}},{key:"delta",get:function(){return t.mDeltaTime*t.mScale}},{key:"scale",get:function(){return t.mScale},set:function(e){y.assert(e>=0,"Time.scale must be >= 0."),t.mScale=e}}]),t}();H.mTime=0,H.mActualTime=0,H.mDeltaTimeMs=1e3/60,H.mDeltaTime=1e3/60*.001,H.mScale=1,H.mAlphaTime=0,H.mRenderOffset=0;var F=function(t){function e(){return m(this,e),a(this,h(e).call(this))}return l(e,M),f(e,[{key:"onUpdate",value:function(){}},{key:"onPostUpdate",value:function(){}},{key:"onRender",value:function(){}},{key:"onChildrenAdded",value:function(t){}},{key:"onChildrenRemoved",value:function(t){}},{key:"onChildrenChanged",value:function(t){}},{key:"onComponentAdded",value:function(t,e){}},{key:"onComponentRemoved",value:function(t,e){}}]),e}(),X=function(t){function e(t){var i;m(this,e),(i=a(this,h(e).call(this))).mContainerElement=t;var n=i.mContainerElement.style;n.userSelect="none",n.touchAction="none",n.cursor="auto",n.WebkitTapHighlightColor="rgba(0, 0, 0, 0)";var s=i.mContainerElement.getBoundingClientRect();return i.mSize=new S(s.left,s.top,s.width,s.height),i.isTransparent=!0,i.backgroundColor=2236962,i.mChecksLeftSeconds=0,window.addEventListener("resize",function(t){return i.__onResize()}),i}return l(e,M),f(e,[{key:"__update",value:function(){this.mChecksLeftSeconds<=0||(this.__onResize(),this.mChecksLeftSeconds-=H.delta)}},{key:"__onResize",value:function(){var t=this.mContainerElement.getBoundingClientRect(),e=S.pool.get().set(t.left,t.top,t.width,t.height);!0!==this.mSize.equals(e)&&(this.mSize.copyFrom(e),this.post(N.RESIZE,this.mSize),this.mChecksLeftSeconds=1,S.pool.release(e))}},{key:"size",get:function(){return this.mSize}},{key:"nativeDOM",get:function(){return this.mContainerElement}}]),e}(),V=function(t){function e(){var t;return m(this,e),(t=a(this,h(e).call(this,!0))).mId=++e.ID,t.mGameObject=null,t.mAdded=!1,t}return l(e,M),f(e,[{key:"onAdded",value:function(t){}},{key:"onRemoved",value:function(t){}},{key:"onUpdate",value:function(){}},{key:"onRender",value:function(){}},{key:"removeFromParent",value:function(){null!==this.mGameObject&&this.mGameObject.removeComponent(this)}},{key:"gameObject",get:function(){return this.mGameObject}},{key:"parent",get:function(){return this.mGameObject}},{key:"stage",get:function(){return null===this.mGameObject?null:this.mGameObject.stage}},{key:"path",get:function(){return null!==this.mGameObject?this.mGameObject.path+"#"+this.constructor.name:this.constructor.name}}]),e}();V.ID=0;var G=function(t){function e(){var t;return m(this,e),(t=a(this,h(e).call(this,!0))).mId=++e.ID,t.mName=null,t.mComponents=[],t.mChildren=[],t.mX=0,t.mY=0,t.mScaleX=1,t.mScaleY=1,t.mPivotX=0,t.mPivotY=0,t.mSkewX=0,t.mSkewY=0,t.mAnchorX=0,t.mAnchorY=0,t.mPivotOffsetX=0,t.mPivotOffsetY=0,t.mAnchorChanged=!1,t.mRotation=0,t.mBoundsCache=new S,t.mLocalTransform=new C,t.mWorldTransform=new C,t.mWorldTransformInverted=new C,t.mDirty=z.DIRTY,t.mParent=null,t.mTag=null,t.mAdded=!1,t.mNumChildrenRemoved=0,t.mNumComponentsRemoved=0,t.mDirtyFrameNum=0,t.mSuspendDirty=!1,t.mCollidersCache=[],t.mChildOrComponentBeenAdded=!1,t.mChildrenClone=null,t.mComponentClone=null,t}return l(e,M),f(e,[{key:"make",value:function(t){for(var e in this.mSuspendDirty=!0,t)t.hasOwnProperty(e)&&(this[e]=t[e]);return this.mSuspendDirty=!1,this.setTransformDirty(),this}},{key:"checkStatic",value:function(){if(!1===(!(arguments.length>0&&void 0!==arguments[0])||arguments[0]))return this.mDirtyFrameNum<ei.frameNum;var t=!1;return e.forEach(this,function(e){if(e.mDirtyFrameNum>=ei.frameNum)return t=!0,!0}),!t}},{key:"onAdded",value:function(){}},{key:"onRemoved",value:function(){}},{key:"add",value:function(){for(var t=0;t<arguments.length;t++){var i=t<0||arguments.length<=t?void 0:arguments[t];i instanceof e?this.addChild(i):this.addComponent(i)}return this}},{key:"addChild",value:function(t){return this.addChildAt(t,this.mChildren.length)}},{key:"addChildAt",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;y.assert(t instanceof e,"Type error.");var n=this.mChildren.length;if(i<0||i>n)throw new Error("Child index is out of bounds.");return t.mParent===this?this.setChildIndex(t,i):(this.mChildren.splice(i,0,t),t.removeFromParent(),t.__setParent(this),this.root instanceof U&&ei.instance.onChildrenAdded(t),this.mChildOrComponentBeenAdded=!0,t)}},{key:"__setParent",value:function(t){for(var e=t;null!==e&&e!==this;)e=e.mParent;if(e===this)throw new Error("Object cannot be a child to itself.");return this.mParent=t,this.setTransformDirty(),!0}},{key:"setChildIndex",value:function(t,e){var i=this.mChildren.indexOf(t);if(i<0)throw new Error("Given child element was not found in children list.");return i===e?t:(this.mChildren.splice(i,1),this.mChildren.splice(e,0,t),null!==this.stage&&ei.instance.onChildrenChanged(t),this.setTransformDirty(),t)}},{key:"removeFromParent",value:function(){null!==this.mParent&&this.mParent.removeChild(this),this.setTransformDirty()}},{key:"removeChild",value:function(t){var e=this.mChildren.indexOf(t);return e<0?null:this.removeChildAt(e)}},{key:"getChildByName",value:function(t){for(var e=0;e<this.mChildren.length;e++)if(this.mChildren[e].name===t)return this.mChildren[e];return null}},{key:"removeChildAt",value:function(t){if(t<0||t>this.numChildren)throw new Error("Child index is out of bounds.");var e=null!==this.stage,i=this.mChildren[t];return i.__setParent(null),this.mChildren.splice(t,1),e&&ei.instance.onChildrenRemoved(i),this.setTransformDirty(),this.mNumChildrenRemoved++,i}},{key:"getChildAt",value:function(t){return this.mChildren[t]}},{key:"addComponent",value:function(t){y.assert(t instanceof V,"Type error.");var e=t;if(e.gameObject)throw new Error("Component cannot be added to two game objects at the same time.");return this.mComponents.push(e),e.mGameObject=this,e instanceof W&&this.mCollidersCache.push(e),null===this.stage&&ei.stage!==this||ei.instance.onComponentAdded(this,e),this.mChildOrComponentBeenAdded=!0,e}},{key:"removeComponent",value:function(t){if(!t)return null;y.assert(t instanceof V,"Type error.");var e=this.mComponents.indexOf(t);if(e>-1&&this.mComponents.splice(e,1),t.mGameObject=null,t instanceof W){var i=this.mCollidersCache.indexOf(t);i>-1&&this.mCollidersCache.splice(i,1)}return null===this.stage&&ei.stage!==this||ei.instance.onComponentRemoved(this,t),this.mNumComponentsRemoved++,t}},{key:"getComponent",value:function(t){for(var e=0;e<this.mComponents.length;e++){var i=this.mComponents[e];if(i instanceof t)return i}return null}},{key:"getComponentAt",value:function(t){return t>=0&&t<this.mComponents.length?this.mComponents[t]:null}},{key:"__update",value:function(){if(this.onUpdate(),!1!==this.mChildOrComponentBeenAdded){if(this.mComponents.length>0){this.mComponentClone=this.mComponents.slice();for(var t=0;t<this.mComponentClone.length&&!1!==this.mAdded;t++){var e=this.mComponentClone[t];if(!1===e.mAdded)break;e.onUpdate()}}if(this.mChildren.length>0){this.mChildrenClone=this.mChildren.slice();for(var i=0;i<this.mChildrenClone.length;i++){var n=this.mChildrenClone[i];!0===n.mAdded&&n.__update()}}}}},{key:"onUpdate",value:function(){}},{key:"onCollectRenderables",value:function(t,e){arguments.length>2&&void 0!==arguments[2]&&arguments[2];return null}},{key:"onGetLocalBounds",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;return(t=t||new S).set(0,0,0,0)}},{key:"getBounds",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;if(i=i||new S,this.onGetLocalBounds(i),null==t&&(t=this.mParent),t==this);else if(t==this.mParent)if(!1===e){var n=C.pool.get();n.copyFrom(this.localTransformation),n.transformRect(i,i),C.pool.release(n)}else{if(!(!0===e&&this.mDirty&z.BOUNDS))return i.copyFrom(this.mBoundsCache),i;var s=C.pool.get();s.copyFrom(this.localTransformation),s.transformRect(i,i),C.pool.release(s)}else{var r=C.pool.get();r.copyFrom(this.worldTransformation),r.prepend(t.worldTransformationInverted),r.transformRect(i,i),C.pool.release(r)}if(!0===e){for(var a=S.pool.get(),o=0;o<this.mChildren.length;o++)a.zero(),this.mChildren[o].getBounds(t,e,a),i.union(a);S.pool.release(a),t==this.mParent&&this.mDirty&z.BOUNDS&&(this.mBoundsCache.copyFrom(i),this.mDirty^=z.BOUNDS)}return i}},{key:"getStageBounds",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;t=t||new S,this.onGetLocalBounds(t);var e=C.pool.get();return e.copyFrom(this.worldTransformation),e.prepend(this.stage.worldTransformationInverted),e.transformRect(t,t),C.pool.release(e),t}},{key:"hitTest",value:function(t){var e=this.getComponent(oe),i=null!==e&&e.touchable,n=this.onHitTestMask(t);if(!1===i||!1===n)return null;for(var s=null,r=this.mChildren.length-1;r>=0;--r){if(null!==(s=this.mChildren[r].hitTest(t)))return s}return!0===this.onHitTest(t)?this:null}},{key:"onHitTest",value:function(t){var e=!1,i=x.pool.get();if(this.worldTransformationInverted.transformVector(t,i),this.mCollidersCache.length>0)for(var n=0;n<this.mCollidersCache.length;n++){if(!0===(e=this.mCollidersCache[n].containsPoint(i)))return!0}else e=this.localBounds.containsXY(i.x,i.y);return x.pool.release(i),e}},{key:"onHitTestMask",value:function(t){return!0}},{key:"setTransform",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;!(arguments.length>7&&void 0!==arguments[7])||arguments[7];return this.mX=t,this.mY=e,this.mRotation=i,this.mScaleX=n,this.mScaleY=s,this.mAnchorX=r,this.mAnchorY=a,this.setTransformDirty(),this}},{key:"relativeTo",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return(e=e||new x).set(this.x,this.y),null==this.parent||null==t?e:(this.parent.localToGlobal(e,e),t.globalToLocal(e,e),e)}},{key:"localToGlobal",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.worldTransformation.transformVector(t,e)}},{key:"globalToLocal",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.worldTransformationInverted.transformVector(t,e)}},{key:"alignAnchor",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;return y.isNumber(t,e),this.mAnchorX=t,this.anchorY=e,this}},{key:"alignPivot",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;return this.alignPivotOffset(t,e)}},{key:"alignPivotOffset",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return y.isNumber(t,e),this.getBounds(this,i,S.__cache.zero()),this.mPivotOffsetX=S.__cache.width*t,this.mPivotOffsetY=S.__cache.height*e,this.mPivotX=this.mPivotOffsetX+S.__cache.width*this.mAnchorX+S.__cache.x,this.mPivotY=this.mPivotOffsetY+S.__cache.height*this.mAnchorY+S.__cache.y,this.setDirty(z.LOCAL|z.BOUNDS,!1),this.setDirty(z.WIRB,!0),this.setParentDirty(z.BOUNDS),this}},{key:"spawn",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=t.apply(null==e?this:e);return function t(e){e.done||("function"==typeof e.value?e.value(function(e){return t(i.next(e))}):t(i.next(e.value)))}(i.next()),i}},{key:"wait",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return function(i){return setTimeout(i.bind(t,1e3*e),1e3*e)}}},{key:"waitMessage",value:function(t){var e=this;return function(i){return e.once(t,i.bind(e))}}},{key:"setDirty",value:function(t){!(arguments.length>1&&void 0!==arguments[1])||arguments[1]?e.forEach(this,function(e){e.mDirty|=t,e.mDirtyFrameNum=ei.frameNum}):(this.mDirty|=t,this.mDirtyFrameNum=ei.frameNum),pt.__dirty=!0}},{key:"setParentDirty",value:function(t){this.mDirty|=t,this.mDirtyFrameNum=ei.frameNum,(!0===this.mAnchorChanged||this.mDirty&z.LOCAL||this.mDirty&z.BOUNDS)&&(0===this.mAnchorX&&0===this.mAnchorY||(this.getBounds(this,!0,S.__cache.zero()),this.mPivotX=this.mPivotOffsetX+S.__cache.width*this.mAnchorX+S.__cache.x,this.mPivotY=this.mPivotOffsetY+S.__cache.height*this.mAnchorY+S.__cache.y,this.mDirty|=z.LOCAL|z.WIRB),this.mAnchorChanged=!1);for(var e=this;null!=e.mParent;)(e=e.mParent).mDirty|=t,e.mDirtyFrameNum=ei.frameNum,(!0===this.mAnchorChanged||e.mDirty&z.BOUNDS||e.mDirty&z.LOCAL)&&(0===e.mAnchorX&&0===e.mAnchorY||(e.getBounds(e,!0,S.__cache.zero()),e.mPivotX=e.mPivotOffsetX+S.__cache.width*e.mAnchorX+S.__cache.x,e.mPivotY=e.mPivotOffsetY+S.__cache.height*e.mAnchorY+S.__cache.y,e.mDirty|=z.LOCAL|z.WIRB));pt.__dirty=!0}},{key:"setTransformDirty",value:function(){!0!==this.mSuspendDirty&&(this.setDirty(z.LOCAL|z.BOUNDS,!1),this.setDirty(z.WIRB,!0),this.setParentDirty(z.BOUNDS))}},{key:"setRenderDirty",value:function(){!0!==this.mSuspendDirty&&this.setDirty(z.RENDER,!0)}},{key:"id",get:function(){return this.mId}},{key:"numComponents",get:function(){return this.mComponents.length}},{key:"localTransformation",get:function(){if(this.mDirty&z.LOCAL){if(this.mDirty^=z.LOCAL,0===this.mSkewX&&0===this.mSkewY){if(0===this.mRotation)return this.mLocalTransform.set(this.mScaleX,0,0,this.mScaleY,this.mX-this.mPivotX*this.mScaleX,this.mY-this.mPivotY*this.mScaleY);var t=Math.cos(this.mRotation),e=Math.sin(this.mRotation),i=this.mScaleX*t,n=this.mScaleX*e,s=this.mScaleY*-e,r=this.mScaleY*t,a=this.mX-this.mPivotX*i-this.mPivotY*s,o=this.mY-this.mPivotX*n-this.mPivotY*r;return this.mLocalTransform.set(i,n,s,r,a,o)}this.mLocalTransform.identity(),this.mLocalTransform.scale(this.mScaleX,this.mScaleY),this.mLocalTransform.skew(this.mSkewX,this.mSkewY),this.mLocalTransform.rotate(this.mRotation);var h=this.mLocalTransform.data[0],l=this.mLocalTransform.data[1],u=this.mLocalTransform.data[2],c=this.mLocalTransform.data[3],m=this.mX,d=this.mY;0===this.mPivotX&&0===this.mPivotY||(m=this.mX-h*this.mPivotX-u*this.mPivotY,d=this.mY-l*this.mPivotX-c*this.mPivotY),this.mLocalTransform.data[4]=m,this.mLocalTransform.data[5]=d}return this.mLocalTransform},set:function(t){var e=Math.PI/4,i=t.data[0],n=t.data[1],s=t.data[2],r=t.data[3],a=t.data[4],o=t.data[5];this.mPivotX=this.mPivotX=0,this.mX=a,this.mY=o;var h=Math.atan(-s/r),l=Math.atan(n/i);h!=h&&(h=0),l!=l&&(l=0),this.mScaleY=h>-e&&h<e?r/Math.cos(h):-s/Math.sin(h),this.mScaleX=l>-e&&l<e?i/Math.cos(l):n/Math.sin(l),v.equals(h,l)?(this.mRotation=h,this.mSkewX=this.mSkewY=0):(this.mRotation=0,this.mSkewX=h,this.mSkewY=l),this.setTransformDirty()}},{key:"worldTransformation",get:function(){return this.mDirty&z.WORLD&&(this.mDirty^=z.WORLD,null!==this.mParent?this.mParent.worldTransformation.copyTo(this.mWorldTransform).append(this.localTransformation):this.localTransformation.copyTo(this.mWorldTransform)),this.mWorldTransform}},{key:"worldTransformationInverted",get:function(){return this.mDirty&z.WORLD_INV&&(this.mDirty^=z.WORLD_INV,this.worldTransformation.copyTo(this.mWorldTransformInverted).invert()),this.mWorldTransformInverted}},{key:"localBounds",get:function(){return this.getBounds(this,!1)}},{key:"bounds",get:function(){return this.getBounds(this.mParent,!0)}},{key:"numChildren",get:function(){return this.mChildren.length}},{key:"name",get:function(){return this.mName},set:function(t){this.mName=t}},{key:"x",get:function(){return this.mX},set:function(t){this.mX!=t&&(y.assert(!isNaN(t),"Value cannot be NaN"),this.mX=t,this.setTransformDirty())}},{key:"y",get:function(){return this.mY},set:function(t){this.mY!=t&&(y.assert(!isNaN(t),"Value cannot be NaN"),this.mY=t,this.setTransformDirty())}},{key:"pivotOffsetX",get:function(){return this.mPivotOffsetX},set:function(t){this.mPivotOffsetX!==t&&(y.assert(!isNaN(t),"Value cannot be NaN"),this.getBounds(this,!0,S.__cache.zero()),this.mPivotOffsetX=t,this.mPivotX=this.mPivotOffsetX+S.__cache.width*this.mAnchorX+S.__cache.x,this.setDirty(z.LOCAL|z.BOUNDS,!1),this.setDirty(z.WIRB,!0),this.setParentDirty(z.BOUNDS))}},{key:"pivotOffsetY",get:function(){return this.mPivotOffsetY},set:function(t){this.mPivotOffsetY!==t&&(y.assert(!isNaN(t),"Value cannot be NaN"),this.getBounds(this,!0,S.__cache.zero()),this.mPivotOffsetY=t,this.mPivotY=this.mPivotOffsetY+S.__cache.height*this.mAnchorY+S.__cache.y,this.setDirty(z.LOCAL|z.BOUNDS,!1),this.setDirty(z.WIRB,!0),this.setParentDirty(z.BOUNDS))}},{key:"anchorX",set:function(t){this.mAnchorX!==t&&(y.assert(!isNaN(t),"Value cannot be NaN"),this.mAnchorX=t,this.mAnchorChanged=!0,this.setDirty(z.LOCAL|z.BOUNDS,!1),this.setDirty(z.WIRB,!0),this.setParentDirty(z.BOUNDS))},get:function(){return this.mAnchorX}},{key:"anchorY",set:function(t){this.mAnchorY!==t&&(y.assert(!isNaN(t),"Value cannot be NaN"),this.mAnchorY=t,this.mAnchorChanged=!0,this.setDirty(z.LOCAL|z.BOUNDS,!1),this.setDirty(z.WIRB,!0),this.setParentDirty(z.BOUNDS))},get:function(){return this.mAnchorY}},{key:"pivotX",get:function(){return this.mPivotX}},{key:"pivotY",get:function(){return this.mPivotY}},{key:"scaleX",get:function(){return this.mScaleX},set:function(t){this.mScaleX!=t&&(y.assert(!isNaN(t),"Value cannot be NaN"),this.mScaleX=t,this.setTransformDirty())}},{key:"scaleY",get:function(){return this.mScaleY},set:function(t){this.mScaleY!=t&&(y.assert(!isNaN(t),"Value cannot be NaN"),this.mScaleY=t,this.setTransformDirty())}},{key:"scale",get:function(){return this.scaleX},set:function(t){this.mScaleX!=t&&(y.assert(!isNaN(t),"Value cannot be NaN"),this.mScaleX=this.mScaleY=t,this.setTransformDirty())}},{key:"skewX",get:function(){return this.mSkewX},set:function(t){this.mSkewX!=t&&(y.assert(!isNaN(t),"Value cannot be NaN"),this.mSkewX=t,this.setTransformDirty())}},{key:"skewY",get:function(){return this.mSkewY},set:function(t){this.mSkewY!=t&&(y.assert(!isNaN(t),"Value cannot be NaN"),this.mSkewY=t,this.setTransformDirty())}},{key:"rotation",get:function(){return this.mRotation},set:function(t){this.mRotation!=t&&(y.assert(!isNaN(t),"Value cannot be NaN"),this.mRotation=t,this.setTransformDirty())}},{key:"parent",get:function(){return this.mParent}},{key:"root",get:function(){for(var t=this;null!=t.mParent;)t=t.mParent;return t}},{key:"stage",get:function(){return!0===this.mAdded?ei.stage:null}},{key:"width",get:function(){return this.getBounds(this.mParent).width},set:function(t){y.assert(!isNaN(t),"Value cannot be NaN"),this.scaleX=1;var e=this.width;0!=e&&(this.scaleX=t/e)}},{key:"height",get:function(){return this.getBounds(this.mParent).height},set:function(t){y.assert(!isNaN(t),"Value cannot be NaN"),this.scaleY=1;var e=this.height;0!=e&&(this.scaleY=t/e)}},{key:"localWidth",get:function(){return this.getBounds(this,!1).width}},{key:"localHeight",get:function(){return this.getBounds(this,!1).height}},{key:"path",get:function(){return null!==this.mParent?this.mParent.path+"/"+this.mName:this.mName}},{key:"tag",get:function(){return this.mTag},set:function(t){if(this.mTag!==t){var e=this.mTag;this.mTag=t,this.mAdded&&ei.instance.onTagUpdated(this,e,t)}}},{key:"touchable",set:function(t){var e=this.getComponent(oe);!0===t?null===e?this.addComponent(new oe):e.touchable=!0:null!==e&&this.removeComponent(e)},get:function(){var t=this.getComponent(oe);return null!==t&&!0===t.touchable}}],[{key:"getBoundsWithPoints",value:function(t,e,i){i=i||new S;for(var n=Number.MAX_VALUE,s=-Number.MAX_VALUE,r=Number.MAX_VALUE,a=-Number.MAX_VALUE,o=new x,h=0;h<t.length;h+=2)e.transformXY(t[h],t[h+1],o),n>o.x&&(n=o.x),s<o.x&&(s=o.x),r>o.y&&(r=o.y),a<o.y&&(a=o.y);return i.set(n,r,s-n,a-r),i}},{key:"intersects",value:function(t,e){var i=new x;return t.worldTransformationInverted.transformVector(e,i),t.localBounds.containsXY(i.x,i.y)}},{key:"intersectsAt",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return i=i||new x,x.__cache.set(),t.worldTransformationInverted.transformVector(e,x.__cache),!1!==t.localBounds.containsXY(x.__cache.x,x.__cache.y)&&(i.x=x.__cache.x-t.localBounds.x,i.y=x.__cache.y-t.localBounds.y,!0)}},{key:"intersectsWith",value:function(t,i){for(var n=null,s=t.numChildren-1;s>=0;--s){var r=t.mChildren[s];if(null!=(n=e.intersectsWith(r,i)))return n;if(e.intersects(r,i)){n=r;break}}return null===n&&e.intersects(t,i)?t:null}},{key:"findWithTag",value:function(t){return!1===ei.instance.mTagCache.hasOwnProperty(t)?null:ei.instance.mTagCache[t]}},{key:"findComponents",value:function(t,e){y.assert(null!==t,"gameObject cannot be null."),y.assert(null!==e,"type cannot be null.");var i=[];return function t(e,n){for(var s=0;s<e.mComponents.length;s++){var r=e.mComponents[s];r instanceof n&&i.push(r)}for(var a=0;a<e.mChildren.length;a++)t(e.mChildren[a],n)}(t,e),i}},{key:"forEach",value:function(t,i){null==t&&(t=ei.stage);var n=i(t);if(1!=n)for(var s=0;s<t.mChildren.length;s++)if(1==(n=e.forEach(t.mChildren[s],i)))return}},{key:"find",value:function(t,i){if(null==i&&(i=ei.stage),i.name===t)return i;for(var n=0;n<i.numChildren;n++){var s=e.find(t,i.getChildAt(n));if(null!=s)return s}return null}},{key:"findById",value:function(t,i){if(null==i&&(i=ei.stage),i.id===t)return i;for(var n=0;n<i.numChildren;n++){var s=e.findById(t,i.getChildAt(n));if(null!==s)return s}return null}}]),e}();G.ID=0;var z={CLEAN:0,LOCAL:1,WORLD:2,WORLD_INV:4,RENDER:8,RENDER_CACHE:16,REBAKE:32,BOUNDS:64,DIRTY:16777215,WIRB:78},Y={NORMAL:"normal",NO_SCALE:"noScale",FIXED:"fixed",LETTERBOX:"letterBox"},j={UNIVERSAL:"universal",LANDSCAPE:"landscape",PORTRAIT:"portrait"},U=function(t){function e(){var t;return m(this,e),(t=a(this,h(e).call(this))).mName="stage",t.mScaleMode=Y.NORMAL,t.mWidth=960,t.mHeight=640,t.mStageWidth=0,t.mStageHeight=0,t.mStageScaleFactor=0,t.mCacheWidth=0,t.mCacheHeight=0,t.mOrientation=j.UNIVERSAL,t.mOrientationLock=!0,t.mAdded=!0,ei.instance.hasSystem(re)&&t.addComponent(new oe),t}return l(e,G),f(e,[{key:"setSize",value:function(t,e){this.mWidth=t,this.mHeight=e,this.__refresh()}},{key:"onUpdate",value:function(){var t=ei.instance.viewport.size;this.mCacheWidth===t.width&&this.mCacheHeight===t.height||(this.mCacheWidth=t.width,this.mCacheHeight=t.height,this.__refresh())}},{key:"__refresh",value:function(){var t=ei.instance.viewport.size.clone();if(this.mOrientationLock&&this.mOrientation===j.LANDSCAPE&&Yt.isPortrait){var e=[t.height,t.width];t.width=e[0],t.height=e[1]}var i=t.width,n=t.height;if(this.mScaleMode===Y.FIXED){var s=this.LP(i*this.mHeight/n,i*this.mWidth/n),r=this.LP(n*this.mWidth/i,n*this.mHeight/i),a=Math.max(s/i,r/n),o=i*a,h=n*a;this.mStageWidth=o,this.mStageHeight=h,this.mScaleX=this.mScaleY=this.mStageScaleFactor=Math.min(i/o,n/h)}else if(this.mScaleMode===Y.NORMAL)this.mStageWidth=t.width,this.mStageHeight=t.height,this.mScaleX=this.mScaleY=this.mStageScaleFactor=1;else if(this.mScaleMode===Y.LETTERBOX){var l=this.LP(i*this.mHeight/n,i*this.mWidth/n),u=this.LP(n*this.mWidth/i,n*this.mHeight/i),c=Math.max(l/i,u/n),m=i*c,d=n*c,f=2*c;this.mX=m/f-this.LP(this.mWidth,this.mHeight)/f,this.mY=d/f-this.LP(this.mHeight,this.mWidth)/f,this.mStageWidth=this.LP(this.mWidth,this.mHeight),this.mStageHeight=this.LP(this.mHeight,this.mWidth),this.mScaleX=this.mScaleY=this.mStageScaleFactor=Math.min(i/m,n/d)}else this.mScaleMode===Y.NO_SCALE?(this.mStageWidth=t.width*this.dpr,this.mStageHeight=t.height*this.dpr,this.mScaleX=this.mScaleY=this.mStageScaleFactor=1/this.dpr):y.error("Not supported stage scale mode.");this.mStageWidth=Math.round(this.mStageWidth),this.mStageHeight=Math.round(this.mStageHeight),this.mX=Math.round(this.mX),this.mY=Math.round(this.mY),ei.driver.__onResize(null,null),this.setTransformDirty(),this.post(N.RESIZE)}},{key:"LP",value:function(t,e){return this.mOrientation==j.LANDSCAPE?t:this.mOrientation==j.PORTRAIT?e:Yt.isLandscape?t:e}},{key:"getBounds",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0],!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return(t=t||new S).set(-this.mX/this.mStageScaleFactor,-this.mY/this.mStageScaleFactor,this.width+2*this.mX/this.mStageScaleFactor,this.height+2*this.mY/this.mStageScaleFactor)}},{key:"onGetLocalBounds",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;return(t=t||new S).set(0,0,this.mStageWidth,this.mStageHeight)}},{key:"removeFromParent",value:function(){y.error("Not allowed.")}},{key:"orientation",get:function(){return this.mOrientation},set:function(t){this.mOrientation=t,this.__refresh()}},{key:"scaleMode",get:function(){return this.mScaleMode},set:function(t){this.mScaleMode=t,this.__refresh()}},{key:"dpr",get:function(){return Yt.getDevicePixelRatio()}},{key:"scaleFactor",get:function(){return this.mStageScaleFactor}},{key:"renderWidth",get:function(){return this.mStageWidth*this.dpr*this.mStageScaleFactor}},{key:"renderHeight",get:function(){return this.mStageHeight*this.dpr*this.mStageScaleFactor}},{key:"centerX",get:function(){return.5*this.mStageWidth}},{key:"centerY",get:function(){return.5*this.mStageHeight}},{key:"orientationLock",get:function(){return this.mOrientationLock},set:function(t){this.mOrientationLock=t}},{key:"localTransformation",get:function(){this.mLocalTransform.set(this.mScaleX,0,0,this.mScaleY,this.mX,this.mY);var t=0;if(null!=window.orientation)t=window.orientation;else{var e=window.screen.msOrientation||window.screen.mozOrientation||window.screen.orientation&&window.screen.orientation.type||"";17===e.length?t=0:19===e.length?t=180:16===e.length?t=90:18===e.length&&(t=-90)}if(this.mOrientation===j.LANDSCAPE&&Yt.isPortrait){this.mLocalTransform.rotate((t+90)*Math.PI/180);var i=.5*ei.instance.viewport.size.width+.5*this.mStageHeight*this.mStageScaleFactor,n=.5*ei.instance.viewport.size.height-.5*this.mStageWidth*this.mStageScaleFactor;this.mLocalTransform.setTranslation(i,n)}else if(this.mOrientation===j.PORTRAIT&&Yt.isLandscape){this.mLocalTransform.rotate((t+180)*Math.PI/180);var s=.5*ei.instance.viewport.size.width-.5*this.mStageHeight*this.mStageScaleFactor,r=.5*ei.instance.viewport.size.height+.5*this.mStageWidth*this.mStageScaleFactor;this.mLocalTransform.setTranslation(s,r)}return this.mLocalTransform}},{key:"scaleX",set:function(t){y.error("Not allowed.")},get:function(){return 1}},{key:"scaleY",set:function(t){y.error("Not allowed.")},get:function(){return 1}},{key:"pivotOffsetX",set:function(t){y.error("Not allowed.")},get:function(){return 0}},{key:"pivotOffsetY",set:function(t){y.error("Not allowed.")},get:function(){return 0}},{key:"anchorX",set:function(t){y.error("Not allowed.")},get:function(){return 0}},{key:"anchorY",set:function(t){y.error("Not allowed.")},get:function(){return 0}},{key:"x",set:function(t){y.error("Not allowed.")},get:function(){return this.mX/this.mStageScaleFactor}},{key:"y",set:function(t){y.error("Not allowed.")},get:function(){return this.mY/this.mStageScaleFactor}},{key:"rotation",set:function(t){y.error("Not allowed.")},get:function(){return 0}},{key:"width",set:function(t){y.error("Not allowed.")},get:function(){return this.mStageWidth}},{key:"height",set:function(t){y.error("Not allowed.")},get:function(){return this.mStageHeight}},{key:"name",set:function(t){y.error("Not allowed.")},get:function(){return this.mName}}]),e}(),W=function(t){function e(){var t;return m(this,e),(t=a(this,h(e).call(this))).mChanged=!0,t.mCenter=new x,t.mMin=new x,t.mMax=new x,t}return l(e,V),f(e,[{key:"containsPoint",value:function(t){return y.error("Abstract method."),!1}},{key:"refresh",value:function(t,e){}}]),e}(),q=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;m(this,t),this.mId=++t.__ID,this.mNative=e,this.mValid=!1,this.mRegion=new S,this.mUntrimmedRegion=new S,this.mNativeWidth=0,this.mNativeHeight=0,this.mDisplayWidth=0,this.mDisplayHeight=0,this.mRenderWidth=0,this.mRenderHeight=0,this.mScale=s,this.set(e,i,n,s)}return f(t,[{key:"set",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;y.assert(null!=t,"nativeElement cannot be null"),y.assert(!isNaN(n),"scale cannot be NaN"),this.mScale=n,this.mNative=t,this.mNativeWidth=t.naturalWidth||t.videoWidth||t.width,this.mNativeHeight=t.naturalHeight||t.videoHeight||t.height,this.mRegion=e||this.mRegion.set(0,0,this.mNativeWidth,this.mNativeHeight),this.mUntrimmedRegion=i||this.mUntrimmedRegion.set(0,0,this.mRegion.width,this.mRegion.height),this.mDisplayWidth=Math.ceil(this.mUntrimmedRegion.width*this.mScale),this.mDisplayHeight=Math.ceil(this.mUntrimmedRegion.height*this.mScale),this.mRenderWidth=Math.ceil(this.mRegion.width*this.mScale),this.mRenderHeight=Math.ceil(this.mRegion.height*this.mScale),this.mValid=null!=t&&this.mDisplayWidth>0&&this.mDisplayHeight>0}},{key:"width",get:function(){return this.mDisplayWidth}},{key:"height",get:function(){return this.mDisplayHeight}},{key:"scale",get:function(){return this.mScale}},{key:"region",get:function(){return this.mRegion}},{key:"untrimmedRegion",get:function(){return this.mUntrimmedRegion}},{key:"nativeWidth",get:function(){return this.mNativeWidth}},{key:"nativeHeight",get:function(){return this.mNativeHeight}},{key:"displayWidth",get:function(){return this.mDisplayWidth}},{key:"displayHeight",get:function(){return this.mDisplayHeight}},{key:"renderWidth",get:function(){return this.mRenderWidth}},{key:"renderHeight",get:function(){return this.mRenderHeight}},{key:"isValid",get:function(){return this.mValid}},{key:"native",get:function(){return this.mNative}},{key:"id",get:function(){return this.mId}}],[{key:"getScaleFactorFromName",value:function(t){var e=t.indexOf("@");if(-1===e)return 1;var i=t.indexOf("x",e);return parseFloat(t.substring(e+1,i))}},{key:"removeScaleFactorFromName",value:function(t){var e=t.indexOf("@");if(-1===e)return t;var i=t.indexOf("x",e);return t.substring(0,e)+t.substring(i+1)}},{key:"fromBase64String",value:function(e){var i=new Image;return i.src=e,new t(i)}},{key:"fromCanvasAsImage",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image/png",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,s=new Image;return s.src=e.toDataURL(i,n),new t(s)}},{key:"fromCanvas",value:function(t){return ei.driver.getTextureFromCanvas(t)}}]),t}();q.__ID=0,q.MISSING_IMAGE_CACHE=null,q.MAX_SIZE=2048;var Q=function(t){function e(t,i,n){var s;m(this,e);var r=new At(t*n,i*n);return(s=a(this,h(e).call(this,r.native))).set(r.native,null,null,1/n),s.renderTarget=r,s}return l(e,q),f(e,[{key:"resize",value:function(t,e,i){this.renderTarget.resize(t*i,e*i),this.set(this.renderTarget.native,null,null,1/i)}},{key:"__dumpToDocument",value:function(){var t=new Image;t.style.position="fixed",t.style.top="0px",t.style.left="0px",t.style.background="#333",t.style.width="256px",t.style.height="auto",t.style.border="1px solid crimson",t.src=this.mNative.toDataURL("image/png"),document.body.appendChild(t)}}]),e}(),K=function(t){function e(t,i){var n,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return m(this,e),(n=a(this,h(e).call(this,t))).mSubTextures={},n.__parseJson(i,s),n}return l(e,q),f(e,[{key:"__parseJson",value:function(t,e){Math.PI;for(var i in t.frames){var n=t.frames[i],s=new S(n[0],n[1],n[2],n[3]),r=new S(n[4],n[5],n[6],n[7]);this.mSubTextures[i]=new q(this.native,s,r,e)}}},{key:"getTexture",value:function(t){var e=this.mSubTextures[t];return y.assertWarn(void 0!==e,"Texture '".concat(t,"' was not found")),e}},{key:"getTextures",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||[];if(null===t){for(var n in this.mSubTextures)i.push(this.mSubTextures[n]);return i}var s=[],r=new RegExp("^"+t.split("*").join(".*")+"$");for(var a in this.mSubTextures)r.test(a)&&s.push(a);e.naturalSort(s);for(var o=0;o<s.length;o++)i.push(this.mSubTextures[s[o]]);return i}},{key:"subTextures",get:function(){return this.mSubTextures}}],[{key:"naturalSort",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;t.sort(e.__naturalComparer(i))}},{key:"__naturalComparer",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function(i,n){for(var s=/(-?\d*\.?\d+)/g,r=String(null==t?i:i[t]).split(s),a=String(null==t?n:n[t]).split(s),o=Math.min(r.length,a.length),h=0;h<o;h++){var l=0,u=0;if(e?(l=Math.abs(parseFloat(r[h]))||r[h].toLowerCase(),u=Math.abs(parseFloat(a[h]))||a[h].toLowerCase()):(l=parseFloat(r[h])||r[h].toLowerCase(),u=parseFloat(a[h])||a[h].toLowerCase()),l<u)return-1;if(l>u)return 1}return 0}}}]),e}(),Z=function(t){function e(t){var i;return m(this,e),(i=a(this,h(e).call(this))).mUrl=t,i.mData=null,i.mIsLoaded=!1,i.mOwner=null,i}return l(e,M),f(e,[{key:"load",value:function(){}},{key:"abort",value:function(){}},{key:"onLoad",value:function(){this.mIsLoaded=!0,this.post(N.COMPLETE)}},{key:"onError",value:function(){this.mIsLoaded=!1,this.post(N.ERROR)}},{key:"data",get:function(){return this.mData}},{key:"owner",get:function(){return this.mOwner}}]),e}(),J=function(t){function e(t){var i;return m(this,e),(i=a(this,h(e).call(this,t))).mImageElement=new Image,i.mImageElement.crossOrigin="anonymous",i}return l(e,Z),f(e,[{key:"load",value:function(){var t=this;this.mImageElement.src=this.mUrl,this.mImageElement.onload=function(){t.onLoad()},this.mImageElement.onerror=function(){t.onError()},this.mData=this.mImageElement}},{key:"abort",value:function(){this.mImageElement.onload=this.mImageElement.onabort=this.mImageElement.onerror=function(){},this.mImageElement.src=e.ALT_URL}}]),e}();J.ALT_URL="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAA5JREFUeNpiYmBgAAgwAAAMAAMjcmNcAAAAAElFTkSuQmCC";var $=function(t){function e(t){var i;return m(this,e),(i=a(this,h(e).call(this,t))).mRequest=new XMLHttpRequest,i.mimeType=void 0,i.responseType="",i}return l(e,Z),f(e,[{key:"load",value:function(){var t=this;this.mRequest.open("GET",this.mUrl,!0),""!=this.responseType&&(this.mRequest.responseType=this.responseType),void 0!=this.mRequest.overrideMimeType&&this.mimeType&&this.mRequest.overrideMimeType(this.mimeType),this.mRequest.onreadystatechange=function(){4===t.mRequest.readyState&&(200===t.mRequest.status||0===t.mRequest.status&&t.mRequest.responseText?(""===t.responseType||"text"===t.responseType?t.mData=t.mRequest.responseText:t.mData=t.mRequest.response,t.onLoad()):t.onError())},this.mRequest.send(null)}},{key:"abort",value:function(){this.mRequest.abort()}}]),e}(),tt=function(t){function e(t,i,n){var s;return m(this,e),(s=a(this,h(e).call(this,i))).mName=t,s.mTestingFontName="Courier New",s.mIsLocal=n,s.mTestingString="~ GHBDTN,.#$Mlck",s.mCheckDelay=50,s.mTestingElement=s.__getTestingElement(),s.metrics=null,s.mLoaderElement=s.__getLoaderElement(s.mIsLocal),s.mTestingElement.style.fontFamily=s.mTestingFontName,s.mDefaultFontWidth=s.mTestingElement.offsetWidth,s.mTestingElement.style.fontFamily=t+","+s.mTestingFontName,s.mTimeoutHandle=-1,s}return l(e,Z),f(e,[{key:"load",value:function(){this.mIsLocal?this.mLoaderElement.innerHTML+="\n @font-face {font-family: ".concat(this.mName,"; src: url(").concat(this.mUrl,");}"):this.mLoaderElement.href=this.mUrl,this.__checkLoadingStatus()}},{key:"abort",value:function(){clearTimeout(this.mTimeoutHandle),this.mTestingElement.parentNode.removeChild(this.mTestingElement)}},{key:"__getLoaderElement",value:function(t){var e=this,i=document.createElement(t?"style":"link");return i.type="text/css",i.media="all",i.rel="stylesheet",i.onerror=function(){e.onError()},document.getElementsByTagName("head")[0].appendChild(i),i}},{key:"__getTestingElement",value:function(){var t=document.createElement("span");return t.style.position="absolute",t.style.top="-9999px",t.style.left="-9999px",t.style.visibility="hidden",t.style.fontSize="250px",t.innerHTML=this.mTestingString,document.body.appendChild(t),t}},{key:"__checkLoadingStatus",value:function(){this.mDefaultFontWidth!==this.mTestingElement.offsetWidth?(this.metrics=L.get(this.mName),this.mTestingElement.parentNode.removeChild(this.mTestingElement),this.onLoad()):this.mTimeoutHandle=setTimeout(this.__checkLoadingStatus.bind(this),this.mCheckDelay)}}]),e}(),et=function(t){function e(t){var i;return m(this,e),(i=a(this,h(e).call(this))).mName=t,i.mData=null,i.mLoaders=[],i.mNumLoaded=0,i.mIsReady=!1,i}return l(e,M),f(e,[{key:"addLoader",value:function(t){t.mOwner=this,this.mLoaders.push(t),t.on(N.COMPLETE,this.__onLoaderComplete,this),t.on(N.ERROR,this.__onLoaderError,this)}},{key:"__onLoaderComplete",value:function(t){if(this.mNumLoaded++,this.mNumLoaded===this.mLoaders.length){for(var e=0;e<this.mLoaders.length;e++)this.mLoaders[e].off(N.COMPLETE,N.ERROR);this.onAllLoaded()}}},{key:"__onLoaderError",value:function(t){this.abort(),this.post(N.ERROR)}},{key:"onAllLoaded",value:function(){}},{key:"abort",value:function(){this.mNumLoaded=0;for(var t=0;t<this.mLoaders.length;t++){var e=this.mLoaders[t];e.off(N.COMPLETE,N.ERROR),e.abort()}}},{key:"ready",value:function(t){this.mData=t,this.mIsReady=!0,this.post(N.COMPLETE)}},{key:"name",get:function(){return this.mName}},{key:"data",get:function(){return this.mData}},{key:"isReady",get:function(){return this.mIsReady}},{key:"loaders",get:function(){return this.mLoaders}}]),e}(),it=function(t){function e(t,i){var n;return m(this,e),(n=a(this,h(e).call(this,t))).mScale=1/q.getScaleFactorFromName(i),n.mImageLoader=new J(i),n.addLoader(n.mImageLoader),n}return l(e,et),f(e,[{key:"onAllLoaded",value:function(){r(h(e.prototype),"ready",this).call(this,new q(this.mImageLoader.data,null,null,this.mScale))}}]),e}(),nt=function(t){function e(t,i){var n;return m(this,e),(n=a(this,h(e).call(this,t))).mXHR=new $(i),n.mXHR.mimeType="application/json",n.addLoader(n.mXHR),n}return l(e,et),f(e,[{key:"onAllLoaded",value:function(){r(h(e.prototype),"ready",this).call(this,JSON.parse(this.mXHR.data))}}]),e}(),st=function(t){function e(t,i){var n;return m(this,e),(n=a(this,h(e).call(this,t))).mXHR=new $(i),n.mXHR.mimeType="text/xml",n.addLoader(n.mXHR),n}return l(e,et),f(e,[{key:"onAllLoaded",value:function(){r(h(e.prototype),"ready",this).call(this,(new DOMParser).parseFromString(this.mXHR.data,"text/xml"))}}]),e}(),rt=function(t){function e(t,i,n){var s;return m(this,e),s=a(this,h(e).call(this,t)),!1===n&&(i="https://fonts.googleapis.com/css?family="+t.replace(new RegExp(" ","g"),"+")),s.mLoader=new tt(t,i,n),s.addLoader(s.mLoader),s}return l(e,et),f(e,[{key:"onAllLoaded",value:function(){r(h(e.prototype),"ready",this).call(this)}}]),e}(),at=function(t){function e(t,i,n){var s;return m(this,e),(s=a(this,h(e).call(this,t))).mScale=1/q.getScaleFactorFromName(i),s.mImageLoader=new J(i),s.mXHR=new $(n),s.mXHR.mimeType="application/json",s.addLoader(s.mImageLoader),s.addLoader(s.mXHR),s}return l(e,et),f(e,[{key:"onAllLoaded",value:function(){r(h(e.prototype),"ready",this).call(this,new K(this.mImageLoader.data,JSON.parse(this.mXHR.data),this.mScale))}}]),e}(),ot=function(t){function e(t,i,n){var s;return m(this,e),(s=a(this,h(e).call(this,t))).mScale=1/q.getScaleFactorFromName(i),s.mImageLoader=new J(i),s.mXHR=new $(n),s.mXHR.mimeType="text/xml",s.addLoader(s.mImageLoader),s.addLoader(s.mXHR),s}return l(e,et),f(e,[{key:"onAllLoaded",value:function(){var t=(new DOMParser).parseFromString(this.mXHR.data,"text/xml"),i=new q(this.mImageLoader.data,null,null,this.mScale);r(h(e.prototype),"ready",this).call(this,e.parse(t,i))}}],[{key:"parse",value:function(t,e){var i=new ht;i.texture=e,i.xml=t;var n=t.getElementsByTagName("info")[0],s=t.getElementsByTagName("common")[0];i.name=n.getAttribute("face"),i.size=parseInt(n.getAttribute("size"),10),i.lineHeight=parseInt(s.getAttribute("lineHeight"),10),i.baseline=parseInt(s.getAttribute("base"),10),i.chars={};for(var r=t.getElementsByTagName("char"),a=0;a<r.length;a++){var o=r[a],h=parseInt(o.getAttribute("id"),10),l=parseInt(o.getAttribute("x"),10)+e.region.x,u=parseInt(o.getAttribute("y"),10)+e.region.y,c=parseInt(o.getAttribute("width"),10),m=parseInt(o.getAttribute("height"),10),d=parseInt(o.getAttribute("xoffset"),10),f=parseInt(o.getAttribute("yoffset"),10),y=parseInt(o.getAttribute("xadvance"),10),v=new S(l,u,c,m),p=new lt;p.texture=new q(e.native,v),p.xOffset=d,p.yOffset=f,p.width=c,p.height=m,p.xAdvance=y,i.chars[h]=p}for(var g=t.getElementsByTagName("kerning"),k=0;k<g.length;k++){var b=g[k],w=parseInt(b.getAttribute("first"),10),_=parseInt(b.getAttribute("second"),10),x=parseInt(b.getAttribute("amount"),10);i.chars[_]&&(i.chars[_].kerning[w]=x)}return i}}]),e}(),ht=function t(){m(this,t),this.texture=null,this.xml=null,this.name="",this.size=0,this.lineHeight=0,this.chars={},this.baseline=0},lt=function t(){m(this,t),this.texture=null,this.xOffset=0,this.yOffset=0,this.width=0,this.height=0,this.xAdvance=0,this.kerning={}},ut=function(t){function e(t,i){var n;return m(this,e),n=a(this,h(e).call(this,t)),!1===Yt.webAudioSupported?a(n):!1===ei.instance.hasSystem(ce)?(y.warn("[SoundAsset] Loading sound files without MasterAudio system."),a(n)):(n.mXHR=new $(i),n.mXHR.responseType="arraybuffer",n.addLoader(n.mXHR),n)}return l(e,et),f(e,[{key:"onAllLoaded",value:function(){var t=this,i=this.mXHR.data;ce.context.decodeAudioData(i,function(i){r(h(e.prototype),"ready",t).call(t,new ve(i))})}}]),e}(),ct=function(t){function e(t,i,n){var s;return m(this,e),s=a(this,h(e).call(this,t)),!1===Yt.webAudioSupported?a(s):!1===ei.instance.hasSystem(ce)?(y.warn("[SoundAsset] Loading sound files without MasterAudio system."),a(s)):(s.mAudioXHR=new $(i),s.mAudioXHR.responseType="arraybuffer",s.addLoader(s.mAudioXHR),s.mDataXHR=new $(n),s.mDataXHR.mimeType="application/json",s.mDataXHR.responseType="json",s.addLoader(s.mDataXHR),s)}return l(e,et),f(e,[{key:"onAllLoaded",value:function(){var t=this,i=this.mAudioXHR.data;ce.context.decodeAudioData(i,function(i){r(h(e.prototype),"ready",t).call(t,new pe(i,t.mDataXHR.data))})}}]),e}(),mt=function(t){function e(t,i,n,s,r){var o;return m(this,e),(o=a(this,h(e).call(this,t))).mBakeSelf=n,o.mBakeChildren=s,o.mNamesToBake=s&&r?r:[],o.mGraphicsData=null,o.mXHR=new $(i),o.mXHR.mimeType="application/json",o.addLoader(o.mXHR),o}return l(e,et),f(e,[{key:"onAllLoaded",value:function(){var t=JSON.parse(this.mXHR.data),i=new Je;this.mGraphicsData=i.parse(t),this.mGraphicsData.name=this.name,r(h(e.prototype),"ready",this).call(this,this.mGraphicsData)}},{key:"bakeTextures",value:function(){var t={},e=this.mNamesToBake;if(this.mBakeChildren&&0===e.length){!function t(i){if(0!==i.length)for(var n=0,s=i.length;n<s;n++)i[n].name&&e.push(i[n].name),t(i[n].mNodes)}(this.mGraphicsData.mNodes)}this.mBakeSelf&&e.unshift(this.mGraphicsData.name);for(var i=0,n=e.length;i<n;i++){var s=e[i],r=this.mGraphicsData.searchNode(s);if(r){var a=new Mt(r,s!==this.mGraphicsData.name),o=new Q(a.width,a.height,ei.driver.renderScaleFactor);ei.driver.render(a,o,new C),t[s]=o}else y.warn("[BVGAsset] GraphicsData node with id '".concat(s,"' not found."))}return t}}]),e}(),dt={NONE:"none",LOADING:"loading",FINISHED:"finished"},ft=function(t){function e(){var t;return m(this,e),(t=a(this,h(e).call(this))).mDefaultPath="",t.mTotalLoaded=0,t.mTotalPending=0,t.mTotalErrors=0,t.mIsAllLoaded=!1,t.mLoadingProgress=0,t.mQueue=[],t.mLoadersQueue=[],t.mTextures={},t.mGraphicsData={},t.mVectorTextures={},t.mAtlases={},t.mJsons={},t.mXMLs={},t.mSounds={},t.mSoundAtlases={},t.mFonts={},t.mBitmapFonts={},t.mState=dt.NONE,t.mDictionary={},t}return l(e,M),f(e,[{key:"addTexture",value:function(t,e){this.mTextures[t]=e}},{key:"enqueueImage",value:function(t,e){this.__validateState(),this.__validateName(t),this.mQueue.push(new it(t,this.mDefaultPath+e))}},{key:"enqueueAtlas",value:function(t,e,i){this.__validateState(),this.__validateName(t),this.mQueue.push(new at(t,this.mDefaultPath+e,this.mDefaultPath+i))}},{key:"enqueueBitmapFont",value:function(t,e,i){this.__validateState(),this.__validateName(t),this.mQueue.push(new ot(t,this.mDefaultPath+e,this.mDefaultPath+i))}},{key:"enqueueXML",value:function(t,e){this.__validateState(),this.__validateName(t),this.mQueue.push(new st(t,this.mDefaultPath+e))}},{key:"enqueueJSON",value:function(t,e){this.__validateState(),this.__validateName(t),this.mQueue.push(new nt(t,this.mDefaultPath+e))}},{key:"enqueueVector",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.__validateState(),this.__validateName(t),this.mQueue.push(new mt(t,this.mDefaultPath+e,i,n,s))}},{key:"enqueueSound",value:function(t,e){this.__validateState(),this.__validateName(t),this.mQueue.push(new ut(t,this.mDefaultPath+e))}},{key:"enqueueSoundAtlas",value:function(t,e,i){this.__validateState(),this.__validateName(t),this.mQueue.push(new ct(t,this.mDefaultPath+e,this.mDefaultPath+i))}},{key:"enqueueFont",value:function(t,e){this.__validateState(),this.__validateName(t),this.mQueue.push(new rt(t,this.mDefaultPath+e,!0))}},{key:"enqueueGoogleFont",value:function(t){this.__validateState(),this.__validateName(t),this.mQueue.push(new rt(t,"",!1))}},{key:"loadQueue",value:function(){this.__validateState(),this.mState=dt.LOADING;for(var t=0;t<this.mQueue.length;t++){var e,i=this.mQueue[t];if(i.loaders.length>0)i.on(N.COMPLETE,this.onAssetLoaded,this),i.on(N.ERROR,this.onAssetError,this),(e=this.mLoadersQueue).push.apply(e,c(i.loaders)),this.mTotalPending++}for(var n=0;n<this.mLoadersQueue.length;n++){this.mLoadersQueue[n].load()}}},{key:"onAssetLoaded",value:function(t){var e=this;this.mTotalLoaded++,this.mLoadingProgress=this.mTotalLoaded/this.mTotalPending;var i=t.sender;if(i.off(N.COMPLETE,N.ERROR),i.constructor===it)this.mTextures[i.name]=i.data;else if(i.constructor===at)this.mAtlases[i.name]=i.data;else if(i.constructor===nt)this.mJsons[i.name]=i.data;else if(i.constructor===ut)this.mSounds[i.name]=i.data;else if(i.constructor===ct)this.mSoundAtlases[i.name]=i.data;else if(i.constructor===rt)this.mFonts[i.name]=i.data;else if(i.constructor===st)this.mXMLs[i.name]=i.data;else if(i.constructor===ot)this.mBitmapFonts[i.name]=i.data;else if(i.constructor===mt){this.mGraphicsData[i.name]=i.data;var n=i.bakeTextures();Object.keys(n).forEach(function(t){return t!==i.name&&e.__validateName(t)}),Object.assign(this.mVectorTextures,n)}else y.error("[AssetManager] Unable to handle asset type ".concat(i,"."));this.post(N.PROGRESS,this.mLoadingProgress),this.mTotalLoaded===this.mTotalPending&&(this.mQueue.splice(0,this.mQueue.length),this.mLoadersQueue.splice(0,this.mLoadersQueue.length),this.mState=dt.FINISHED,this.mTotalLoaded=0,this.mTotalErrors=0,this.mIsAllLoaded=!0,this.mDictionary={},this.post(N.COMPLETE))}},{key:"onAssetError",value:function(t){this.mTotalErrors++;var e=this.mTotalLoaded+this.mTotalErrors;this.mLoadingProgress=this.mTotalLoaded/this.mTotalPending;var i=t.sender;i.off(N.COMPLETE,N.ERROR),y.warn("[AssetManager] Error loading asset '".concat(i.name,"'.")),this.post(N.ERROR,i),e===this.mTotalPending&&(this.mQueue.splice(0,this.mQueue.length),this.mLoadersQueue.splice(0,this.mLoadersQueue.length),this.mState=dt.FINISHED,this.mTotalLoaded=0,this.mTotalErrors=0,this.mIsAllLoaded=!0,this.mDictionary={},this.post(N.COMPLETE))}},{key:"getBitmapFont",value:function(t){var e=this.mBitmapFonts[t];return null!=e?e:(y.warn("[AssetManager] BitmapFontData '".concat(t,"' was not found.")),null)}},{key:"getTexture",value:function(t){var e=this.mTextures[t]||this.mVectorTextures[t];if(null!=e)return e;for(var i in this.mAtlases)if(e=this.mAtlases[i].subTextures[t])return e;return y.warn("[AssetManager] Texture '".concat(t,"' was not found.")),null}},{key:"getGraphicsData",value:function(t){var e=this.mGraphicsData[t];if(e)return e;for(var i in this.mGraphicsData)if(e=this.mGraphicsData[i].searchNode(t))return e;return y.warn("[AssetManager] GraphicsData '".concat(t,"' was not found.")),null}},{key:"getTextures",value:function(t){var e=[],i=[],n=new RegExp("^"+t.split("*").join(".*")+"$");for(var s in this.mTextures)n.test(s)&&i.push({name:s,atlas:null});for(var r in this.mAtlases){var a=this.mAtlases[r];for(var o in a.subTextures)n.test(o)&&i.push({name:o,atlas:a})}K.naturalSort(i,"name");for(var h=0;h<i.length;h++){var l=i[h];null==l.atlas?e.push(this.mTextures[l.name]):e.push(l.atlas.mSubTextures[l.name])}return e.length>0?e:null}},{key:"getAtlas",value:function(t){return null!=this.mAtlases[t]?this.mAtlases[t]:(y.warn("[AssetManager] Atlas '".concat(t,"' was not found.")),null)}},{key:"getSound",value:function(t){var e=this.mSounds[t];if(null!=e)return e;for(var i in this.mSoundAtlases)if(null!=(e=this.mSoundAtlases[i].subSounds[t]))return e;return y.warn("[AssetManager] Sound '".concat(t,"' was not found.")),null}},{key:"getSoundAtlas",value:function(t){return this.mSoundAtlases[t]}},{key:"getJSON",value:function(t){return this.mJsons[t]}},{key:"__validateState",value:function(){y.assert(this.mState===dt.NONE||this.mState===dt.FINISHED,"Illegal state.")}},{key:"__validateName",value:function(t){y.assert(null==this.mDictionary[t],"Asset with such name is already added."),this.mDictionary[t]=!0}},{key:"defaultPath",get:function(){return this.mDefaultPath},set:function(t){this.mDefaultPath=t}},{key:"isAllLoaded",get:function(){return this.mIsAllLoaded}},{key:"numErrors",get:function(){return this.mTotalErrors}},{key:"state",get:function(){return this.mState}},{key:"path",get:function(){return"AssetManager"}}]),e}();ft.default=new ft;var yt={AUTO:"auto",NORMAL:"normal",ADD:"add",MULTIPLY:"multiply",SCREEN:"screen",OVERLAY:"overlay",DARKEN:"darken",LIGHTEN:"lighten",COLOR_DODGE:"colorDodge",COLOR_BURN:"colorBurn",HARD_LIGHT:"hardLight",SOFT_LIGHT:"softLight",DIFFERENCE:"difference",EXCLUSION:"exclusion",HUE:"hue",SATURATE:"saturate",COLOR:"color",LUMINOSITY:"luminosity",MASK:"mask",MASK_INV:"maskInv"},vt={auto:"auto",normal:"source-over",add:"lighter",multiply:"multiply",screen:"screen",overlay:"overlay",darken:"darken",lighten:"lighten",colorDodge:"color-dodge",colorBurn:"color-burn",hardLight:"hard-light",softLight:"soft-light",difference:"difference",exclusion:"exclusion",due:"hue",saturate:"saturate",color:"color",luminosity:"luminosity",mask:"source-in",maskInv:"source-out"},pt=function(){function t(){m(this,t),this.gameObject=null,this.parent=null,this.skipChildren=!1,this.skipSelf=!1,this.endPassRequired=!1,this.endPassRequiredAt=-1,this.alpha=1,this.blendMode=yt.NORMAL,this.color=null}return f(t,[{key:"preRender",value:function(t,e){this.endPassRequired=null!==this.gameObject.mClipRect&&!1===this.gameObject.mClipRect.isEmpty,this.skipChildren=!(this.gameObject.mAlpha>0&&!0===this.gameObject.mVisible),this.skipSelf=this.skipChildren}},{key:"begin",value:function(t,e){this.alpha=this.gameObject.mAlpha*this.parent.alpha,this.color=null===this.gameObject.mColor?this.parent.color:this.gameObject.mColor,this.blendMode=this.gameObject.mBlendMode===yt.AUTO?this.parent.blendMode:this.gameObject.mBlendMode}},{key:"upload",value:function(t,e){var i=this.gameObject,n=i.worldTransformation;t.setSnapToPixels(i.snapToPixels),t.setGlobalAlpha(this.alpha),t.setGlobalBlendMode(this.blendMode),t.setTransform(n),!0===this.endPassRequired&&t.beginClip(i.mClipRect,i.mPivotX,i.mPivotY)}},{key:"render",value:function(t,e){}},{key:"end",value:function(t,e){t.endClip(),this.endPassRequiredAt=-1,this.endPassRequired=!1}}],[{key:"getColoredTexture",value:function(e,i){if(16777215===i||null===i)return e;var n=i.toString();if(t.__colorCache.has(e.id,n))return t.__colorCache.get(e.id,n);var s=e.region,r=s.width,a=s.height,o=new At(r,a),h=o.context;h.fillStyle=w.hexColorToString(i),h.fillRect(0,0,r,a),h.globalCompositeOperation="multiply",h.drawImage(e.native,s.x,s.y,s.width,s.height,0,0,s.width,s.height),h.globalCompositeOperation="destination-atop",h.drawImage(e.native,s.x,s.y,s.width,s.height,0,0,s.width,s.height);var l=new q(o.native,null,e.untrimmedRegion.clone(),e.scale);return t.__colorCache.set(e.id,n,l),l}}]),t}();pt.__colorCache=new p,pt.__dirty=!0,pt.skipUnchangedFrames=!1;var gt=function(){function t(){m(this,t),this.parentRenderers=[],this.endPassParentRenderers=[],this.isBackBufferActive=!0,this.customTransform=null,this.isMasking=!1}return f(t,[{key:"reset",value:function(){this.parentRenderers.splice(0,this.parentRenderers.length),this.endPassParentRenderers.splice(0,this.endPassParentRenderers.length),this.isBackBufferActive=!0,this.customTransform=null}}]),t}(),kt=function(t){function e(){var t;return m(this,e),(t=a(this,h(e).call(this))).texture=null,t.mTransformCache=new C,t.mTransform=null,t.mUseTransformCache=!1,t.mCanvas=document.createElement("canvas"),t.mContext=t.mCanvas.getContext("2d"),t.mContext.lineJoin="round",t.mContext.miterLimit=2,t.mMetrics=null,t}return l(e,pt),f(e,[{key:"preRender",value:function(t,e){this.skipChildren=!(this.gameObject.mAlpha>0&&!0===this.gameObject.mVisible),this.skipSelf=!0===this.skipChildren}},{key:"upload",value:function(t,e){var i=this.gameObject;i.mDirty&z.RENDER_CACHE&&(i.onGetLocalBounds(),this.mMetrics=i.mMetrics),(i.mDirty&z.RENDER_CACHE||i.mDirty&z.RENDER)&&this.updateTransform(),this.mTransform=!0===this.mUseTransformCache?this.mTransformCache:this.gameObject.worldTransformation,t.setSnapToPixels(i.snapToPixels),t.setTransform(this.mTransform),t.setGlobalAlpha(this.alpha),t.setGlobalBlendMode(this.blendMode),!0===this.endPassRequired&&t.beginClip(i.mClipRect,i.mPivotX,i.mPivotY)}},{key:"renderSegment",value:function(t,e,i,n,s,r){var a=this.gameObject,o=s.baselineNormalized*e.style.size;!0===r?(i.lineWidth=e.style.strokeThickness,i.strokeStyle=w.hexColorToString(e.style.strokeColor)):i.fillStyle=w.hexColorToString(e.style.color),i.font="".concat(e.style.weight," ").concat(e.style.style," ").concat(e.style.size,"px ").concat(e.style.family);var h=e.bounds.x-Math.min(t.strokeBounds.x,t.shadowBounds.x),l=o+e.bounds.y-Math.min(t.strokeBounds.y,t.shadowBounds.y);h+=a.padding.x,l+=a.padding.y,"center"===a.align?h+=.5*t.bounds.width-.5*t.lineWidth[e.lineIndex]:"right"===a.align&&(h+=t.bounds.width-t.lineWidth[e.lineIndex]),!0===r?i.strokeText(e.text,h,l):i.fillText(e.text,h,l)}},{key:"render",value:function(t,e){var i=this.gameObject;if(!0===i.mHighQuality&&i.mDirty&z.RENDER&&(i.mDirty^=z.RENDER,i.mDirty|=z.RENDER_CACHE),i.mDirty&z.RENDER_CACHE){i.mDirty^=z.RENDER_CACHE;var n=this.mCanvas,s=this.mContext,r=1;if(s.textBaseline="alphabetic",!0===i.mHighQuality){var a=this.mTransform.data,o=Math.sqrt(a[0]*a[0]+a[2]*a[2]),h=Math.sqrt(a[1]*a[1]+a[3]*a[3]);r=Math.max(o,h)*t.mDPR}var l=this.mMetrics.strokeBounds.clone();l.scale(r,r),l.union(this.mMetrics.shadowBounds),l.inflate(i.padding.right,i.padding.bottom),n.width=l.width,n.height=l.height;var u=L.get(i.mDefaultStyle.family),c=this.mMetrics.segments;s.save(),s.scale(r,r);for(var m=0;m<c.length;m++)c[m].style.dropShadow&&(s.save(),s.shadowColor=w.intToRGBA(c[m].style.shadowColor,c[m].style.shadowAlpha),s.shadowBlur=c[m].style.shadowBlur,s.shadowOffsetX=c[m].style.shadowDistanceX,s.shadowOffsetY=c[m].style.shadowDistanceY,this.renderSegment(this.mMetrics,c[m],s,t,u,!1),s.restore());for(var d=0;d<c.length;d++){var f=c[d];f.style.strokeThickness>0&&(s.lineJoin="round",s.miterLimit=2,this.renderSegment(this.mMetrics,f,s,t,u,!0))}for(var y=0;y<c.length;y++)this.renderSegment(this.mMetrics,c[y],s,t,u,!1);s.restore(),null===this.texture?this.texture=new q(n,null,null,1/r):this.texture.set(n,null,null,1/r)}}},{key:"updateTransform",value:function(){var t=this.gameObject,e=t.worldTransformation,i=0,n=0,s=Math.min(this.mMetrics.strokeBounds.x,this.mMetrics.shadowBounds.x),r=Math.min(this.mMetrics.strokeBounds.y,this.mMetrics.shadowBounds.y),a=0!==s||0!==r;!1===t.mAutoSize&&("center"===t.align?i=.5*(t.mFieldWidth-this.mMetrics.bounds.width):"right"===t.align&&(i=t.mFieldWidth-this.mMetrics.bounds.width),"middle"===t.mVerticalAlign?n=.5*(t.mFieldHeight-this.mMetrics.bounds.height):"bottom"===t.mVerticalAlign&&(n=t.mFieldHeight-this.mMetrics.bounds.height)),!0===a||!1===t.mAutoSize?(this.mUseTransformCache=!0,e.copyTo(this.mTransformCache),this.mTransformCache.translate(s+i-t.padding.x,r+n-t.padding.y)):!1===t.padding.isEmpty?(this.mUseTransformCache=!0,e.copyTo(this.mTransformCache),this.mTransformCache.translate(-t.padding.x,-t.padding.y)):this.mUseTransformCache=!1}}]),e}(),bt=function(t){function e(){var t;return m(this,e),(t=a(this,h(e).call(this))).mCanvas=document.createElement("canvas"),t.mContext=t.mCanvas.getContext("2d"),t.texture=null,t}return l(e,pt),f(e,[{key:"render",value:function(t,e){var i=this.gameObject;if(null!==i.mText&&i.mDirty&z.RENDER_CACHE){var n=this.mCanvas,s=this.mContext,r=i.mData,a=i.mText,o=i.onGetLocalBounds();i.mDirty^=z.RENDER_CACHE;var h=-1,l=0,u=0;n.width=o.width,n.height=o.height;for(var c=0;c<a.length;c++){var m=a.charCodeAt(c);if(/(?:\r\n|\r|\n)/.test(a.charAt(c)))l=0,u+=r.lineHeight*i.mLineHeight,h=-1;else{var d=r.chars[m];if(null!=d){var f=d.texture;h>=0&&d.kerning[h]&&(l+=d.kerning[h]);var y=f.width,v=f.height,p=f.untrimmedRegion.x+d.xOffset+l,g=f.untrimmedRegion.y+d.yOffset+u;s.drawImage(f.native,f.region.x,f.region.y,y,v,~~p,~~g,y,v),l+=d.xAdvance,h=m}}}null===this.texture?this.texture=new q(n):this.texture.set(n)}}}]),e}(),wt=function(){function t(e,i){m(this,t),this.mWidth=Math.ceil(e),this.mHeight=Math.ceil(i)}return f(t,[{key:"resize",value:function(t,e){this.mWidth=t,this.mHeight=e}},{key:"clear",value:function(){}},{key:"width",get:function(){return this.mWidth},set:function(t){this.mWidth=t}},{key:"height",get:function(){return this.mHeight},set:function(t){this.mHeight=t}}]),t}(),_t=function(t){function e(){return m(this,e),a(this,h(e).call(this))}return l(e,pt),e}(),xt=function(t){function e(){var t;return m(this,e),(t=a(this,h(e).call(this))).mCacheAsBitmapDirty=!0,t.mCacheAsBitmapMatrixCache=null,t.mCacheTexture=null,t.mCacheBounds=null,t.mIsClipped=!1,t.mIsCached=!1,t.mBakeInvertedMatrix=null,t}return l(e,pt),f(e,[{key:"preRender",value:function(t,e){var i=this.gameObject;if(this.mIsClipped=null!==i.mClipRect&&!1===i.mClipRect.isEmpty,this.endPassRequired=this.mIsClipped,!0===i.mCacheAsBitmap)if(!1===i.mCacheAsBitmapDynamic)!1===this.mIsCached?(this.mIsCached=!0,i.setTransformDirty(),this.__refreshBitmapCache(),this.mCacheAsBitmapDirty=!1,this.endPassRequired=!1):i.mDirty|=z.RENDER;else{var n=i.checkStatic(!0);!0===n&&!0===this.mCacheAsBitmapDirty?(i.setTransformDirty(),this.__refreshBitmapCache(),this.mCacheAsBitmapDirty=!1,this.endPassRequired=!1):!1===n&&(this.mCacheAsBitmapDirty=!0,i.mDirty|=z.RENDER)}this.skipChildren=!0===i.mCacheAsBitmap&&!1===this.mCacheAsBitmapDirty,this.skipSelf=!1,!0===this.skipChildren&&(this.endPassRequired=!1,this.skipSelf=!0)}},{key:"begin",value:function(t,e){var i=this.gameObject;!0===this.skipChildren&&!0===e.isBackBufferActive?(this.alpha=1,this.blendMode=yt.NORMAL,this.color=null,this.skipSelf=i.mAlpha<=0||!1===i.mVisible):(this.alpha=i.mAlpha*this.parent.alpha,this.color=null===i.mColor?this.parent.color:i.mColor,this.blendMode=i.mBlendMode===yt.AUTO?this.parent.blendMode:i.mBlendMode,this.skipChildren=i.mAlpha<=0||!1===i.mVisible,this.skipSelf=!0===this.skipChildren||!1===this.mIsClipped)}},{key:"upload",value:function(t,e){var i=this.gameObject,n=i.worldTransformation;!0===this.skipChildren&&(n=this.mCacheAsBitmapMatrixCache,!1===i.mCacheAsBitmapDynamic&&(n=(new C).append(this.gameObject.worldTransformation).append(this.mBakeInvertedMatrix).append(this.mCacheAsBitmapMatrixCache))),!0!==this.skipChildren&&!0!==this.endPassRequired||(t.setSnapToPixels(i.snapToPixels),t.setTransform(n),t.setGlobalAlpha(this.alpha),t.setGlobalBlendMode(this.blendMode)),!0===this.endPassRequired&&t.beginClip(i.mClipRect,i.mPivotX,i.mPivotY)}},{key:"render",value:function(t,e){!0===this.skipChildren&&!0===e.isBackBufferActive&&t.drawTexture(this.mCacheTexture)}},{key:"__refreshBitmapCache",value:function(){var t=this.gameObject.getBounds(ei.stage,!0),e=ei.stage.scaleFactor,i=ei.driver.finalScale,n=C.pool.get();n.set(1,0,0,1,~~(-t.x*e-ei.stage.mX),~~(-t.y*e-ei.stage.mY)),!0===this.mIsClipped&&!0===this.skipChildren&&(n.data[4]+=this.gameObject.mPivotX*e,n.data[5]+=this.gameObject.mPivotY*e),null===this.mCacheBounds&&(this.mCacheBounds=new S),t.copyTo(this.mCacheBounds),t.width*=i,t.height*=i,null===this.mCacheTexture?this.mCacheTexture=new Q(t.width,t.height,1):this.mCacheTexture.resize(t.width,t.height,1),ei.driver.render(this.gameObject,this.mCacheTexture,n),C.pool.release(n),null===this.mCacheAsBitmapMatrixCache&&(this.mCacheAsBitmapMatrixCache=new C),this.mCacheAsBitmapMatrixCache.copyFrom(n),this.mCacheAsBitmapMatrixCache.scale(1/ei.driver.renderScaleFactor,1/ei.driver.renderScaleFactor),this.mCacheAsBitmapMatrixCache.data[4]=-this.mCacheAsBitmapMatrixCache.data[4],this.mCacheAsBitmapMatrixCache.data[5]=-this.mCacheAsBitmapMatrixCache.data[5],this.mBakeInvertedMatrix=this.gameObject.worldTransformation.clone().invert()}}]),e}(),Ct=function(t){function e(){return m(this,e),a(this,h(e).apply(this,arguments))}return l(e,kt),f(e,[{key:"render",value:function(t,i){r(h(e.prototype),"render",this).call(this,t,i),t.drawTexture(pt.getColoredTexture(this.texture,this.gameObject.mColor))}}]),e}(),St=function(t){function e(){return m(this,e),a(this,h(e).apply(this,arguments))}return l(e,bt),f(e,[{key:"render",value:function(t,i){r(h(e.prototype),"render",this).call(this,t,i),t.drawTexture(pt.getColoredTexture(this.texture,this.gameObject.mColor))}}]),e}(),Tt=function(t){function e(){var t;return m(this,e),(t=a(this,h(e).call(this))).isLocal=!1,t.__tmpLocal=new C,t.__tmpWorld=new C,t}return l(e,pt),f(e,[{key:"preRender",value:function(t,e){var i=this.gameObject;this.skipChildren=!(i.mAlpha>0&&i.mTextures.length>0&&!0===i.mVisible),this.skipSelf=!(i.mTextures.length>0&&i.mParticles.length>0)}},{key:"render",value:function(t,e){var i=this.gameObject;t.setSnapToPixels(i.snapToPixels);var n=i.mParticles.length,s=this.__tmpLocal,r=this.__tmpWorld;if(s.identity(),i.sortOrder===ee.FRONT_TO_BACK)for(var a=0;a<n;a++)this.__renderParticle(i.mParticles[a],s,r,t);else for(var o=n-1;o>0;o--)this.__renderParticle(i.mParticles[o],s,r,t)}},{key:"__renderParticle",value:function(t,e,i,n){var s=this.gameObject,r=s.textures[t.textureIndex],a=r.displayWidth*t.anchorX,o=r.displayHeight*t.anchorY;if(0===t.r){var h=t.x-a*t.scaleX,l=t.y-o*t.scaleY;e.set(t.scaleX,0,0,t.scaleY,h,l)}else{var u=Math.cos(t.r),c=Math.sin(t.r),m=t.scaleX*u,d=t.scaleX*c,f=t.scaleY*-c,y=t.scaleY*u,v=t.x-a*m-o*f,p=t.y-a*d-o*y;e.set(m,d,f,y,v,p)}!0===s.mIsLocal?(i.identity(),i.copyFrom(e),i.prepend(s.worldTransformation)):(i.copyFrom(s.mSpace.worldTransformation),i.append(e)),n.setGlobalAlpha(s.mAlpha*t.alpha),n.setTransform(i),n.drawTexture(pt.getColoredTexture(r,null===t.color?s.mColor:t.color))}}]),e}(),Pt=function(t){function e(){var t;return m(this,e),(t=a(this,h(e).call(this))).pattern=null,t.patternTexture=null,t.sliceTextureCache=null,t.sizeWidthCache=null,t.sizeHeightCache=null,t}return l(e,pt),f(e,[{key:"preRender",value:function(t,e){var i=this.gameObject;this.endPassRequired=null!==i.mClipRect&&!1===i.mClipRect.isEmpty,this.skipChildren=i.mAlpha<=0||!1===i.mVisible||!0===i.mIsMask||null!==i.mMask&&!0===e.isMasking,this.skipSelf=null===i.mTexture||i.mAlpha<=0||!1===i.mVisible||!0===i.mIsMask}},{key:"renderSlice9Grid",value:function(t,e,i){var n=t.mDevicePixelRatio,s=e.width*this.gameObject.mScaleX,r=e.height*this.gameObject.mScaleY;if(this.sizeWidthCache===s&&this.sizeHeightCache===r)return this.sliceTextureCache;this.sizeWidthCache=s,this.sizeHeightCache=r;var a=e.region.x,o=e.region.y,h=e.region.width,l=e.region.height,u=e.untrimmedRegion.x*n,c=e.untrimmedRegion.y*n;null===this.sliceTextureCache?this.sliceTextureCache=new Q(s,r,1/e.scale):this.sliceTextureCache.resize(s,r,1/e.scale);var m=this.sliceTextureCache.renderTarget.context,d=Math.min(this.gameObject.scaleX,this.gameObject.scaleY);d<=1&&(m.setTransform(d,0,0,d,0,0),s/=d,r/=d);var f=i.x/e.scale,y=i.y/e.scale,v=h-i.right/e.scale,p=l-i.bottom/e.scale,g=a+h-v,k=u+s/e.scale-v,b=o+l-p,w=c+r/e.scale-p;m.drawImage(e.native,a,o,f,y,u,c,f,y),m.drawImage(e.native,g,o,v,y,k,c,v,y),m.drawImage(e.native,g,b,v,p,k,w,v,p),m.drawImage(e.native,a,b,f,p,u,w,f,p);var _=a+f,x=u+f,C=o+y,S=c+y,T=a+h-v,P=u+s/e.scale-v,A=o+l-p,R=c+r/e.scale-p,E=h-f-v,O=s/e.scale-f-v,N=l-y-p,D=r/e.scale-y-p;return m.drawImage(e.native,_,o,E,y,x,c,O,y),m.drawImage(e.native,T,C,v,N,P,S,v,D),m.drawImage(e.native,_,A,E,p,x,R,O,p),m.drawImage(e.native,a,C,f,N,u,S,f,D),m.drawImage(e.native,_,C,E,N,x,S,O,D),this.sliceTextureCache}},{key:"render",value:function(t,e){var i=t.mCtx,n=this.gameObject,s=pt.getColoredTexture(n.mTexture,this.color);if(null!==n.mSlice9grid){var r=this.gameObject.worldTransformation.data,a=C.pool.get().set(r[0]/this.gameObject.scaleX,r[1]/this.gameObject.scaleX,r[2]/this.gameObject.scaleY,r[3]/this.gameObject.scaleY,r[4],r[5]);t.setTransform(a),C.pool.release(a),s=this.renderSlice9Grid(t,s,n.mSlice9grid)}if(null===n.mTiling)t.drawTexture(pt.getColoredTexture(s,this.color));else{if(null===this.pattern||this.patternTexture!==s){var o=new At(s.width,s.height),h=s.region,l=s.untrimmedRegion;o.context.drawImage(s.native,h.x,h.y,h.width,h.height,l.x,l.y,h.width,h.height),this.pattern=i.createPattern(o.native,"repeat"),this.patternTexture=s}i.fillStyle=this.pattern;var u=t.mDPR,c=n.worldTransformation.clone();c.scale(n.tiling.scaleX*u,n.tiling.scaleY*u),c.translate(n.tiling.wrapX/u,n.tiling.wrapY/u),t.setTransform(c),i.fillRect(-n.tiling.wrapX,-n.tiling.wrapY,n.tiling.width/n.tiling.scaleX,n.tiling.height/n.tiling.scaleY),i.fillStyle="black"}}}]),e}(),At=function(t){function e(t,i){var n;return m(this,e),(n=a(this,h(e).call(this,t,i))).mCanvas=document.createElement("canvas"),n.mCtx=n.mCanvas.getContext("2d"),n.resize(t,i),n}return l(e,wt),f(e,[{key:"resize",value:function(t,e){this.mCanvas.width=Math.ceil(t),this.mCanvas.height=Math.ceil(e)}},{key:"clear",value:function(){this.mCtx.setTransform(1,0,0,1,0,0),this.mCtx.clearRect(0,0,this.mCanvas.width,this.mCanvas.height)}},{key:"width",get:function(){return this.mCanvas.width},set:function(t){this.mCanvas.width=t}},{key:"height",get:function(){return this.mCanvas.height},set:function(t){this.mCanvas.height=t}},{key:"native",get:function(){return this.mCanvas}},{key:"context",get:function(){return this.mCtx}}]),e}(),Rt=function(t){function e(){return m(this,e),a(this,h(e).call(this))}return l(e,_t),f(e,[{key:"render",value:function(t,e){var i=this.gameObject;this.__drawCommandBuffer(t),null!==i.mColor&&16777215!==i.mColor&&(t.context.globalCompositeOperation="multiply",this.__drawCommandBuffer(t,i.mColor))}},{key:"__drawCommandBuffer",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=this.gameObject,n=t.context;n.save(),n.beginPath();var s=C.pool.get().copyFrom(i.worldTransformation);s.translate(-i.mDataOffsetX,-i.mDataOffsetY),this.__renderNode(t,e,i.mGraphicsData,s),C.pool.release(s),n.restore()}},{key:"__renderNode",value:function(t,e,i,n){var s=i.mCommandQueue,r=t.context,a=s.length,o=t.renderScaleFactor,h=i.mPivotX,l=i.mPivotY;n=n.clone().append(i.mTransform),t.setTransform(n);for(var u=0;u<a;u++){var c=s[u];switch(c.type){case Bt.LINE_STYLE:r.lineWidth=c.getNumber(0)*o,r.strokeStyle=w.intToRGBA(null===e?c.getNumber(1):e,c.getNumber(2)),r.lineCap=c.getString(3),r.lineJoin=c.getString(4),r.miterLimit=c.getNumber(5);break;case Bt.FILL_STYLE:r.fillStyle=w.intToRGBA(null===e?c.getNumber(0):e,c.getNumber(1));break;case Bt.ARC:r.arc(c.getNumber(0)*o-h,c.getNumber(1)*o-l,c.getNumber(2)*o,c.getNumber(3),c.getNumber(4),c.getBoolean(5));break;case Bt.RECT:r.rect(c.getNumber(0)*o-h,c.getNumber(1)*o-l,c.getNumber(2)*o,c.getNumber(3)*o);break;case Bt.BEZIER_CURVE_TO:r.bezierCurveTo(c.getNumber(0)*o-h,c.getNumber(1)*o-l,c.getNumber(2)*o-h,c.getNumber(3)*o-l,c.getNumber(4)*o-h,c.getNumber(5)*o-l);break;case Bt.QUADRATIC_CURVE_TO:r.quadraticCurveTo(c.getNumber(0)*o-h,c.getNumber(1)*o-l,c.getNumber(2)*o-h,c.getNumber(3)*o-l);break;case Bt.BEGIN_PATH:r.beginPath();break;case Bt.CLOSE_PATH:r.closePath();break;case Bt.FILL:r.fill(!0===c.getBoolean(0)?"nonzero":"evenodd");break;case Bt.LINE_TO:r.lineTo(c.getNumber(0)*o-h,c.getNumber(1)*o-l);break;case Bt.MOVE_TO:r.moveTo(c.getNumber(0)*o-h,c.getNumber(1)*o-l);break;case Bt.LINE_DASH:r.setLineDash(c.getNumber(0));break;case Bt.STROKE:r.stroke();break;case Bt.BOUNDS:break;default:y.error("Unsupported canvas command '".concat(c.type,"'."))}}for(var m=0,d=i.mNodes.length;m<d;m++)this.__renderNode(t,e,i.mNodes[m],n)}}]),e}(),Et=function(){function t(e,i,n){m(this,t),this.mContainerElement=e,this.mClientWidth=i,this.mClientHeight=n,this.mTransform=new C,this.mIdentityMatrix=new C,this.mActiveSession=new gt,this.mSessions=[],this.mLastRenderTexture=null,this.mSnapToPixels=!1,this.mDevicePixelRatio=Yt.getDevicePixelRatio(),this.mGlobalBlendMode=yt.AUTO,this.mGlobalAlpha=1,this.mDPR=Yt.getDevicePixelRatio(),this.mStageRenderer=new pt,this.mRendererMap={},ei.instance.viewport.on("resize",this.__onResize,this)}return f(t,[{key:"render",value:function(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&void 0!==arguments[2]&&arguments[2]}},{key:"getRenderer",value:function(t,e){return null}},{key:"__saveSession",value:function(){var e=t.sessionPool.get();return e.reset(),this.mSessions.push(e),this.mActiveSession=e,e}},{key:"__restoreSession",value:function(){this.mSessions.pop(),this.mActiveSession=this.mSessions[this.mSessions.length-1]||null}},{key:"__collectParentRenderables",value:function(t,e,i){var n=e;if(null!==n){var s=[];for(n=n.parent;null!==n;n=n.parent)s.splice(0,0,n);for(var r=0;r<s.length;r++){var a=(n=s[r]).mRenderer;null!=a&&(t.parentRenderers.push(a),a.parent=i,i=a,a.preRender(this,!1),!0===a.endPassRequired&&t.endPassParentRenderers.push(a))}}}},{key:"beginClip",value:function(t,e,i){}},{key:"endClip",value:function(){}},{key:"__onResize",value:function(t,e){pt.__dirty=!0;var i=this.mContainerElement.clientWidth,n=this.mContainerElement.clientHeight;this.mClientWidth=i,this.mClientHeight=n}},{key:"start",value:function(){}},{key:"beginFrame",value:function(){this.clear()}},{key:"endFrame",value:function(){}},{key:"getTextureFromCanvas",value:function(t){return null}},{key:"setTransform",value:function(t){this.mTransform=t}},{key:"setSnapToPixels",value:function(t){this.mSnapToPixels=t}},{key:"getGlobalAlpha",value:function(){return this.mGlobalAlpha}},{key:"setGlobalAlpha",value:function(t){this.mGlobalAlpha=t}},{key:"getGlobalBlendMode",value:function(){return this.mGlobalBlendMode}},{key:"setGlobalBlendMode",value:function(t){this.mGlobalBlendMode=t}},{key:"drawTexture",value:function(t){}},{key:"drawTextureWithOffset",value:function(t,e,i){}},{key:"clear",value:function(){}},{key:"context",get:function(){return null}},{key:"finalScale",get:function(){return this.mDPR*ei.stage.scaleFactor}},{key:"renderScaleFactor",get:function(){return this.mDevicePixelRatio}}]),t}();Et.sessionPool=new g(gt);var Ot=function(t){function e(t,i,n){var s;return m(this,e),(s=a(this,h(e).call(this,t,i,n))).mCtx=null,s.__createCanvas(),s.mRendererMap={DisplayObject:xt,Sprite:Pt,Emitter:Tt,Text:Ct,BitmapText:St,Graphics:Rt},s}return l(e,Et),f(e,[{key:"getRenderer",value:function(t,e){var i=new this.mRendererMap[t];return i.gameObject=e,i}},{key:"render",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=null===e;if(!0!==pt.skipUnchangedFrames||!0!==s||!1!==pt.__dirty){var r=this.__saveSession();r.isBackBufferActive=s,r.customTransform=i,r.isMasking=n;var a=this.mStageRenderer;if(null!==e){this.mLastRenderTexture=this.mCtx,this.mCtx=e.renderTarget.context,this.mGlobalAlpha=-1,this.mGlobalBlendMode=null,a.alpha=1,a.blendMode=yt.NORMAL,a.color=null,this.__collectParentRenderables(r,t,this.mStageRenderer);for(var o=0,h=r.parentRenderers.length;o!==h;o++){var l=r.parentRenderers[o];l.begin(this,r),!1===l.skipSelf&&l.upload(this,r)}r.parentRenderers.length>0&&(a=r.parentRenderers[r.parentRenderers.length-1])}if(this.renderObject(t,r,a),null!==e){for(;r.endPassParentRenderers.length>0;)r.endPassParentRenderers.pop().end(this,r);this.mCtx=this.mLastRenderTexture,this.mGlobalAlpha=-1,this.mGlobalBlendMode=null}this.__restoreSession()}}},{key:"renderObject",value:function(t,e,i){var n=!1,s=t.mRenderer;if(null!=s){s.parent=i,s.preRender(this,e);for(var r=0;r<t.mComponents.length;r++){t.mComponents[r].onRender()}t.onRender(),s.begin(this,e),!1!==s.skipSelf&&!0!==e.isMasking||(s.upload(this,e),s.render(this,e)),n=s.skipChildren}if(!1===n||!0===e.isMasking)for(var a=0;a<t.mChildren.length;a++)this.renderObject(t.mChildren[a],e,s||i);null!=s&&!0===s.endPassRequired&&s.end(this,e)}},{key:"__createCanvas",value:function(){var t=this.mDevicePixelRatio,e=document.createElement("canvas");e.style.position="absolute",e.id="canvas",e.width=this.mClientWidth*t,e.height=this.mClientHeight*t,e.style.width=this.mClientWidth+"px",e.style.height=this.mClientHeight+"px",this.mContainerElement.appendChild(e),this.mCtx=e.getContext("2d")}},{key:"__onResize",value:function(t,i){r(h(e.prototype),"__onResize",this).call(this,t,i),this.mGlobalBlendMode=null,this.mGlobalAlpha=-1;var n=this.mDevicePixelRatio;this.mCtx.canvas.width=this.mClientWidth*n,this.mCtx.canvas.height=this.mClientHeight*n,this.mCtx.canvas.style.width=this.mClientWidth+"px",this.mCtx.canvas.style.height=this.mClientHeight+"px"}},{key:"drawTexture",value:function(t){if(!1!==t.isValid){var e=this.mDevicePixelRatio,i=t.region.x,n=t.region.y,s=t.region.width,r=t.region.height,a=t.untrimmedRegion.x*e,o=t.untrimmedRegion.y*e,h=t.renderWidth*e,l=t.renderHeight*e;this.mCtx.drawImage(t.native,i,n,s,r,a,o,h,l)}}},{key:"drawTextureWithOffset",value:function(t,e,i){if(!1!==t.isValid){var n=this.mDevicePixelRatio,s=t.region.x,r=t.region.y,a=t.region.width,o=t.region.height,h=(e+t.untrimmedRegion.x)*n,l=(i+t.untrimmedRegion.y)*n,u=t.renderWidth*n,c=t.renderHeight*n;this.mCtx.drawImage(t.native,s,r,a,o,h,l,u,c)}}},{key:"beginClip",value:function(t,e,i){var n=this.mDevicePixelRatio;this.mCtx.save(),this.mCtx.beginPath(),this.mCtx.rect((t.x+e)*n,(t.y+i)*n,t.width*n,t.height*n),this.mCtx.clip()}},{key:"endClip",value:function(){this.mCtx.restore(),this.mGlobalAlpha=-1,this.mGlobalBlendMode=null}},{key:"setTransform",value:function(t){var e=this.mDevicePixelRatio,i=this.mActiveSession;!1===i.isBackBufferActive&&(null===i.customTransform?((t=t.clone()).data[4]-=ei.stage.mX,t.data[5]-=ei.stage.mY):(t=t.clone()).prepend(i.customTransform)),this.mTransform=t;var n=t.value;y.isNumber(n[0],n[1],n[2],n[3],n[4],n[5]),!0===this.mSnapToPixels?this.mCtx.setTransform(n[0],n[1],n[2],n[3],n[4]*e|0,n[5]*e|0):this.mCtx.setTransform(n[0],n[1],n[2],n[3],n[4]*e,n[5]*e)}},{key:"setGlobalAlpha",value:function(t){y.isNumber(t),t!=this.mGlobalAlpha&&(this.mGlobalAlpha=t,this.mCtx.globalAlpha=t)}},{key:"setGlobalBlendMode",value:function(t){t!==yt.AUTO&&(t=vt[t],this.mGlobalBlendMode!==t&&(this.mGlobalBlendMode=t,this.mCtx.globalCompositeOperation=t))}},{key:"clear",value:function(){if(!0!==pt.skipUnchangedFrames||!1!==pt.__dirty){this.mCtx.setTransform(1,0,0,1,0,0);var t=ei.instance.viewport;!1===t.isTransparent?(this.mCtx.fillStyle=w.hexColorToString(t.backgroundColor),this.mCtx.fillRect(0,0,t.size.width*this.mDPR,t.size.height*this.mDPR)):this.mCtx.clearRect(0,0,t.size.width*this.mDPR,t.size.height*this.mDPR)}}},{key:"getTextureFromCanvas",value:function(t){return new q(t)}},{key:"context",get:function(){return this.mCtx}}]),e}(),Nt=function(t){function e(){var t;return m(this,e),(t=a(this,h(e).call(this))).mAlpha=1,t.mBlendMode=yt.AUTO,t.mVisible=!0,t.mClipRect=null,t.mRenderer=t.getRenderer(),t.mCacheAsBitmap=!1,t.mCacheAsBitmapDynamic=!0,t.mCacheAsBitmapDirty=!0,t.mCacheAsBitmapMatrixCache=null,t.mCache=null,t.mCacheBounds=null,t.mColor=null,t.mSnapToPixels=!1,t}return l(e,G),f(e,[{key:"onRender",value:function(){}},{key:"getRenderer",value:function(){return ei.driver.getRenderer("DisplayObject",this)}},{key:"onGetLocalBounds",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;return t=t||new S,null!==this.mClipRect?(this.mClipRect.copyTo(t),t):t.set(0,0,0,0)}},{key:"getBounds",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;i=i||new S;var n=this.onGetLocalBounds();if(null==t&&(t=this.mParent),t==this);else if(t==this.mParent)if(!1===e||null!==this.mClipRect){var s=C.pool.get();s.copyFrom(this.localTransformation),s.transformRect(n,i),C.pool.release(s)}else{if(!(!0===e&&this.mDirty&z.BOUNDS))return i.copyFrom(this.mBoundsCache),i;var r=C.pool.get();r.copyFrom(this.localTransformation),r.transformRect(n,i),C.pool.release(r)}else{var a=C.pool.get();a.copyFrom(this.worldTransformation),a.prepend(t.worldTransformationInverted),a.transformRect(n,i),C.pool.release(a)}if(t!==this?null!==this.mClipRect&&(i.x+=this.mPivotX,i.y+=this.mPivotY):n.copyTo(i),null!==this.mClipRect)return i;if(!0===e){for(var o=S.pool.get(),h=0;h<this.mChildren.length;h++)o.zero(),this.mChildren[h].getBounds(t,e,o),i.union(o);S.pool.release(o),t==this.mParent&&this.mDirty&z.BOUNDS&&(this.mBoundsCache.copyFrom(i),this.mDirty^=z.BOUNDS)}return i}},{key:"hitTest",value:function(t){var e=this.getComponent(oe),i=null!==e&&e.touchable,n=this.onHitTestMask(t);if(!1===this.visible||!1===i||!1===n)return null;for(var s=null,r=this.mChildren.length-1;r>=0;--r){if(null!==(s=this.mChildren[r].hitTest(t)))return s}return!0===this.onHitTest(t)?this:null}},{key:"onHitTestMask",value:function(t){if(null===this.mClipRect)return!0;var e=x.pool.get();this.worldTransformationInverted.transformVector(t,e);var i=this.mClipRect.containsXY(e.x-this.mPivotX,e.y-this.mPivotY);return x.pool.release(e),i}},{key:"color",get:function(){return this.mColor},set:function(t){this.mColor!==t&&(this.mColor=t,this.setRenderDirty())}},{key:"cacheAsBitmap",get:function(){return this.mCacheAsBitmap},set:function(t){t!==this.mCacheAsBitmap&&(this.mCacheAsBitmap=t,!1===t&&(this.mCache=null,this.mCacheAsBitmapDirty=!0,this.mCacheAsBitmapMatrixCache=null,this.mCacheBounds=null,this.setTransformDirty()))}},{key:"cacheAsBitmapDynamic",get:function(){return this.mCacheAsBitmapDynamic},set:function(t){this.mCacheAsBitmapDynamic=t}},{key:"alpha",get:function(){return this.mAlpha},set:function(t){y.assert(!isNaN(t),"Value cannot be NaN"),this.mAlpha!==v.clamp(t,0,1)&&(this.mAlpha=v.clamp(t,0,1),this.setRenderDirty())}},{key:"visible",get:function(){return this.mVisible},set:function(t){this.mVisible!==t&&(this.mVisible=t,this.setRenderDirty())}},{key:"blendMode",get:function(){return this.mBlendMode},set:function(t){this.mBlendMode!==t&&(this.mBlendMode=t,this.setRenderDirty())}},{key:"clipRect",get:function(){return this.mClipRect},set:function(t){this.mClipRect=t,this.setRenderDirty()}},{key:"snapToPixels",get:function(){return this.mSnapToPixels},set:function(t){this.mSnapToPixels=t}}]),e}(),Dt=function(){function t(){m(this,t),this.mNodes=[],this.mTransform=new C,this.mCommandQueue=[],this.mPivotX=0,this.mPivotY=0,this.mPosX=0,this.mPosY=0}return f(t,[{key:"onGetLocalBounds",value:function(t,e){for(var i=new Lt,n=this.mCommandQueue.length,s=(e=e.clone().append(this.mTransform)).data,r=Math.sqrt(s[0]*s[0]+s[1]*s[1]),a=Math.sqrt(s[2]*s[2]+s[3]*s[3]),o=0;o<n;o++){var h=this.mCommandQueue[o];switch(h.type){case Bt.BEGIN_PATH:i.bounds&&(e.transformRect(i.bounds,i.bounds),t.mLocalBounds=t.mLocalBounds?t.mLocalBounds.union(i.bounds):i.bounds),i=new Lt;break;case Bt.BOUNDS:for(var l=0;l<h.data.length;l+=2)i.points.push(h.getNumber(l),h.getNumber(l+1));break;case Bt.LINE_STYLE:i.lastLineWidth=h.getNumber(0),h.getString(4)===Ft.MITER&&(i.lineMul=1);break;case Bt.FILL:if(0!==i.points.length){var u=S.fromPointsXY(i.points);i.bounds=i.bounds?i.bounds.union(u):u}break;case Bt.STROKE:if(i.lastLineWidth>i.maxLineWidth&&(i.maxLineWidth=i.lastLineWidth),0===i.maxLineWidth&&(i.maxLineWidth=1),i.maxLineWidth*=i.lineMul,0!==i.points.length){var c=S.fromPointsXY(i.points);i.points.length>1&&c.inflate(i.maxLineWidth*r,i.maxLineWidth*a),i.bounds=i.bounds?i.bounds.union(c):c}}}i.bounds&&(e.transformRect(i.bounds,i.bounds),t.mLocalBounds=t.mLocalBounds?t.mLocalBounds.union(i.bounds):i.bounds);for(var m=0,d=this.mNodes.length;m<d;m++)this.mNodes[m].onGetLocalBounds(t,e);return t.mLocalBounds}},{key:"lineStyle",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Ht.NONE,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Ft.MITER,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:3;y.isNumber(t,e,i,r),t<=0||this.__pushCommand(Bt.LINE_STYLE,t,e,i,n,s,r)}},{key:"fillStyle",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;y.isNumber(t,e),this.__pushCommand(Bt.FILL_STYLE,t,e)}},{key:"clear",value:function(){this.mPosX=0,this.mPosY=0,this.mCommandQueue=[],this.mNodes=[],this.beginPath()}},{key:"moveTo",value:function(t,e){this.mPosX=t,this.mPosY=e,this.__pushCommand(Bt.MOVE_TO,t,e)}},{key:"lineTo",value:function(t,e){this.mPosX=t,this.mPosY=e,this.__pushCommand(Bt.LINE_TO,t,e),this.__pushCommand(Bt.BOUNDS,this.mPosX,this.mPosY,t,e)}},{key:"arc",value:function(t,e,i,n,s){var r=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=!1,o=0,h=0,l=[],u=Math.abs(n-s);if(n!==s){if(u>=v.PI2){l.push(t-i,e-i,t+i,e+i);var c=T.getCircumferencePoint(t,e,i,s+.5*Math.PI);a=!0,s=n+v.PI2,o=c.x,h=c.y}else{var m=n%v.PI2+(n<0?v.PI2:0),d=s;for(r&&(d=m,m=s);d<m;)d+=v.PI2;var f,y,p,g,k=0===m||d>=v.PI2,b=m<=Math.PI&&d>=Math.PI||d>=3*Math.PI,w=m<=.5*Math.PI&&d>=.5*Math.PI||d>=2.5*Math.PI,_=m<=1.5*Math.PI&&d>=1.5*Math.PI||d>=3.5*Math.PI;b&&k||(f=Math.cos(m)*i,y=Math.cos(d)*i),_&&w||(p=Math.sin(m)*i,g=Math.sin(d)*i);var x=b?-i:Math.min(f,y),C=k?i:Math.max(f,y),S=_?-i:Math.min(p,g),P=w?i:Math.max(p,g);l.push(x+t,S+e,C+t,P+e)}this.__pushCommand(Bt.ARC,t,e,i,n,s,r),this.__pushCommand.apply(this,[Bt.BOUNDS].concat(l)),!0===a&&this.__pushCommand(Bt.MOVE_TO,o,h)}}},{key:"circle",value:function(t,e,i){this.__pushCommand(Bt.ARC,t,e,i,0,v.PI2),this.__pushCommand(Bt.BOUNDS,t-i,e-i,t+i,e+i)}},{key:"rect",value:function(t,e,i,n){y.isNumber(t,e,i,n),this.__pushCommand(Bt.RECT,t,e,i,n),this.__pushCommand(Bt.BOUNDS,t,e,t+i,e+n)}},{key:"bezierCurveTo",value:function(t,e,i,n,s,r){var a=this.__bezierRange(this.mPosX,t,i,s,x.pool.get()),o=this.__bezierRange(this.mPosY,e,n,r,x.pool.get());this.mPosX=s,this.mPosY=r,this.__pushCommand(Bt.BEZIER_CURVE_TO,t,e,i,n,s,r),this.__pushCommand(Bt.BOUNDS,a.x,o.x,a.y,o.y),x.pool.release(a),x.pool.release(o)}},{key:"quadraticCurveTo",value:function(t,e,i,n){var s=this.__quadraticRange(this.mPosX,t,i,x.pool.get()),r=this.__quadraticRange(this.mPosY,e,n,x.pool.get());this.mPosX=i,this.mPosY=n,this.__pushCommand(Bt.QUADRATIC_CURVE_TO,t,e,i,n),this.__pushCommand(Bt.BOUNDS,s.x,r.x,s.y,r.y),x.pool.release(s),x.pool.release(r)}},{key:"__bezierRange",value:function(t,e,i,n,s){s=s||new x;var r=i-2*e+t-(n-2*i+e),a=2*(e-t)-2*(i-e),o=a*a-4*r*(t-e),h=Math.min(t,n),l=Math.max(t,n);if(o>=0){var u=Math.sqrt(o),c=1/(2*r),m=(-a+u)*c,d=(-a-u)*c;if(m=isFinite(m)?m:.5,d=isFinite(d)?d:.5,m>0&&m<1){var f=this.__bezierDot(t,e,i,n,m);h=Math.min(f,h),l=Math.max(f,l)}if(d>0&&d<1){var y=this.__bezierDot(t,e,i,n,d);h=Math.min(y,h),l=Math.max(y,l)}}return s.x=h,s.y=l,s}},{key:"__bezierDot",value:function(t,e,i,n,s){var r=1-s;return t*r*r*r+3*e*s*r*r+3*i*s*s*r+n*s*s*s}},{key:"__quadraticRange",value:function(t,e,i,n){var s=i-t,r=e-t,a=r/s,o=t+(a<0||a>1?r*r/(2*r-s):0);return n.x=Math.min(t,i,o),n.y=Math.max(t,i,o),n}},{key:"beginPath",value:function(){this.__pushCommand(Bt.BEGIN_PATH)}},{key:"closePath",value:function(){this.__pushCommand(Bt.CLOSE_PATH)}},{key:"setLineDash",value:function(t){this.__pushCommand(Bt.LINE_DASH,t)}},{key:"stroke",value:function(){this.__pushCommand(Bt.STROKE)}},{key:"fill",value:function(t){this.__pushCommand(Bt.FILL,t)}},{key:"__pushCommand",value:function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];var s=new It(t,i);this.mCommandQueue.push(s)}},{key:"searchNode",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;if(e.name===t)return e;for(var i=0,n=e.mNodes.length;i<n;i++){var s=this.searchNode(t,e.mNodes[i]);if(s)return s}}}]),t}(),Mt=function(t){function e(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return m(this,e),(t=a(this,h(e).call(this))).mBounds=new S,t.mLocalBounds=null,t.mGraphicsData=null,t.mDataOffsetX=0,t.mDataOffsetY=0,t.mGraphicsData=null===i?new Dt:"string"==typeof i?ft.default.getGraphicsData(i):i,n&&(t.mGraphicsData.onGetLocalBounds(o(o(t)),new C),t.mLocalBounds&&(t.mDataOffsetX=t.mLocalBounds.x,t.mDataOffsetY=t.mLocalBounds.y,t.mLocalBounds=null)),t}return l(e,Nt),f(e,[{key:"getRenderer",value:function(){return ei.driver.getRenderer("Graphics",this)}},{key:"onGetLocalBounds",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;return t=t||new S,null!==this.mClipRect?(this.mClipRect.copyTo(t),t):(this.mGraphicsData.onGetLocalBounds(this,new C),this.mLocalBounds&&t.copyFrom(this.mLocalBounds),this.mLocalBounds=null,t.width+=Math.max(0,t.x),t.height+=Math.max(0,t.y),t.x=Math.min(0,t.x),t.y=Math.min(0,t.y),t)}},{key:"lineStyle",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Ht.NONE,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Ft.MITER,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:3;this.mGraphicsData.lineStyle(t,e,i,n,s,r)}},{key:"fillStyle",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.mGraphicsData.fillStyle(t,e)}},{key:"clear",value:function(){this.mBounds.zero(),this.mGraphicsData.clear(),this.setTransformDirty()}},{key:"moveTo",value:function(t,e){this.mGraphicsData.moveTo(t,e)}},{key:"lineTo",value:function(t,e){this.mGraphicsData.lineTo(t,e)}},{key:"arc",value:function(t,e,i,n,s){var r=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this.mGraphicsData.arc(t,e,i,n,s,r)}},{key:"circle",value:function(t,e,i){this.mGraphicsData.circle(t,e,i)}},{key:"rect",value:function(t,e,i,n){this.mGraphicsData.rect(t,e,i,n)}},{key:"bezierCurveTo",value:function(t,e,i,n,s,r){this.mGraphicsData.bezierCurveTo(t,e,i,n,s,r)}},{key:"quadraticCurveTo",value:function(t,e,i,n){this.mGraphicsData.quadraticCurveTo(t,e,i,n)}},{key:"beginPath",value:function(){this.mGraphicsData.beginPath()}},{key:"closePath",value:function(){this.mGraphicsData.closePath()}},{key:"setLineDash",value:function(t){this.mGraphicsData.setLineDash(t)}},{key:"stroke",value:function(){this.mGraphicsData.stroke(),this.setTransformDirty()}},{key:"fill",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.mGraphicsData.fill(t),this.setTransformDirty()}}]),e}(),Lt=function t(){m(this,t),this.bounds=null,this.points=[],this.maxLineWidth=0,this.lastLineWidth=0,this.lineMul=.5},It=function(){function t(e,i){m(this,t),this.type=e,this.data=i}return f(t,[{key:"getNumber",value:function(t){return this.data[t]}},{key:"getString",value:function(t){return this.data[t]}},{key:"getBoolean",value:function(t){return this.data[t]}}]),t}(),Bt={LINE_STYLE:"lineStyle",FILL_STYLE:"fillStyle",ARC:"arc",RECT:"rect",BEZIER_CURVE_TO:"bezierCurveTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEGIN_PATH:"beginPath",CLOSE_PATH:"closePath",FILL:"fill",LINE_TO:"lineTo",MOVE_TO:"moveTo",STROKE:"stroke",BOUNDS:"bounds",LINE_DASH:"setLineDash"},Ht={NONE:"none",ROUND:"round",SQUARE:"square"},Ft={BEVEL:"bevel",MITER:"miter",ROUND:"round"},Xt={NONE_ZERO:"nonzero",EVEN_ODD:"evenodd"},Vt=function(t){function e(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return m(this,e),(t=a(this,h(e).call(this))).mTexture=null,t.mTextureName=null,null!==i&&i.constructor===String?(t.mTextureName=i,t.mTexture=ft.default.getTexture(i)):t.mTexture=i,t.mTiling=null,t.mSlice9grid=null,t}return l(e,Nt),f(e,[{key:"getRenderer",value:function(){return ei.driver.getRenderer("Sprite",this)}},{key:"onGetLocalBounds",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;return t=t||new S,this.mTexture?(null!==this.mClipRect?this.mClipRect.copyTo(t):null!==this.tiling?t.set(0,0,this.tiling.width,this.tiling.height):t.set(0,0,this.mTexture.displayWidth,this.mTexture.displayHeight),t):t}},{key:"texture",get:function(){return this.mTexture},set:function(t){this.mTexture!==t&&(this.mTexture=t,this.setDirty(z.RENDER_CACHE,!1),this.setRenderDirty())}},{key:"textureName",get:function(){return this.mTextureName},set:function(t){this.mTextureName!==t&&(this.mTextureName=t,this.texture=ft.default.getTexture(t))}},{key:"tiling",get:function(){return this.mTiling},set:function(t){this.mTiling=t,this.setRenderDirty(),this.setDirty(z.RENDER_CACHE,!1)}},{key:"slice9grid",get:function(){return this.mSlice9grid},set:function(t){this.mSlice9grid=t,this.setRenderDirty(),this.setDirty(z.RENDER_CACHE,!1)}}]),e}(),Gt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"sans-serif",i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:14,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.FontStyle.NORMAL,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:t.FontWeight.NORMAL,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:16777215;m(this,t),this.name="def",this.family=e,this.size=n,this.color=i,this.style=s,this.weight=r,this.strokeThickness=a,this.strokeColor=o,this.dropShadow=!1,this.shadowDistanceX=0,this.shadowDistanceY=0,this.shadowColor=0,this.shadowAlpha=1,this.shadowBlur=0}return f(t,[{key:"clone",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:NaN,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:NaN,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:NaN,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:NaN,h=new t;return h.family=null===e?this.family:e,h.size=isNaN(n)?this.size:n,h.color=isNaN(i)?this.color:i,h.style=null===s?this.style:s,h.weight=null===r?this.weight:r,h.strokeThickness=isNaN(a)?this.strokeThickness:a,h.strokeColor=isNaN(o)?this.strokeColor:o,h.dropShadow=this.dropShadow,h.shadowAlpha=this.shadowAlpha,h.shadowBlur=this.shadowBlur,h.shadowColor=this.shadowColor,h.shadowDistanceX=this.shadowDistanceX,h.shadowDistanceY=this.shadowDistanceY,h}}]),t}();Gt.FontStyle={NORMAL:"normal",ITALIC:"italic"},Gt.FontWeight={NORMAL:"400",BOLD:"700"},Gt.FontAlign={NONE:"none",LEFT:"left",RIGHT:"right",CENTER:"center"},Gt.FontVerticalAlign={TOP:"top",MIDDLE:"middle",BOTTOM:"bottom"},Gt.default=new Gt("sans-serif",0,14,Gt.FontStyle.NORMAL,Gt.FontWeight.NORMAL,0,0);var zt=function(t){function e(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"sans-serif",s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:14,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Gt.FontStyle.NORMAL,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Gt.FontWeight.NORMAL,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:16777215;return m(this,e),(t=a(this,h(e).call(this))).mText=i,t.mCacheBounds=new S,t.mTextWidth=0,t.mTextHeight=0,t.mDefaultStyle=new Gt(n,s,r,o,l,u,c),t.mStyles={},t.mAutoSize=!0,t.mAlign=Gt.FontAlign.LEFT,t.mVerticalAlign=Gt.FontVerticalAlign.MIDDLE,t.mMultiline=!1,t.mLineHeight=1.2,t.mTextBounds=new S,t.mFieldWidth=0,t.mFieldHeight=0,t.mPadding=new S(0,0,0,0),t.mMetrics=null,t.mHighQuality=!1,t}return l(e,Nt),f(e,[{key:"getRenderer",value:function(){return ei.driver.getRenderer("Text",this)}},{key:"onGetLocalBounds",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(e=e||new S,null!==this.mClipRect)return this.mClipRect.copyTo(e),e;if(this.mDirty&z.RENDER_CACHE){var i=this.text;!1===this.mMultiline&&(i=i.replace(/\n/g,""));var n=[this.mDefaultStyle];n.push.apply(n,c(Object.keys(this.mStyles).map(function(e){return t.mStyles[e]}))),this.mMetrics=B.measure.apply(B,[i,this.mLineHeight].concat(n)),this.mTextBounds.copyFrom(this.mMetrics.bounds)}return!1===this.mAutoSize?(e.width=this.mFieldWidth,e.height=this.mFieldHeight):(e.width=this.mTextBounds.width,e.height=this.mTextBounds.height),e.width+=this.mPadding.right,e.height+=this.mPadding.bottom,e}},{key:"setStyle",value:function(t,e){y.assert("def"!==t,"Please use 'setDefaultStyle' instead."),e.name=t,this.mStyles[t]=e,this.setDirty(z.RENDER_CACHE|z.BOUNDS,!1)}},{key:"setDefaultStyle",value:function(t){this.mDefaultStyle=t,this.setDirty(z.RENDER_CACHE|z.BOUNDS,!1)}},{key:"removeStyle",value:function(t){delete this.mStyles[t],this.setDirty(z.RENDER_CACHE|z.BOUNDS,!1)}},{key:"getStyle",value:function(t){return this.mStyles.hasOwnProperty(t)?this.mStyles[t]:null}},{key:"getAllStyles",value:function(){var t=[];for(var e in this.mStyles)t.push(this.mStyles[e]);return t}},{key:"getDefaultStyle",value:function(t){return this.mDefaultStyle}},{key:"multiline",set:function(t){this.mMultiline=t,this.setDirty(z.RENDER_CACHE|z.BOUNDS,!1)},get:function(){return this.mMultiline}},{key:"lineHeight",set:function(t){this.mLineHeight=t,this.setDirty(z.RENDER_CACHE|z.BOUNDS,!1)},get:function(){return this.mLineHeight}},{key:"size",get:function(){return this.mDefaultStyle.size},set:function(t){this.mDefaultStyle.size!==t&&(this.mDefaultStyle.size=t,this.setDirty(z.RENDER_CACHE|z.BOUNDS,!1))}},{key:"font",get:function(){return this.mDefaultStyle.family},set:function(t){this.mDefaultStyle.family!==t&&(this.mDefaultStyle.family=t,this.setDirty(z.RENDER_CACHE|z.BOUNDS,!1))}},{key:"color",get:function(){return this.mDefaultStyle.color},set:function(t){this.mDefaultStyle.color!==t&&(this.mDefaultStyle.color=t,this.setDirty(z.RENDER_CACHE,!1))}},{key:"fontStyle",get:function(){return this.mDefaultStyle.style},set:function(t){this.mDefaultStyle.style!==t&&(this.mDefaultStyle.style=t,this.setDirty(z.RENDER_CACHE|z.BOUNDS,!1))}},{key:"weight",get:function(){return this.mDefaultStyle.weight},set:function(t){this.mDefaultStyle.weight!==t&&(this.mDefaultStyle.weight=t,this.setDirty(z.RENDER_CACHE|z.BOUNDS,!1))}},{key:"align",get:function(){return this.mAlign},set:function(t){this.mAlign!==t&&(this.mAlign=t,this.setDirty(z.RENDER_CACHE|z.BOUNDS,!1))}},{key:"vAlign",get:function(){return this.mVerticalAlign},set:function(t){this.mVerticalAlign!==t&&(this.mVerticalAlign=t,this.setDirty(z.RENDER_CACHE|z.BOUNDS,!1))}},{key:"strokeColor",get:function(){return this.mDefaultStyle.strokeColor},set:function(t){this.mDefaultStyle.strokeColor!==t&&(this.mDefaultStyle.strokeColor=t,this.setDirty(z.RENDER_CACHE,!1))}},{key:"strokeThickness",get:function(){return this.mDefaultStyle.strokeThickness},set:function(t){t!==this.mDefaultStyle.strokeThickness&&(this.mDefaultStyle.strokeThickness=t,this.setDirty(z.RENDER_CACHE,!1))}},{key:"fieldWidth",get:function(){return this.mFieldWidth},set:function(t){t!==this.mFieldWidth&&(this.mFieldWidth=t,this.setDirty(z.RENDER_CACHE|z.BOUNDS,!1))}},{key:"fieldHeight",get:function(){return this.mFieldHeight},set:function(t){t!==this.mFieldHeight&&(this.mFieldHeight=t,this.setDirty(z.RENDER_CACHE|z.BOUNDS,!1))}},{key:"text",get:function(){return this.mText},set:function(t){this.mText!==t&&(this.mText=t,this.post(N.CHANGE),this.setDirty(z.RENDER|z.RENDER_CACHE|z.BOUNDS,!1))}},{key:"autoSize",get:function(){return this.mAutoSize},set:function(t){this.mAutoSize!==t&&(this.mAutoSize=t,this.setDirty(z.RENDER_CACHE|z.BOUNDS,!1))}},{key:"padding",get:function(){return this.mPadding},set:function(t){this.mPadding=t,this.setDirty(z.RENDER_CACHE|z.BOUNDS,!1)}},{key:"dropShadow",get:function(){return this.mDefaultStyle.dropShadow},set:function(t){t!==this.mDefaultStyle.dropShadow&&(this.mDefaultStyle.dropShadow=t,this.setDirty(z.RENDER_CACHE|z.BOUNDS,!1))}},{key:"shadowColor",get:function(){return this.mDefaultStyle.shadowColor},set:function(t){t!==this.mDefaultStyle.shadowColor&&(this.mDefaultStyle.shadowColor=t,this.setDirty(z.RENDER_CACHE,!1))}},{key:"shadowAlpha",get:function(){return this.mDefaultStyle.shadowAlpha},set:function(t){t!==this.mDefaultStyle.shadowAlpha&&(this.mDefaultStyle.shadowAlpha=t,this.setDirty(z.RENDER_CACHE,!1))}},{key:"shadowBlur",get:function(){return this.mDefaultStyle.shadowBlur},set:function(t){t!==this.mDefaultStyle.shadowBlur&&(this.mDefaultStyle.shadowBlur=t,this.setDirty(z.RENDER_CACHE|z.BOUNDS,!1))}},{key:"shadowDistanceX",get:function(){return this.mDefaultStyle.shadowDistanceX},set:function(t){t!==this.mDefaultStyle.shadowDistanceX&&(this.mDefaultStyle.shadowDistanceX=t,this.setDirty(z.RENDER_CACHE|z.BOUNDS,!1))}},{key:"shadowDistanceY",get:function(){return this.mDefaultStyle.shadowDistanceY},set:function(t){t!==this.mDefaultStyle.shadowDistanceY&&(this.mDefaultStyle.shadowDistanceY=t,this.setDirty(z.RENDER_CACHE|z.BOUNDS,!1))}},{key:"highQuality",get:function(){return this.mHighQuality},set:function(t){this.mHighQuality=t,this.setDirty(z.RENDER_CACHE|z.BOUNDS,!1)}}]),e}();zt.__cache=null;zt.__cache=null;var Yt=function(){function t(){m(this,t),t.mInstance=this,this.mPixelRatio=0,t.mInstance.mPixelRatio=t.getDevicePixelRatio()}return f(t,null,[{key:"getDevicePixelRatio",value:function(){return void 0!==window.screen.systemXDPI&&void 0!==window.screen.logicalXDPI&&window.screen.systemXDPI>window.screen.logicalXDPI?window.screen.systemXDPI/window.screen.logicalXDPI:void 0!==window.devicePixelRatio?window.devicePixelRatio:1}},{key:"os",get:function(){var t=navigator.userAgent||navigator.vendor||window.opera;return/windows phone/i.test(t)?"Windows Phone":/android/i.test(t)?"Android":/iPad|iPhone|iPod/.test(t)?"iOS":"unknown"}},{key:"isTouch",get:function(){return!!("ontouchstart"in window)||navigator.maxTouchPoints>0}},{key:"isMobile",get:function(){return/Mobi/.test(navigator.userAgent)}},{key:"pixelRatio",get:function(){return t.mInstance.mPixelRatio}},{key:"webAudioSupported",get:function(){return null!=window.AudioContext||null!=window.webkitAudioContext}},{key:"isLandscape",get:function(){var t=ei.instance.viewport.size;return t.width>=t.height}},{key:"isPortrait",get:function(){return!t.isLandscape}}]),t}();Yt.mInstance=null;var jt=function(){function t(){m(this,t)}return f(t,[{key:"getValue",value:function(){return this.getValueAt(Math.random())}},{key:"getValueAt",value:function(t){}}]),t}(),Ut=function(t){function e(t){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:NaN,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return m(this,e),(i=a(this,h(e).call(this))).min=t,i.max=isNaN(n)?t:n,i.ease=s,i.value=0,i}return l(e,jt),f(e,[{key:"getValueAt",value:function(t){return null!==this.ease&&(t=this.ease(t)),this.value=this.min+t*(this.max-this.min),this.value}}],[{key:"fromObject",value:function(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return i[0]instanceof e?i[0]:s(e,i)}}]),e}(),Wt=function(t){function e(t,i){var n,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:NaN,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:NaN;return m(this,e),(n=a(this,h(e).call(this))).minX=t,n.minY=i,n.maxX=isNaN(s)?t:s,n.maxY=isNaN(r)?i:r,n.value=new x,n}return l(e,jt),f(e,[{key:"getValue",value:function(){return this.value.x=Math.random()*(this.maxX-this.minX)+this.minX,this.value.y=Math.random()*(this.maxY-this.minY)+this.minY,this.value}},{key:"getValueAt",value:function(t){return this.value.x=this.minX+t*(this.maxX-this.minX),this.value.y=this.minY+t*(this.maxY-this.minY),this.value}}],[{key:"fromObject",value:function(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return i[0]instanceof jt?i[0]:s(e,i)}}]),e}(),qt=function(){function t(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];m(this,t),this.mIsInitializer=e,this.scatter=null}return f(t,[{key:"preUpdate",value:function(t){}},{key:"update",value:function(t,e,i){}},{key:"postUpdate",value:function(t){}},{key:"isInitializer",get:function(){return this.mIsInitializer}}]),t}(),Qt=function(t){function e(){var t;return m(this,e),(t=a(this,h(e).call(this,!1))).scatter=Wt.fromObject.apply(Wt,arguments),t}return l(e,qt),f(e,[{key:"update",value:function(t,e,i){this.scatter.getValue(),e.ax+=this.scatter.value.x,e.ay+=this.scatter.value.y}}]),e}(),Kt=function(t){function e(){var t;return m(this,e),(t=a(this,h(e).call(this,!1))).scatter=Ut.fromObject.apply(Ut,arguments),t}return l(e,qt),f(e,[{key:"update",value:function(t,e,i){e.alpha=this.scatter.getValueAt(e.energy)}}]),e}(),Zt=function(t){function e(){var t;return m(this,e),(t=a(this,h(e).call(this,!1))).scatter=Ut.fromObject.apply(Ut,arguments),t}return l(e,qt),f(e,[{key:"update",value:function(t,e,i){e.scaleX=e.scaleY=this.scatter.getValueAt(e.energy)}}]),e}(),Jt=function(t){function e(){var t;return m(this,e),(t=a(this,h(e).call(this))).scatter=Ut.fromObject.apply(Ut,arguments),t}return l(e,qt),f(e,[{key:"update",value:function(t,e,i){e.life=this.scatter.getValue()}}]),e}(),$t=function(t){function e(){var t;return m(this,e),(t=a(this,h(e).call(this))).scatter=Wt.fromObject.apply(Wt,arguments),t}return l(e,qt),f(e,[{key:"update",value:function(t,e,i){this.scatter.getValue(),e.vx=this.scatter.value.x,e.vy=this.scatter.value.y}}]),e}(),te={PENDING:0,EMITTING:1,FINISHED:2},ee={FRONT_TO_BACK:"frontToBack",BACK_TO_FRONT:"backToFront"},ie=function(){function t(){m(this,t),this.textureIndex=0,this.scaleX=1,this.scaleY=1,this.alpha=1,this.life=1,this.age=0,this.energy=this.age/this.life,this.mass=0,this.x=0,this.y=0,this.r=0,this.vx=0,this.vy=0,this.ax=0,this.ay=0,this.color=null,this.anchorX=.5,this.anchorY=.5}return f(t,[{key:"reset",value:function(){this.scaleX=this.scaleY=this.alpha=this.life=1,this.textureIndex=this.age=this.energy=this.mass=this.x=this.y=this.r=this.vx=this.vy=this.ax=this.ay=0,this.anchorX=this.anchorY=.5}},{key:"update",value:function(t){this.life<=0?this.life=0:(this.x+=this.vx*t,this.y+=this.vy*t,this.mass>0&&(this.ax*=1/this.mass,this.ay*=1/this.mass),this.vx+=this.ax*t,this.vy+=this.ay*t,this.ax=0,this.ay=0,this.life-=t,this.age+=t,this.energy=this.age/(this.age+this.life))}}]),t}(),ne=function(t){function e(){var t;return m(this,e),(t=a(this,h(e).call(this))).mTextures=null,t.mParticles=[],t.mRecycled=[],t.mInitializers=[],t.mActions=[],t.mSpace=null,t.mIsLocal=!0,t.mMaxParticles=1e4,t.mEmitCount=new Ut(10),t.mEmitNumRepeats=new Ut(1/0),t.mEmitNumRepeatsLeft=t.mEmitNumRepeats.getValue(),t.mEmitDuration=new Ut(1/60),t.mEmitDurationLeft=t.mEmitDuration.getValue(),t.mEmitInterval=new Ut(1/60),t.mEmitIntervalLeft=t.mEmitInterval.getValue(),t.mEmitDelay=new Ut(1),t.mEmitDelayLeft=t.mEmitDelay.getValue(),t.mNextUpdateAt=0,t.mState=te.PENDING,t.__tmpLocal=new C,t.__tmpWorld=new C,t.mSortOrder=ee.FRONT_TO_BACK,t}return l(e,Nt),f(e,[{key:"getRenderer",value:function(){return ei.driver.getRenderer("Emitter",this)}},{key:"resetState",value:function(){this.mState=te.PENDING}},{key:"add",value:function(){for(var t=0;t<arguments.length;t++){var i=t<0||arguments.length<=t?void 0:arguments[t];i instanceof qt?this.addModifier(i):r(h(e.prototype),"add",this).call(this,i)}return this}},{key:"addModifier",value:function(t){return t.isInitializer?this.mInitializers.push(t):this.mActions.push(t),t}},{key:"updateNextTick",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=H.now,i=!1;if(this.mState===te.PENDING&&(this.mNextUpdateAt=e+this.mEmitDelayLeft,this.mEmitDelayLeft-=t,this.mEmitDelayLeft<=0&&(this.mEmitDelayLeft=this.mEmitDelay.getValue(),this.mState=te.EMITTING,i=!0)),this.mState===te.EMITTING){if(this.mEmitDurationLeft<=0)return this.mEmitDurationLeft=this.mEmitDuration.getValue(),this.mEmitNumRepeatsLeft--,this.mEmitNumRepeatsLeft<=0?(this.mState=te.FINISHED,void this.post(N.COMPLETE)):void(this.mState=te.PENDING);i?(this.mNextUpdateAt=e,this.mEmitIntervalLeft=this.mEmitInterval.getValue()):(this.mEmitIntervalLeft-=t,this.mNextUpdateAt=e+this.mEmitIntervalLeft,this.mEmitIntervalLeft<=0&&(this.mEmitIntervalLeft=this.mEmitInterval.getValue())),this.mEmitDurationLeft-=t}}},{key:"onUpdate",value:function(){var t=H.delta;this.updateNextTick(t),H.now>=this.mNextUpdateAt&&this.mState===te.EMITTING&&this.__create(this.mEmitCount.getValue());for(var e,i=this.mActions.length,n=this.mParticles.length,s=0;s<i;s++)this.mActions[s].preUpdate(t);for(var r=n;r--;){e=this.mParticles[r];for(var a=0;a<i;a++)this.mActions[a].update(this,e,t);e.update(t),0===e.life&&(this.mRecycled.push(e),this.mParticles.splice(r,1))}for(var o=0;o<i;o++)this.mActions[o].postUpdate(t);!0===this.mVisible&&this.mAlpha>0&&this.setDirty(z.LOCAL,!1)}},{key:"__create",value:function(t){var e=this.worldTransformation.clone(),i=null;!1===this.mIsLocal&&(i=this.mSpace.worldTransformationInverted.clone(),e.prepend(i));for(var n=0;n<t;n++){var s=null;if(this.mRecycled.length>0)s=this.mRecycled.pop();else{if(this.mParticles.length>=this.mMaxParticles)return;s=new ie}s.reset();for(var r=0;r<this.mInitializers.length;r++)this.mInitializers[r].update(this,s,0);!1===this.mIsLocal&&(e.transformXY(s.x,s.y,x.__cache),s.x=x.__cache.x,s.y=x.__cache.y),this.mParticles.push(s)}}},{key:"state",get:function(){return this.mState}},{key:"maxParticles",get:function(){return this.mMaxParticles},set:function(t){if(t<0)throw new Error("Bad argument error.");this.mMaxParticles=t}},{key:"emitCount",get:function(){return this.mEmitCount},set:function(t){this.mEmitCount=t}},{key:"emitNumRepeats",get:function(){return this.mEmitNumRepeats},set:function(t){this.mEmitNumRepeats=t,this.mEmitNumRepeatsLeft=this.mEmitNumRepeats.getValue()}},{key:"emitDuration",get:function(){return this.mEmitDuration},set:function(t){this.mEmitDuration=t,this.mEmitDurationLeft=this.mEmitDuration.getValue()}},{key:"emitInterval",get:function(){return this.mEmitInterval},set:function(t){this.mEmitInterval=t,this.mEmitIntervalLeft=this.mEmitInterval.getValue()}},{key:"emitDelay",get:function(){return this.mEmitDelay},set:function(t){this.mEmitDelay=t,this.mEmitDelayLeft=this.mEmitDelay.getValue()}},{key:"space",get:function(){return this.mSpace},set:function(t){this.mSpace=t,this.mIsLocal=null===this.mSpace||this.mSpace===this,this.setRenderDirty()}},{key:"textures",get:function(){return this.mTextures},set:function(t){this.mTextures=t,y.assert(!(null===this.mTextures||0===this.mTextures.length),"At least one texture must be provided."),this.setRenderDirty()}},{key:"texturesName",set:function(t){this.textures=ft.default.getTextures(t)}},{key:"sortOrder",get:function(){return this.mSortOrder},set:function(t){this.mSortOrder=t,this.setRenderDirty()}}]),e}(),se=function t(e){m(this,t),this.keyCode=e.keyCode,this.code=e.code,this.char=e.key,this.shiftKey=e.shiftKey,this.altKey=e.altKey,this.ctrlKey=e.ctrlKey},re=function(t){function e(){var t;return m(this,e),t=a(this,h(e).call(this)),y.assert(null==t.constructor.instance,"Only single instance is allowed"),e.instance=o(o(t)),t.mPointerPosition=new x,t.mStagePosition=new x,t.mDom=ei.instance.containerElement,t.mEventList=null,t.mKeyEventList=null,t.__initListeners(),t.mPointerQueue=[],t.mKeyQueue=[],t.mPressedKeys=[],t.mIsPointerDown=!1,t.mNeedUpEvent=!1,t.mInputListeners=new Map,t.mTarget=null,t.mTargetComponent=null,t.mLockedTarget=null,t.mLastInTargetComponent=null,t}return l(e,F),f(e,[{key:"__initListeners",value:function(){var t=this;this.mKeyEventList=e.mKeyEventList,window.PointerEvent?this.mEventList=e.mPointerEventList:Yt.isTouch&&Yt.isMobile?this.mEventList=e.mTouchEventList:this.mEventList=e.mMouseEventList;for(var i=0;i<3;i++)this.mDom.addEventListener(this.mEventList[i],function(e){return t.__onPointerEvent(e)},!1);document.addEventListener(this.mEventList[e.IX_POINTER_UP],function(e){return t.__onPointerEventDoc(e)},!1);for(var n=0;n<this.mKeyEventList.length;n++)document.addEventListener(this.mKeyEventList[n],function(e){return t.__onKeyEvent(e)},!1)}},{key:"__onKeyEvent",value:function(t){return!0!==ei.instance.isPaused&&(this.mKeyQueue.push(t),!0)}},{key:"__onPointerEventDoc",value:function(t){!0!==ei.instance.isPaused&&(!1===(t.target==this.mDom||t.target.parentElement==this.mDom)&&!0===this.mNeedUpEvent&&(this.mNeedUpEvent=!1,this.__pushEvent(t)))}},{key:"__onPointerEvent",value:function(t){return!0!==ei.instance.isPaused&&(t.preventDefault(),this.__pushEvent(t),!0)}},{key:"__pushEvent",value:function(t){var e=null;e=0===t.type.indexOf("touch")?this.__getTouchPos(this.mDom,t):this.__getPointerPos(this.mDom,t),this.mPointerQueue.push({e:t,x:e.x,y:e.y})}},{key:"__getPointerPos",value:function(t,e){var i=t.getBoundingClientRect(),n=t.clientWidth/i.width,s=t.clientHeight/i.height;return new x((e.clientX-i.left)*n,(e.clientY-i.top)*s)}},{key:"__getTouchPos",value:function(t,e){var i=t.getBoundingClientRect(),n=e.changedTouches[0],s=n.clientX,r=n.clientY,a=t.clientWidth/i.width,o=t.clientHeight/i.height;return new x((s-i.left)*a,(r-i.top)*o)}},{key:"onUpdate",value:function(){this.__updateKeyboard();for(var t=ei.stage,i=0;i<this.mPointerQueue.length;i++){var n=this.mPointerQueue[i];this.mPointerPosition.x=n.x,this.mPointerPosition.y=n.y,this.mStagePosition.x=n.x,this.mStagePosition.y=n.y,t.worldTransformationInverted.transformVector(this.mStagePosition,this.mStagePosition);var s=e.mInputEventsLookup[this.mEventList.indexOf(n.e.type)];this.__findTarget(this.mPointerPosition),this.__processNativeEvent(n,this.mPointerPosition,s)}this.mPointerQueue.splice(0,this.mPointerQueue.length),this.mKeyQueue.splice(0,this.mKeyQueue.length)}},{key:"__findTarget",value:function(t){var e=ei.stage.hitTest(t);if(null===e)return this.mTarget=null,void(this.mTargetComponent=null);this.mTarget=e,this.mTargetComponent=e.getComponent(oe)}},{key:"__processNativeEvent",value:function(t,i,n){if(n===e.POINTER_DOWN?(this.mIsPointerDown=!0,this.mNeedUpEvent=!0):n===e.POINTER_UP&&(this.mIsPointerDown=!1),this.post(n),null!==this.mTarget||null!==this.mLockedTarget){var s=new ae(this.mTarget,i.x,i.y);if(n===e.POINTER_DOWN)this.mLockedTarget=this.mTarget;else if(n===e.POINTER_UP&&null!==this.mLockedTarget)return this.mLockedTarget.post("~pointerUp",s),void(this.mLockedTarget=null);var r=this.mTarget===this.mLockedTarget;null===this.mLockedTarget?null!==this.mTarget&&this.mTarget.post("~"+n,s):!0===r?this.mLockedTarget.post("~"+n,s):null!==this.mLockedTarget.mParent&&null!==this.mTarget&&this.mLockedTarget.mParent.post("~"+n,s)}}},{key:"__updateKeyboard",value:function(){for(var t=0;t<this.mKeyQueue.length;t++){var i=this.mKeyQueue[t],n=this.mKeyEventList.indexOf(i.type),s=this.mPressedKeys.indexOf(i.keyCode),r=e.mKeyEventsLookup[n];"keyUp"===r&&-1!==s?this.mPressedKeys.splice(s,1):"keyDown"===r&&-1===s&&(this.mPressedKeys.push(i.keyCode),r="keyPress"),this.post(r,new se(i),i)}}}],[{key:"on",value:function(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return e.instance.on(t,i,n)}},{key:"once",value:function(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return e.instance.once(t,i,n)}},{key:"isPointerDown",get:function(){return e.instance.mIsPointerDown}},{key:"pointerX",get:function(){return e.instance.mPointerPosition.x}},{key:"pointerY",get:function(){return e.instance.mPointerPosition.y}},{key:"stageX",get:function(){return e.instance.mStagePosition.x}},{key:"stageY",get:function(){return e.instance.mStagePosition.y}},{key:"pointerPosition",get:function(){return e.instance.mPointerPosition}},{key:"stagePosition",get:function(){return e.instance.mStagePosition}},{key:"pressedKeys",get:function(){return e.instance.mPressedKeys}}]),e}();re.POINTER_DOWN="pointerDown",re.POINTER_MOVE="pointerMove",re.POINTER_UP="pointerUp",re.instance=null,re.IX_POINTER_MOVE=0,re.IX_POINTER_DOWN=1,re.IX_POINTER_UP=2,re.mKeyEventList=["keydown","keyup"],re.mKeyEventsLookup=["keyDown","keyUp","keyPress"],re.mInputEventsLookup=["pointerMove","pointerDown","pointerUp","pointerIn","pointerOut"],re.mPointerEventList=["pointermove","pointerdown","pointerup","pointerenter","pointerleave"],re.mMouseEventList=["mousemove","mousedown","mouseup","mouseenter","mouseleave"],re.mTouchEventList=["touchmove","touchstart","touchend","touchenter","touchleave"];var ae=function(){function t(e,i,n){m(this,t),this.mActiveObject=e,this.mX=i,this.mY=n}return f(t,[{key:"activeObject",get:function(){return this.mActiveObject}},{key:"x",get:function(){return this.mX}},{key:"y",get:function(){return this.mY}}]),t}(),oe=function(t){function e(){var t;return m(this,e),(t=a(this,h(e).call(this))).touchable=!0,t.mPointerInDispatched=!1,t}return l(e,V),e}(),he=function(){function t(){m(this,t)}return f(t,null,[{key:"linear",value:function(t){return t}},{key:"quadraticIn",value:function(t){return t*t}},{key:"quadraticOut",value:function(t){return t*(2-t)}},{key:"quadraticInOut",value:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},{key:"cubicIn",value:function(t){return t*t*t}},{key:"cubicOut",value:function(t){return--t*t*t+1}},{key:"cubicInOut",value:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},{key:"quarticIn",value:function(t){return t*t*t*t}},{key:"quarticOut",value:function(t){return 1- --t*t*t*t}},{key:"quarticInOut",value:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},{key:"quinticIn",value:function(t){return t*t*t*t*t}},{key:"quinticOut",value:function(t){return--t*t*t*t*t+1}},{key:"quinticInOut",value:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},{key:"sinusoidalIn",value:function(t){return 1-Math.cos(t*Math.PI/2)}},{key:"sinusoidalOut",value:function(t){return Math.sin(t*Math.PI/2)}},{key:"sinusoidalInOut",value:function(t){return.5*(1-Math.cos(Math.PI*t))}},{key:"exponentialIn",value:function(t){return 0===t?0:Math.pow(1024,t-1)}},{key:"exponentialOut",value:function(t){return 1===t?1:1-Math.pow(2,-10*t)}},{key:"exponentialInOut",value:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}},{key:"circularIn",value:function(t){return 1-Math.sqrt(1-t*t)}},{key:"circularOut",value:function(t){return Math.sqrt(1- --t*t)}},{key:"circularInOut",value:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},{key:"elasticIn",value:function(t){return 0===t?0:1===t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)}},{key:"elasticOut",value:function(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1}},{key:"elasticInOut",value:function(t){return 0===t?0:1===t?1:(t*=2)<1?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1}},{key:"backIn",value:function(t){var e=1.70158;return t*t*((e+1)*t-e)}},{key:"backOut",value:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1}},{key:"backInOut",value:function(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}},{key:"bounceIn",value:function(e){return 1-t.bounceOut(1-e)}},{key:"bounceOut",value:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}},{key:"bounceInOut",value:function(e){return e<.5?.5*t.bounceIn(2*e):.5*t.bounceOut(2*e-1)+.5}},{key:"smootherStep",value:function(t){return t*t*t*(t*(6*t-15)+10)}}]),t}(),le=function(){function t(){m(this,t)}return f(t,null,[{key:"linear",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=t.length-1,s=n*e,r=Math.floor(s);return i=i||v.lerp,e<0?i(t[0],t[1],s):e>1?i(t[n],t[n-1],n-s):i(t[r],t[r+1>n?n:r+1],s-r)}},{key:"bezier",value:function(e,i){for(var n=0,s=e.length,r=Math.pow,a=function(e,i){var n=t.__factorial;return n(e)/n(i)/n(e-i)},o=0;o<s;o++)n+=r(1-i,s-o)*r(i,o)*e[o]*a(s,o);return n}},{key:"catmullRom",value:function(t,e){var i=t.length-1,n=i*e,s=Math.floor(n),r=function(t,e,i,n,s){var r=.5*(i-t),a=.5*(n-e),o=s*s;return(2*(e-i)+r+a)*(s*o)+(3*(i-e)-2*r-a)*o+r*s+e};return t[0]===t[i]?(e<0&&(s=Math.floor(n=i*(1+e))),r(t[(s-1+i)%i],t[s],t[(s+1)%i],t[(s+2)%i],n-s)):e<0?t[0]-(r(t[0],t[0],t[1],t[1],-n)-t[0]):e>1?t[i]-(r(t[i],t[i],t[i-1],t[i-1],n-i)-t[i]):r(t[s?s-1:0],t[s],t[i<s+1?i:s+1],t[i<s+2?i:s+2],n-s)}}]),t}();le.__factorial=function(){var t=[1];return function(e){if(t[e])return t[e];for(var i=e;--e;)i*=e;return t[e]=i,i}}();var ue=function(t){function e(t){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.25,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(m(this,e),(i=a(this,h(e).call(this))).mValues=t,i.mDuration=n,i.mProperties=s,i.mPlugins=r,i.mIsPlaying=!1,i.mIsPaused=!1,i.mStartTime=0,i.mPausedTime=0,i.mValuesStart={},i.mElapsed=0,i.mInterpolation=le.linear,i.mDelay=0,i.mRepeatDelay=0,i.mRepeats=0,i.mInitiated=!1,i.mStarted=!1,i.mReversed=!1,i.mYoyo=!1,i.mIsYoyoBack=!1,i.mReverseOnInit=!1,i.mRemoveOnComplete=!0,i.mPlayOnAdded=!0,i.mEase=e.DEFAULT_EASE,null!==i.mProperties)for(var o in i.mProperties)i[o]=i.mProperties[o];return i}return l(e,V),f(e,[{key:"__start",value:function(t){this.mIsPlaying=!0,this.mStartTime=t+this.mDelay}},{key:"play",value:function(){return this.mIsPaused?this.__resume():this.__start(H.now),this}},{key:"stop",value:function(){return this.mIsPlaying?(this.mIsPlaying=!1,this):this}},{key:"reset",value:function(){return this.mElapsed=0,this.mIsPlaying&&this.play(),this}},{key:"to",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.25;return this.mValues=t,this.mDuration=e,this.mInitiated=!1,this}},{key:"pause",value:function(){return this.mIsPlaying?(this.mIsPaused=!0,this.mPausedTime=H.now,this):this}},{key:"__resume",value:function(){this.mIsPaused&&(this.mIsPaused=!1,this.mStartTime+=H.now-this.mPausedTime)}},{key:"removeFromParent",value:function(){this.mIsPlaying&&this.stop(),r(h(e.prototype),"removeFromParent",this).call(this)}},{key:"chain",value:function(t){return t?(this.mRemoveOnComplete=!1,t.playOnAdded=!1,this.on(N.COMPLETE,function(){t.play()}),t):this}},{key:"onAdded",value:function(t){this.mPlayOnAdded&&this.__start(H.now)}},{key:"__update",value:function(t){}},{key:"set",value:function(t){for(var e in this.mValues=t,this.mValues)this.mValuesStart[e]=parseFloat(this.gameObject[e])}},{key:"reverse",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.mInitiated?this.__reverse():this.mReverseOnInit=!0,t&&(this.mIsYoyoBack=!this.mIsYoyoBack),this}},{key:"__reverse",value:function(){for(var t in this.mValues){var e=[this.mValuesStart[t],this.mValues[t]];this.mValues[t]=e[0],this.mValuesStart[t]=e[1]}}},{key:"onRender",value:function(){if(0===ei.numUpdates){var t=H.now;if(!(t<this.mStartTime||!1===this.mIsPlaying||!0===this.mIsPaused)&&!1!==this.mStarted&&!1!==this.mInitiated){this.mElapsed=(t-this.mStartTime)/this.mDuration,this.mElapsed>1&&(this.mElapsed=1);var e=this.mEase(this.mIsYoyoBack?1-this.mElapsed:this.mElapsed);for(var i in this.mValues){var n=this.mValuesStart[i],s=this.mValues[i];if(null!==this.mPlugins&&this.mPlugins.hasOwnProperty(i)){var r=Array.isArray(s)?s:[n,s];this.gameObject[i]=le.linear(r,e,this.mPlugins[i])}else Array.isArray(s)?this.gameObject[i]=this.mInterpolation(s,e):this.gameObject[i]=n+(s-n)*(this.mIsYoyoBack?1-e:e)}}}}},{key:"onUpdate",value:function(){var t=H.now;if(!(t<this.mStartTime||!1===this.mIsPlaying||!0===this.mIsPaused)){this.__collectStartingValues(),this.mElapsed=(t-this.mStartTime)/this.mDuration,this.mElapsed>1&&(this.mElapsed=1);var e=this.mEase(this.mIsYoyoBack?1-this.mElapsed:this.mElapsed);for(var i in this.mValues){var n=this.mValuesStart[i],s=this.mValues[i];if(null!==this.mPlugins&&this.mPlugins.hasOwnProperty(i)){var r=Array.isArray(s)?s:[n,s];this.gameObject[i]=le.linear(r,e,this.mPlugins[i])}else Array.isArray(s)?this.gameObject[i]=this.mInterpolation(s,e):this.gameObject[i]=n+(s-n)*(this.mIsYoyoBack?1-e:e)}if(this.post(N.UPDATE,this.gameObject),1===this.mElapsed)if(this.mRepeats-- >0)!0===this.mYoyo&&this.reverse(!0),this.mStartTime=t+this.mRepeatDelay,this.post("loop",this.gameObject);else if(this.mIsPlaying=!1,this.post(N.COMPLETE,this.gameObject),this.mRemoveOnComplete)this.removeFromParent();else{for(var a in this.mValues)this.mValuesStart[a]=this.mValues[a];this.mStarted=!1}}}},{key:"__collectStartingValues",value:function(){if(!1===this.mStarted){for(var t in this.mStarted=!0,this.post("start",this.gameObject),this.mValues)!this.mInitiated&&Array.isArray(this.mValues[t])&&(this.mValues[t]=[this.gameObject[t]].concat(this.mValues[t])),this.mValuesStart[t]=parseFloat(this.gameObject[t]);!0!==this.mReversed&&!0!==this.mReverseOnInit||this.__reverse(),this.mInitiated=!0}}},{key:"ease",get:function(){return this.mEase},set:function(t){this.mEase=t}},{key:"interpolation",get:function(){return this.mInterpolation},set:function(t){this.mInterpolation=t}},{key:"elapsed",get:function(){return this.mElapsed}},{key:"delay",get:function(){return this.mDelay},set:function(t){this.mDelay=t}},{key:"repeats",get:function(){return this.mRepeats},set:function(t){this.mRepeats=t}},{key:"repeatDelay",get:function(){return this.mRepeatDelay},set:function(t){this.mRepeatDelay=t}},{key:"loop",get:function(){return this.mRepeats===1/0},set:function(t){this.mRepeats=t?1/0:0}},{key:"yoyo",get:function(){return this.mYoyo},set:function(t){this.mYoyo=t}},{key:"reversed",get:function(){return this.mReversed},set:function(t){this.mReversed=t}},{key:"removeOnComplete",get:function(){return this.mRemoveOnComplete},set:function(t){this.mRemoveOnComplete=t}},{key:"playOnAdded",get:function(){return this.mPlayOnAdded},set:function(t){this.mPlayOnAdded=t}},{key:"plugins",get:function(){return this.mPlugins},set:function(t){this.mPlugins=t}},{key:"duration",get:function(){return this.mDuration}},{key:"isPlaying",get:function(){return!0===this.mIsPlaying&&!1===this.mIsPaused}}]),e}();ue.DEFAULT_EASE=he.smootherStep;var ce=function(t){function e(){var t;m(this,e),t=a(this,h(e).call(this)),e.instance=o(o(t)),t.mContext=null;try{t.mContext=new(window.AudioContext||window.webkitAudioContext),t.__unlock()}catch(e){return y.warn("no audio support"),a(t)}return t.mCurrentListener=null,t.mChannels={},t.mMasterChannel=new ge("master"),t.mMasterChannel._outputNode.connect(t.mContext.destination),t.mChannels.master=t.mMasterChannel,t}return l(e,F),f(e,[{key:"__unlock",value:function(){var t=this,e=function e(){var i=t.mContext.createBuffer(1,1,22050),n=t.mContext.createBufferSource();n.buffer=i,n.connect(t.mContext.destination),void 0===n.start?n.noteOn(0):n.start(0),"suspended"===n.context.state&&n.context.resume(),document.removeEventListener("touchstart",e),document.removeEventListener("click",e)};document.addEventListener("touchstart",e),document.addEventListener("click",e)}}],[{key:"createChannel",value:function(t){if(null==e.instance.mChannels[t]){var i=new ge(t);i._outputNode.connect(e.instance.mMasterChannel._inputNode),e.instance.mChannels[t]=i}return e.instance.mChannels[t]}},{key:"getChannel",value:function(t){return e.instance.mChannels[t]}},{key:"_resolveChannel",value:function(t){for(var i in e.instance.mChannels)e.instance.mChannels[i].detachSound(t);var n=""==t.channel?"master":t.channel,s=e.instance.mChannels[n];return s.attachSound(t),s}},{key:"play",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"master",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;y.assert(null!=t,"Param 'nameOrSound' cannot be null.");var r=null;return t.constructor===String&&(r=ft.default.getSound(t)),r.play(e,i,n,s)}},{key:"stopAll",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(""===t)for(var i in e.instance.mChannels)e.instance.mChannels[i].stopAll();else e.getChannel(t).stopAll()}},{key:"looseListener",value:function(){e.context.listener.setPosition(0,0,1),e.currentListener=null}},{key:"_newGainNode",value:function(){return void 0===e.context.createGain?e.context.createGainNode():e.context.createGain()}},{key:"masterVolume",set:function(t){e.instance.mMasterChannel.volume=t},get:function(){return e.instance.mMasterChannel.volume}},{key:"context",get:function(){return e.instance.mContext}},{key:"masterChannel",get:function(){return e.instance.mMasterChannel}},{key:"currentListener",set:function(t){e.instance.mCurrentListener=t},get:function(){return e.instance.mCurrentListener}}]),e}();ce.instance=null;var me=function(){function t(){m(this,t),this.mInputNode=null,this.mOutputNode=null}return f(t,[{key:"_inputNode",get:function(){return y.assert(null!=this.mInputNode,"Input node must be specified in descendant class"),this.mInputNode}},{key:"_outputNode",get:function(){return y.assert(null!=this.mOutputNode,"Output node must be specified in descendant class"),this.mOutputNode}}]),t}(),de=function(t){function e(){var t;return m(this,e),(t=a(this,h(e).call(this))).mGainL=ce._newGainNode(),t.mGainR=ce._newGainNode(),t.mSplitter=ce.context.createChannelSplitter(2),t.mMerger=ce.context.createChannelMerger(2),t.mSplitter.connect(t.mGainL,0),t.mSplitter.connect(t.mGainR,1),t.mGainL.connect(t.mMerger,0,0),t.mGainR.connect(t.mMerger,0,1),t.mValue=0,t.mInputNode=t.mSplitter,t.mOutputNode=t.mMerger,t}return l(e,me),f(e,[{key:"pan",set:function(t){this.mValue=v.clamp(t,-1,1),this.mGainL.gain.setValueAtTime(1-v.clamp(this.mValue,0,1),0),this.mGainR.gain.setValueAtTime(1+v.clamp(this.mValue,-1,0),0)},get:function(){return this.mValue}}]),e}(),fe={NEWBORN:"newborn",PLAYING:"playing",PAUSED:"paused",STOPPED:"stopped",COMPLETED:"completed"},ye=function(t){function e(t){var i;return m(this,e),(i=a(this,h(e).call(this))).mId=++e.ID,i.mSound=t,i.mState=fe.NEWBORN,i.mChannel="master",i.mVolume=1,i.mLoop=!1,i.mStartTime=0,i.mPausePosition=0,i.mSrc=null,i.mGainNode=ce._newGainNode(),i.mFirstNode=i.mGainNode,i.mPlayNode=null,i.mSpatialPanner=null,i.mStereoPanner=null,i.mAnalyser=null,i}return l(e,M),f(e,[{key:"enableSpacePan",value:function(){return null==this.mSpatialPanner&&(this.mSpatialPanner=ce.context.createPanner(),this.mFirstNode&&(this.mSpatialPanner.connect(this.mFirstNode),this.mFirstNode=this.mSpatialPanner),this.__reconnectSource()),this.mSpatialPanner}},{key:"enableStereoPan",value:function(){return null==this.mStereoPanner&&(this.mStereoPanner=new de,this.mFirstNode&&(this.mStereoPanner._outputNode.connect(this.mFirstNode),this.mFirstNode=this.mStereoPanner._inputNode),this.__reconnectSource()),this.mStereoPanner}},{key:"enableAnalyser",value:function(){return null==this.mAnalyser&&(this.mAnalyser=ce.context.createAnalyser(),this.mFirstNode&&(this.mAnalyser.connect(this.mFirstNode),this.mFirstNode=this.mAnalyser),this.__reconnectSource()),this.mAnalyser}},{key:"__reconnectSource",value:function(){null!=this.mSrc&&null!=this.mPlayNode&&null!=this.mFirstNode&&(this.mSrc.disconnect(this.mPlayNode),this.mSrc.connect(this.mFirstNode),this.mPlayNode=this.mFirstNode)}},{key:"_play",value:function(){var t=this;if(this.mState===fe.PLAYING)return this;this.mState=fe.PLAYING;var e=this.mSound.isSubClip&&!this.mLoop?this.mSound.duration-this.mPausePosition:void 0;this.mGainNode.gain.setValueAtTime(this.mVolume,0);var i=ce.context.createBufferSource();return i.buffer=this.mSound.native,i.loop=this.mLoop,i.onended=function(){return t.__onComplete()},this.mFirstNode&&i.connect(this.mFirstNode),this.mPlayNode=this.mFirstNode,this.mStartTime=ce.context.currentTime-this.mPausePosition,this.mLoop&&this.mSound.isSubClip&&(i.loopStart=this.mSound.offset,i.loopEnd=this.mSound.offset+this.mSound.duration),i.start(ce.context.currentTime,this.mSound.offset+this.mPausePosition,e),ce._resolveChannel(this),this.mSrc=i,this}},{key:"stop",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.mState===fe.PLAYING&&(this.mGainNode.gain.cancelScheduledValues(0),this.mSrc.stop(ce.context.currentTime+t))}},{key:"pause",value:function(){this.mState===fe.PLAYING&&(this.stop(),this.mPausePosition=this.currentPosition,this.mState=fe.PAUSED)}},{key:"resume",value:function(){this.mState===fe.PAUSED&&this._play()}},{key:"fade",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"linear";i<=0?this.mGainNode.gain.setValueAtTime(e,0):(this.mGainNode.gain.setValueAtTime(t,0),"exp"===n?this.mGainNode.gain.exponentialRampToValueAtTime(Math.max(e,.01),ce.context.currentTime+i):this.mGainNode.gain.linearRampToValueAtTime(e,ce.context.currentTime+i))}},{key:"__onComplete",value:function(){this.mSrc=null,this.mState!==fe.PAUSED&&(this.mStartTime=0,this.mState=fe.COMPLETED,this.post(N.COMPLETE))}},{key:"currentPosition",get:function(){switch(this.mState){case fe.PLAYING:return(ce.context.currentTime-this.mStartTime)%(this.mSound.duration+.01);case fe.PAUSED:return this.mPausePosition;case fe.COMPLETED:return this.mSound.duration}return 0}},{key:"_outputNode",get:function(){return this.mGainNode}},{key:"channel",get:function(){return this.mChannel},set:function(t){this.mChannel!==t&&(this.mChannel=t,this.mState===fe.PLAYING&&ce._resolveChannel(this))}},{key:"volume",get:function(){return this.mVolume},set:function(t){this.mVolume=t,this.mGainNode.gain.setValueAtTime(this.mVolume,0)}},{key:"loop",get:function(){return this.mLoop},set:function(t){this.mLoop=t}},{key:"pan",get:function(){return this.mStereoPanner.pan},set:function(t){0!==t&&null==this.mStereoPanner&&this.enableStereoPan(),this.mStereoPanner&&(this.mStereoPanner.pan=t)}},{key:"isPlaying",get:function(){return this.mState===fe.PLAYING}},{key:"duration",get:function(){return this.mSound.duration}}]),e}();ye.ID=0;var ve=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:NaN,s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];m(this,t),this.mNativeBuffer=e,this.mStartOffset=i,this.mDuration=n||e.duration,this.mIsSubClip=s}return f(t,[{key:"play",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"master",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=new ye(this);return s.channel=t,s.volume=e,s.loop=i,s.pan=n,s._play()}},{key:"collectWaveData",value:function(t){for(var e=[],i=0;i<this.mNativeBuffer.numberOfChannels;i++)e[i]=this.mNativeBuffer.getChannelData(i);for(var n=this.mDuration/this.mNativeBuffer.duration,s=this.mStartOffset/this.mNativeBuffer.duration,r=~~(e[0].length*s),a=r+~~(e[0].length*n),o=new Float32Array(t),h=~~(e[0].length*n/t),l=[],u=r,m=0;u<a;u++)if(l.push(this.__averagePeak(e,u)),l.length>=h){var d=Math.max.apply(Math,c(l)),f=Math.min.apply(Math,c(l));o[m++]=(d+f)/2,l=[]}return o}},{key:"__averagePeak",value:function(t,e){var i=0;return t.forEach(function(t){return i+=Math.abs(t[e])}),i/t.length}},{key:"native",get:function(){return this.mNativeBuffer}},{key:"offset",get:function(){return this.mStartOffset}},{key:"duration",get:function(){return this.mDuration}},{key:"isSubClip",get:function(){return this.mIsSubClip}}]),t}(),pe=function(t){function e(t,i){var n;if(m(this,e),(n=a(this,h(e).call(this,t))).mClips={},null!==i)for(var s in i.sounds)n.addSubSound(s,i.sounds[s][0],i.sounds[s][1]);return n}return l(e,ve),f(e,[{key:"addSubSound",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:NaN;return this.mClips[t]=new ve(this.native,e,i,!0),this.mClips[t]}},{key:"removeSubSound",value:function(t){delete this.mClips[t]}},{key:"playSubSound",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"master",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=this.mClips[t];if(null==r)return null;var a=new ye(r);return a.channel=e,a.volume=i,a.loop=n,a.pan=s,a._play()}},{key:"subSounds",get:function(){return this.mClips}}]),e}(),ge=function(){function t(e){m(this,t),this.mName=e,this.mGain=ce._newGainNode(),this.mSounds=[],this.mEffects=[]}return f(t,[{key:"attachSound",value:function(t){var e=this;y.assert(null!=t,"Sound cannot be null"),t._outputNode.connect(this._inputNode),this.mSounds.push(t),t.on(N.COMPLETE,function(){e.mSounds.splice(e.mSounds.indexOf(t),1),t._outputNode.disconnect(0)})}},{key:"detachSound",value:function(t){y.assert(null!=t,"Sound cannot be null");var e=this.mSounds.indexOf(t);e>-1&&(this.mSounds.splice(e,1),t._outputNode.disconnect(0))}},{key:"stopAll",value:function(){for(var t=this.mSounds[0];this.mSounds.length;t=this.mSounds.shift())t.stop()}},{key:"addEffect",value:function(t){return y.assert(null!=t,"Effect cannot be null"),t._outputNode.connect(this._inputNode),this.mEffects.unshift(t),this.__reconnectSounds(),t}},{key:"removeEffect",value:function(t){return y.assert(null!=t,"Effect cannot be null"),t._outputNode.disconnect(0),this.mEffects.splice(this.mEffects.indexOf(t),1),this.__reconnectSounds(),t}},{key:"removeAllEffects",value:function(){for(;this.mEffects.length;this.mEffects.shift())this.mEffects[0]._outputNode.disconnect(0);this.__reconnectSounds()}},{key:"__reconnectSounds",value:function(){var t=this;this.mSounds.forEach(function(e){e._outputNode.disconnect(0),e._outputNode.connect(t._inputNode)})}},{key:"volume",set:function(t){this.mGain.gain.setValueAtTime(t,0)},get:function(){return this.mGain.gain.value}},{key:"_inputNode",get:function(){return this.mEffects.length?this.mEffects[0]._inputNode:this.mGain}},{key:"_outputNode",get:function(){return this.mGain}}]),t}(),ke=function(){function t(){m(this,t),this.axis=null,this.verticesA=null,this.verticesB=null,this.rangeA=new be,this.rangeB=new be,this.offset=0}return f(t,[{key:"set",value:function(t,e,i){this.verticesA=t,this.verticesB=e,this.axis=i,this.refresh()}},{key:"refresh",value:function(){t.__project(this.verticesA,this.axis,this.rangeA),t.__project(this.verticesB,this.axis,this.rangeB)}}],[{key:"__project",value:function(t,e,i){for(var n=Number.MAX_VALUE,s=-Number.MAX_VALUE,r=0,a=t.length;r<a;r++){var o=t[r].dot(e);n=o<n?o:n,s=o>s?o:s}i.min=n,i.max=s}}]),t}(),be=function t(){m(this,t),this.min=0,this.max=0},we=function(){function t(){m(this,t),this.a=null,this.b=null,this.bodyA=null,this.bodyB=null,this.mInCollision=!1,this.mIsStatic=!1,this.mNormalImpulse=0,this.mTangentImpulse=0,this.mPositionImpulse=0,this.mFriction=0,this.mBias=0,this.mMass=0,this.mOffset=new x,this.mNormal=new x,this.mOverlap=0,this.mChanged=!1}return f(t,[{key:"test",value:function(){return this.mInCollision}},{key:"preSolve",value:function(){var e=this.mNormal.x,i=this.mNormal.y,n=-i,s=+e,r=this.bodyA.mPosition,a=this.bodyB.mPosition,o=this.bodyA.mVelocity,h=this.bodyB.mVelocity,l=this.bodyA.mInvMass,u=this.bodyB.mInvMass,c=this.mOffset,m=this.mNormalImpulse*e+this.mTangentImpulse*n,d=this.mNormalImpulse*i+this.mTangentImpulse*s;c.x=a.x-r.x,c.y=a.y-r.y,o.x-=m*l,o.y-=d*l,h.x+=m*u,h.y+=d*u;var f=(h.x-o.x)*e+(h.y-o.y)*i;this.mBias=f<-t.bounceTrashhold?-Math.max(this.bodyA.bounce,this.bodyB.bounce)*f:0,this.mMass=1/(l+u),this.mFriction=Math.min(this.bodyA.friction,this.bodyB.friction),this.mPositionImpulse=0}},{key:"solveVelocity",value:function(){var t=this.mNormal.x,e=this.mNormal.y,i=-e,n=+t,s=this.bodyA.mVelocity,r=this.bodyB.mVelocity,a=this.bodyA.mInvMass,o=this.bodyB.mInvMass,h=-((r.x-s.x)*t+(r.y-s.y)*e-this.mBias)*this.mMass,l=Math.max(this.mNormalImpulse+h,0);h=l-this.mNormalImpulse,this.mNormalImpulse=l;var u=h*t,c=h*e;s.x-=u*a,s.y-=c*a,r.x+=u*o,r.y+=c*o;var m=-((r.x-s.x)*i+(r.y-s.y)*n)*this.mMass,d=this.mFriction*this.mNormalImpulse,f=v.clamp(this.mTangentImpulse+m,-d,d);m=f-this.mTangentImpulse,this.mTangentImpulse=f;var y=m*i,p=m*n;s.x-=y*a,s.y-=p*a,r.x+=y*o,r.y+=p*o}},{key:"solvePosition",value:function(){var e=this.mNormal.x,i=this.mNormal.y,n=this.bodyA.mInvMass,s=this.bodyB.mInvMass,r=this.bodyA.mPosition,a=this.bodyB.mPosition,o=this.mOffset,h=o.x-a.x+r.x,l=o.y-a.y+r.y,u=(this.mOverlap+(h*e+l*i)-t.slop)*t.baumgarte;if(!(u<=0)){var c=u*this.mMass,m=this.mPositionImpulse;this.mPositionImpulse=Math.max(m+c,0);var d=(c=this.mPositionImpulse-m)*e,f=c*i;r.x-=d*n,r.y-=f*n,a.x+=d*s,a.y+=f*s}}}],[{key:"__id",value:function(t,e){return t.mId>e.mId?"".concat(t.mId,"&").concat(e.mId):"".concat(e.mId,"&").concat(t.mId)}}]),t}();we.timeToSleep=5,we.slop=.5,we.baumgarte=.2,we.unitsPerMeter=1,we.sleepThreshold=.1*we.unitsPerMeter,we.bounceTrashhold=we.unitsPerMeter;var _e=function(t){function e(){var t;m(this,e),(t=a(this,h(e).call(this))).a=null,t.b=null;for(var i=[],n=0;n<4;n++)i.push(new ke);return t.mProjections=i,t}return l(e,we),f(e,[{key:"set",value:function(t,e,i,n){this.a=t,this.b=e,this.bodyA=i,this.bodyB=n;for(var s=this.mProjections,r=0,a=0;r<4;r+=2,a+=1)s[r].set(t.mVertices,e.mVertices,t.mNormals[a]),s[r+1].set(t.mVertices,e.mVertices,e.mNormals[a]);return this}},{key:"__refreshProjectionsRanges",value:function(){for(var t=this.mProjections,e=0;e<4;e++)t[e].refresh()}},{key:"test",value:function(){var t=this.a,e=this.b;if((t.mChanged||e.mChanged)&&(this.mChanged=!0),t.mMax.x<e.mMin.x||t.mMin.x>e.mMax.x||t.mMax.y<e.mMin.y||t.mMin.y>e.mMax.y)return this.mInCollision=!1;var i=this.mProjections,n=this.mNormal,s=this.bodyB.mPosition.x-this.bodyA.mPosition.x,r=this.bodyB.mPosition.y-this.bodyA.mPosition.y;this.mChanged&&(this.mChanged=!1,this.__refreshProjectionsRanges()),this.mOverlap=Number.MAX_VALUE;for(var a=0;a<4;a++){var o=i[a];o.offset=o.axis.x*s+o.axis.y*r;var h=o.rangeA.min,l=o.rangeA.max,u=o.rangeB.min+o.offset;if(h>o.rangeB.max+o.offset||u>l)return this.mInCollision=!1}for(var c=0;c<4;c++){var m=i[c],d=m.rangeA.min,f=m.rangeA.max,y=m.rangeB.min+m.offset,v=m.rangeB.max+m.offset,p=f-y,g=v-d,k=p<g?p:-g;d<y&&f<v?k=f-y:f>v&&(k=d-v);var b=Math.abs(k);b<this.mOverlap&&(this.mOverlap=b,n.copyFrom(m.axis),k<0&&n.multiplyScalar(-1))}return this.mInCollision=!0}}]),e}();_e.pool=new g(_e,100);var xe=function(t){function e(){var t;return m(this,e),(t=a(this,h(e).call(this))).a=null,t.b=null,t.mBoxHalfWidth=0,t.mBoxHalfHeight=0,t.mBoxRotate=new x,t.mCircleCenter=new x,t}return l(e,we),f(e,[{key:"set",value:function(t,e,i,n){return this.a=t,this.b=e,this.bodyA=i,this.bodyB=n,this}},{key:"__rotate",value:function(t,e,i,n,s){var r=t.x-e,a=t.y-i,o=n*r-s*a,h=s*r+n*a;t.x=o+e,t.y=h+i}},{key:"test",value:function(){var t=this.a,e=this.b;if(t.mChanged&&(this.mChanged=!0),t.mMax.x<e.mMin.x||t.mMin.x>e.mMax.x||t.mMax.y<e.mMin.y||t.mMin.y>e.mMax.y)return this.mInCollision=!1;if(this.mChanged){this.mChanged=!1;var i=this.bodyA.mTransform.data,n=Math.sqrt(i[0]*i[0]+i[1]*i[1]),s=Math.sqrt(i[2]*i[2]+i[3]*i[3]);this.mBoxRotate.set(i[0]/n,i[1]/n),this.mBoxHalfWidth=t.mRect.width/2*n,this.mBoxHalfHeight=t.mRect.height/2*s}var r=this.mBoxRotate,a=this.mNormal,o=this.mCircleCenter.copyFrom(e.mCenter),h=this.mBoxHalfWidth,l=this.mBoxHalfHeight,u=0!==r.y;u&&this.__rotate(o,t.mCenter.x,t.mCenter.y,r.x,-r.y);var c=o.x-t.mCenter.x,m=o.y-t.mCenter.y;if(0===c&&0===m)return this.mOverlap=e.mRadius+h,a.set(-1,0),this.mInCollision=!0;var d=v.clamp(c,-h,h),f=v.clamp(m,-l,l),y=c===d&&m===f;y&&(Math.abs(c)>Math.abs(m)?d=d>0?h:-h:f=f>0?l:-l);var p=c-d,g=m-f,k=p*p+g*g,b=e.mRadius;if(k>b*b&&!y)return this.mInCollision=!1;if(0===k)this.mOverlap=b,a.set(0,1);else{var w=Math.sqrt(k);this.mOverlap=b-w,y?a.set(-p/w,-g/w):a.set(p/w,g/w)}return u&&this.__rotate(a,0,0,r.x,r.y),this.mInCollision=!0}}]),e}();xe.pool=new g(xe,100);var Ce=function(t){function e(){var t;return m(this,e),(t=a(this,h(e).call(this))).a=null,t.b=null,t}return l(e,we),f(e,[{key:"set",value:function(t,e,i,n){return this.a=t,this.b=e,this.bodyA=i,this.bodyB=n,this}},{key:"test",value:function(){var t=this.a,e=this.b,i=e.mCenter.x-t.mCenter.x,n=e.mCenter.y-t.mCenter.y,s=t.mRadius+e.mRadius;if(0===i&&0===n)return this.mOverlap=s,this.mNormal.set(1,0),this.mInCollision=!0;var r=i*i+n*n;if(r>s*s)return this.mInCollision=!1;var a=Math.sqrt(r);return this.mOverlap=s-a,this.mNormal.set(i/a,n/a),this.mInCollision=!0}}]),e}();Ce.pool=new g(Ce,100);var Se=function(){function t(){m(this,t),this.data=null}return f(t,[{key:"parse",value:function(t){return this.data=t,null}}]),t}(),Te="M",Pe="m",Ae="L",Re="l",Ee="V",Oe="v",Ne="H",De="h",Me="C",Le="c",Ie="S",Be="s",He="Q",Fe="q",Xe="T",Ve="t",Ge="A",ze="a",Ye="Z",je="r",Ue="c",We="e",qe="l",Qe="s",Ke="p",Ze="g",Je=function(t){function e(){return m(this,e),a(this,h(e).apply(this,arguments))}return l(e,Se),f(e,[{key:"parse",value:function(t){return r(h(e.prototype),"parse",this).call(this,t),this.__traverse(t,this.__parseStyles(),new Dt,new $e)}},{key:"__traverse",value:function(t,e,i,n){var s=this,r=new Dt,a=n.clone();if(i.mNodes.push(r),t.id&&(r.name=t.id),t.t){var o=t.t[0]||0,h=t.t[1]||0,l=t.t[2]||1,u=t.t[3]||1,m=t.t[5]||0,d=t.t[6]||0;r.mTransform.rotate(t.t[4]||0),r.mTransform.scale(l,u),r.mTransform.skew(t.t[7]||0,t.t[8]||0),r.mTransform.data[4]=o+m/l,r.mTransform.data[5]=h+d/u,r.mPivotX=m,r.mPivotY=d}if(t.cmds)for(var f=t.cmds.split("$").filter(function(t){return t}).reverse(),y="";f.length>0;){var v=f.pop(),p=v[0],g=v.slice(1).split(",").map(function(t){return Number(t)});switch(r.beginPath(),"S"!==y&&"S"!==p&&(r.fillStyle(0,1),r.lineStyle(1,0,1,Ht.NONE,Ft.MITER,4)),y=p,p){case"S":var k=e[g[0]];(a=n.clone()).merge(k),a.compute(),a.needsFill&&r.fillStyle(a.fillColor,a.fillAlpha),a.needsStroke&&r.lineStyle(a.lineWidth,a.lineColor,a.lineAlpha,a.lineCap,a.lineJoin,a.miterLimit);break;case Ke:this.__drawPath(v,r);break;case je:var b=g[0],w=g[1],_=g[2],x=g[3],C=(void 0===g[4]?g[5]:g[4])||0,S=(void 0===g[5]?g[4]:g[5])||0;0!==C&&0!==S?(r.moveTo(b,w+S),r.quadraticCurveTo(b,w,b+C,w),r.lineTo(b+_-C,w),r.quadraticCurveTo(b+_,w,b+_,w+S),r.lineTo(b+_,w+x-S),r.quadraticCurveTo(b+_,w+x,b+_-C,w+x),r.lineTo(b+C,w+x),r.quadraticCurveTo(b,w+x,b,w+x-S),r.closePath()):r.rect(g[0],g[1],g[2],g[3]);break;case Ue:r.circle(g[0],g[1],g[2]);break;case We:var T=g[0],P=g[1],A=g[2],R=g[3],E=c(this.__arcToBezier(T-A,P,A,R,0,0,0,T+A,P)).concat(c(this.__arcToBezier(T+A,P,A,R,0,0,0,T-A,P)));r.moveTo(T-A,P);for(var O=0,N=E.length;O<N;O++){var D=E[O];r.bezierCurveTo(D[2],D[3],D[4],D[5],D[6],D[7])}break;case qe:var M=g[0],L=g[1],I=g[2],B=g[3];r.moveTo(M,L),r.lineTo(I,B);break;case Qe:case Ze:var H=v.slice(1).split(",");r.moveTo(H[0],H[1]);for(var F=2,X=H.length;F<X;F+=2)r.lineTo(H[F],H[F+1]);p===Ze&&r.closePath()}a.needsFill&&r.fill(a.fillRule),a.needsStroke&&(r.setLineDash(a.lineDash),r.stroke())}return t.nodes&&t.nodes.forEach(function(t){s.__traverse(t,e,r,a)}),r}},{key:"__parseStyles",value:function(){var t=this.data;if(t.styles)return t.styles.map(function(t){var e={};return t.split(" ").forEach(function(t){var i=t[0];e[i]=t.slice(1)}),e})}},{key:"__drawPath",value:function(t,e){var i=[];t.split(",").map(function(t){for(;0!==t.length;){var e=parseFloat(t);if(isNaN(e))i.push(t.charAt(0)),t=t.slice(1);else{i.push(e);for(var n=1;;n++)if(parseFloat(t.slice(0,n))===e){t=t.slice(n);break}}}}),i.reverse();for(var n=0,s=0,r=0,a=0,o=0,h=0,l="",u=0,c=0;0!==i.length;){var m=i[i.length-1],d=m===m.toString()?i.pop():l;switch(l=d,u=c=0,d===d.toLowerCase()&&(u=n,c=s),d){case Te:case Pe:n=i.pop()+u,s=i.pop()+c,e.moveTo(n,s),r=n,a=s;break;case Ae:case Re:n=i.pop()+u,s=i.pop()+c,e.lineTo(n,s);break;case Ee:case Oe:s=i.pop()+c,e.lineTo(n,s);break;case Ne:case De:n=i.pop()+u,e.lineTo(n,s);break;case Me:case Le:var f=i.pop()+u,y=i.pop()+c,v=i.pop()+u,p=i.pop()+c;n=i.pop()+u,s=i.pop()+c,e.bezierCurveTo(f,y,v,p,n,s),o=2*n-v,h=2*s-p;break;case Ie:case Be:var g=i.pop()+u,k=i.pop()+c;n=i.pop()+u,s=i.pop()+c,e.bezierCurveTo(o,h,g,k,n,s),o=2*n-g,h=2*s-k;break;case He:case Fe:var b=i.pop()+u,w=i.pop()+c;n=i.pop()+u,s=i.pop()+c,e.quadraticCurveTo(b,w,n,s),2*n-b,2*s-w;break;case Xe:case Ve:var _=i.pop(),x=i.pop();n=i.pop()+u,s=i.pop()+c,e.quadraticCurveTo(_,x,n,s),2*n-_,2*s-x;break;case Ge:case ze:var C=n,S=s,T=i.pop(),P=i.pop(),A=i.pop(),R=i.pop(),E=i.pop();n=i.pop()+u,s=i.pop()+c;var O=this.__arcToBezier(C,S,T,P,A,R,E,n,s);if(!O)break;for(var N=0,D=O.length;N<D;N++){var M=O[N];e.bezierCurveTo(M[2],M[3],M[4],M[5],M[6],M[7])}break;case Ye:e.closePath(),n=r,s=a}d!==Me&&d!==Le&&d!==Ie&&d!==Be&&(o=n,h=s),d!==He&&d!==Fe&&d!==Xe&&d!==Ve&&(n,s)}}},{key:"__approxUnitArc",value:function(t,e){var i=4/3*Math.tan(e/4),n=Math.cos(t),s=Math.sin(t),r=Math.cos(t+e),a=Math.sin(t+e);return[n,s,n-s*i,s+n*i,r+a*i,a-r*i,r,a]}},{key:"__vectorAngle",value:function(t,e,i,n){var s=t*n-e*i<0?-1:1,r=v.clamp(t*i+e*n,-1,1);return s*Math.acos(r)}},{key:"__getArcCenter",value:function(t,e,i,n,s,r,a,o,h,l){var u=l*(t-i)/2+h*(e-n)/2,c=-h*(t-i)/2+l*(e-n)/2,m=a*a,d=o*o,f=u*u,y=c*c,v=Math.max(0,m*d-m*y-d*f);v/=m*y+d*f;var p=(v=Math.sqrt(v)*(s===r?-1:1))*a/o*c,g=v*-o/a*u,k=l*p-h*g+(t+i)/2,b=h*p+l*g+(e+n)/2,w=(u-p)/a,_=(c-g)/o,x=(-u-p)/a,C=(-c-g)/o,S=this.__vectorAngle(1,0,w,_),T=this.__vectorAngle(w,_,x,C);return 0===r&&T>0&&(T-=2*Math.PI),1===r&&T<0&&(T+=2*Math.PI),[k,b,S,T]}},{key:"__arcToBezier",value:function(t,e,i,n,s,r,a,o,h){var l=Math.sin(s*Math.PI/180),u=Math.cos(s*Math.PI/180),c=u*(t-o)/2+l*(e-h)/2,m=-l*(t-o)/2+u*(e-h)/2;if((0!==c||0!==m)&&0!==i&&0!==n){i=Math.abs(i),n=Math.abs(n);var d=c*c/(i*i)+m*m/(n*n);if(d>1){var f=Math.sqrt(d);i*=f,n*=f}var y=this.__getArcCenter(t,e,o,h,r,a,i,n,l,u),v=[],p=y[2],g=y[3],k=Math.max(Math.ceil(Math.abs(g)/(.5*Math.PI)),1);g/=k;for(var b=0;b<k;b++)v.push(this.__approxUnitArc(p,g)),p+=g;return v.map(function(t){for(var e=0;e<t.length;e+=2){var s=t[e]*i,r=t[e+1]*n,a=u*s-l*r,o=l*s+u*r;t[e]=a+y[0],t[e+1]=o+y[1]}return t})}}}]),e}(),$e=function(){function t(){m(this,t),this.L="-",this.l=1,this.w=1,this.F="0",this.f=1,this.r=1,this.c="b",this.j="m",this.m=4,this.a=1,this.d="",this.needsFill=!0,this.needsStroke=!1,this.fillColor=0,this.fillAlpha=1,this.lineColor=0,this.lineAlpha=1,this.lineWidth=1,this.lineCap=Ht.NONE,this.lineJoin=Ft.MITER,this.miterLimit=this.m,this.fillRule=Xt.NONE_ZERO,this.lineDash=[]}return f(t,[{key:"merge",value:function(t){t.hasOwnProperty("F")&&(this.F=t.F),t.hasOwnProperty("L")&&(this.L=t.L),t.hasOwnProperty("w")&&(this.w=t.w),t.hasOwnProperty("l")&&(this.l*=t.l),t.hasOwnProperty("f")&&(this.f*=t.f),t.hasOwnProperty("r")&&(this.r=t.r),t.hasOwnProperty("c")&&(this.c=t.c),t.hasOwnProperty("j")&&(this.j=t.j),t.hasOwnProperty("m")&&(this.m=t.m),t.hasOwnProperty("a")&&(this.a=t.a),t.hasOwnProperty("d")&&(this.d=t.d)}},{key:"compute",value:function(){this.needsFill="-"!==this.F,this.needsFill&&(this.fillColor=parseInt(this.F,16)),this.lineWidth=+this.w,this.needsStroke="-"!==this.L&&this.lineWidth>0,this.needsStroke&&(this.lineColor=parseInt(this.L,16));var t=Number(this.a);this.lineAlpha=Number(this.l)*t,this.fillAlpha=Number(this.f)*t,this.lineCap={b:Ht.NONE,r:Ht.ROUND,s:Ht.SQUARE}[this.c],this.lineJoin={m:Ft.MITER,r:Ft.ROUND,b:Ft.BEVEL}[this.j],this.miterLimit=Number(this.m),this.fillRule={1:Xt.NONE_ZERO,0:Xt.EVEN_ODD}[this.r],this.lineDash=this.d.split(",").map(function(t){return Number(t)})}},{key:"clone",value:function(){var e=new t;return e.L=this.L,e.l=this.l,e.w=this.w,e.F=this.F,e.f=this.f,e.r=this.r,e.c=this.c,e.j=this.j,e.m=this.m,e.a=this.a,e}}]),t}(),ti=function(t){function e(){return m(this,e),a(this,h(e).call(this,!1))}return l(e,M),f(e,[{key:"show",value:function(){var t=this,i=.001*e.duration,n="#logo,#splash-screen{position:relative;box-sizing:border-box}#logo-inner,#logo-name{margin-left:auto;margin-right:auto}#splash-screen{z-index:999;top:0;left:0;width:100%;height:100%;display:block;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAYAAACp8Z5+AAAAIklEQVQYV2OUkpL6/+zZMwYpKSkGEM3IwMDwnwEJMBJUAQCLUhABUGRZzwAAAABJRU5ErkJggg==);opacity:1;animation:hide 0s ease-in ".concat(i,"s forwards}@keyframes hide{to{opacity:0}}#logo{top:20%;left:50%;animation:fadein ").concat(i,"s linear forwards}@keyframes fadein{0%{opacity:0}100%,40%{opacity:1}}#logo-name{width:100%;margin-top:108px}"),s=document.createElement("style");s.type="text/css",s.innerHTML=n,document.getElementsByTagName("head")[0].appendChild(s);var r=document.getElementById(ei.instance.containerElementId),a=r.style.overflow;r.style.overflow="hidden";var o=document.createElement("div");o.id="splash-screen",r.appendChild(o);var h=document.createElement("div");h.id="logo",o.appendChild(h);var l=document.createElement("div");l.id="logo-inner",l.innerHTML=e.SVG_LOGO,h.appendChild(l);var u=document.createElement("div");u.id="logo-name",u.innerHTML=e.SVG_TEXT,h.appendChild(u);var c=function(){var e=o.offsetWidth,i=o.offsetHeight,n=t.calculateAspectRatioFit(e,i,.5*e,.5*i);h.style.width="".concat(n.width,"px"),h.style.height="".concat(n.height,"px"),h.style.marginLeft="".concat(.5*-n.width,"px"),l.style.width="".concat(Math.min(n.width,n.height),"px"),l.style.height="".concat(Math.min(n.width,n.height),"px"),u.style.width="".concat(.9*Math.min(n.width,n.height),"px"),u.style.height="".concat(Math.min(n.width,n.height),"px"),u.style.marginTop="".concat(12,"px")};c();var m=r.offsetWidth,d=r.offsetHeight,f=setInterval(function(t){m===r.offsetWidth&&d===r.offsetHeight||(m=r.offsetWidth,d=r.offsetHeight,c())},1e3/60);setTimeout(function(){clearTimeout(f),s.parentNode.removeChild(s),o.parentNode.removeChild(o),r.style.overflow=a,t.post(N.COMPLETE)},e.duration),this.post(N.COMPLETE)}},{key:"calculateAspectRatioFit",value:function(t,e,i,n){var s=Math.min(i/t,n/e);return{width:t*s,height:e*s}}}]),e}();ti.duration=4200,ti.enabled=!0,ti.SVG_LOGO='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 241.8 220.2"><defs><style>.b{fill:#f5f5f5}.c{fill:url(#a)}</style><pattern id="a" width="17.6" height="14.87" patternUnits="userSpaceOnUse" viewBox="0 0 17.6 14.9"><path fill="none" d="M0 0h17.6v14.87H0z"/><path class="b" d="M0 13.4v1.5h1.5A1.5 1.5 0 0 1 0 13.4z"/><path class="b" d="M8.8 0a1.5 1.5 0 0 1 1.5 1.5 1.5 1.5 0 1 1-3 0A1.5 1.5 0 0 1 8.8 0H0v13.4a1.5 1.5 0 0 1 1.5-1.5A1.5 1.5 0 0 1 3 13.4a1.5 1.5 0 0 1-1.5 1.5h4.3a1.5 1.5 0 0 1-1.5-1.5 1.5 1.5 0 0 1 1.5-1.5 1.4 1.4 0 0 1 1.5 1.5 1.5 1.5 0 0 1-1.5 1.5h6a1.5 1.5 0 0 1-1.5-1.5 1.5 1.5 0 0 1 3 0 1.5 1.5 0 0 1-1.5 1.5h5.8V0zm6.6.7a1.5 1.5 0 0 1 1.5 1.5 1.5 1.5 0 0 1-1.5 1.5 1.4 1.4 0 0 1-1.5-1.5A1.5 1.5 0 0 1 15.4.7zM.4 2.2A1.5 1.5 0 0 1 1.9.7a1.5 1.5 0 0 1 1.5 1.5 1.5 1.5 0 0 1-1.5 1.5A1.5 1.5 0 0 1 .4 2.2zm1.7 5.7A1.5 1.5 0 0 1 .6 6.4a1.5 1.5 0 0 1 1.5-1.5 1.5 1.5 0 0 1 0 3zm2 3.8a1.5 1.5 0 0 1-1.5-1.5 1.5 1.5 0 0 1 1.5-1.5 1.5 1.5 0 0 1 1.5 1.5 1.5 1.5 0 0 1-1.5 1.5zm.2-8a1.5 1.5 0 0 1 1.5-1.5 1.5 1.5 0 0 1 1.5 1.5 1.4 1.4 0 0 1-1.5 1.5 1.5 1.5 0 0 1-1.5-1.5zm2.2 3.5a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0zm2.2 5.3a1.5 1.5 0 1 1 1.5-1.5 1.5 1.5 0 0 1-1.5 1.5zm1.4-8a1.5 1.5 0 0 1 3 0 1.5 1.5 0 1 1-3 0zm2.5 5.7a1.5 1.5 0 0 1-1.5-1.5 1.5 1.5 0 0 1 1.5-1.5 1.4 1.4 0 0 1 1.5 1.5 1.5 1.5 0 0 1-1.5 1.5zm3 3.5a1.5 1.5 0 0 1-1.5-1.5 1.5 1.5 0 0 1 1.5-1.5 1.5 1.5 0 0 1 1.5 1.5 1.4 1.4 0 0 1-1.5 1.5zm0-5.5a1.5 1.5 0 0 1-1.5-1.5 1.5 1.5 0 0 1 1.5-1.5 1.5 1.5 0 0 1 1.5 1.5 1.4 1.4 0 0 1-1.5 1.5z"/></pattern></defs><path class="c" d="M25.8 105.2c12.1 8.8 29.7 6.7 59.8 6.8-7.9-7.3-9.1-18.7-7.1-27.3-6.6 7.3-5.1 19.3-12.8 19.4-3.4.1-6.9-4.7-8.3-10.8-5.3 9.4-12 10.7-14.7-4.5-2.3 2-3.9 8.2-9.5 6.2S26.8 81.8 30 71.3A28.3 28.3 0 0 1 14.6 61c-1.4 20.8.5 36.4 11.2 44.2zM51.9 39.9c29.7-3.6 54-22.8 69.5-26.3-.1 0-40.7-.3-72.3 1.9 6.2 3.5 10.5 16.3 2.8 24.4zM170.4 34.2c5.6-2 32.1-9.5 54.4-2.7-3-13.7-22.9-17-71.8-17.8a32.2 32.2 0 0 1 17.4 20.5zM211.3 109.3c-12.2 2.1-12.8-8.8-32.9-8.9-15.5 0-35.2 13.2-36.1 13.7h49.3c19.1 0 32.5-.6 35.5-7.3s-2.7-12.3-10.7-15.6c5.3 5.6 4.1 16.5-5.1 18.1zM66 189.2c-5.9 5-26 17.8-43.6 6.3 3.6 8.4 13.6 12.7 45.1 12-1.6-2.4-5.3-10.4-1.5-18.3zM32 161.5c7.3 7.8 18.1 2.6 33.7-6.2 10.5-6 27.5-9.9 40.6-1.1 3.7-8.7 5.4-10.9 6.7-10.6s.7 2.7 5.6 7c.4-1 3.8-7.9 3.8-12l-59.9-.8c-1.5 6.6-9.9 19-23.9 17.4-2.4-.3-2.5-11.6 2.4-16.9a36.7 36.7 0 0 0-7.4.9c-4.4 5.1-7 16.4-1.6 22.3zM150.9 148.1c23.6-.5 26 19.9 41.1 21 10.9.9 13.6-16.8 35.7-11.8-1.3-11.1-7.7-16.2-22.2-17.4 3 10.3-6.6 28.5-19.3 21.5a1.5 1.5 0 0 1-.8-1.1c-.9-11 2.8-15.8 7.5-20.7l-55.7-.7a18.5 18.5 0 0 1 3.7 12.4 20.7 20.7 0 0 1 10-3.2zM162 195.9c-3.9 3.6-3.8 9.5-2.5 12.5h4.1c0-14.8 17-12.8 21.2-.8 22.7-1.5 30.9-3.2 36-8.7s6.4-15.3 6.8-27.1c-2.6 3-9.8 14.7-10.9 16.4-17.8 26.3-39.9-5.9-54.7 7.7z"/><path class="b" d="M150 42.6c-.2 10.4-9.8 13.6-9.4-.7-16.2 1.9-14.5 8.5-13.7 9.5 4.4 5.6 29 4.5 27.3-4.3a5.7 5.7 0 0 0-4.2-4.5z"/><path class="b" d="M162.2 46.4c-1.7-15.7-17.2-18.2-28.4-15.6s-22.3 12.7-15.6 25.4 46.2 10.3 44-9.8zm-37.8 6.7c-5.4-9.7 10.6-13.4 13.2-13.8 7.5-1.3 18.2-1.2 19.6 7.6 2 13.2-28.8 13.3-32.8 6.2zM184.7 68.8c-1.1 0-1.1 3.3-5.4 12.5.3 0 5.8 0 8.6.2-.7-9.1-2.1-12.7-3.2-12.7zM162.5 82.9l7-1.1c-2.5-4.6-5.8-8.6-7 1.1zM153.1 74.5a55.8 55.8 0 0 0-7.8 2c6.4 9.4 7.4 2.2 7.8-2zM134.8 94.6c.4-.2 4.9-3.1 6.9-4.1-1.9-2-8.1-9.9-6.9 4.1zM190.9 81.8a58.3 58.3 0 0 1 9 1.5 77.7 77.7 0 0 0 .4-8.8c-1.7-.3-7.2-1.2-10.3-1.5a52 52 0 0 1 .9 8.8z"/><path class="b" d="M216.5 76.2a39.1 39.1 0 0 1-5.6 10.4c13 3 25.3 10.8 18.1 23.1-3.8 6.6-16.4 7.5-37.4 7.5l-55.4-.2a32.3 32.3 0 0 1-18.8 1.1c-6.8 1.5-18.2 3.7-28.2-3.1-30.8-.4-49.7 3.2-64.9-7.1C6.4 95.7 11.6 60.3 12 56.8c-6.4-12.5-.8-29.4 2.3-34.1S29.4 7.5 44.4 13c.2-.1 27.5-2.4 76-2.4 74.4 0 105.2.8 107.6 22.3 6 2.4 13.2 13 6.2 21 4.8 9.4.1 19.1-9.7 21.5a37.4 37.4 0 0 1 10.7 5.7c1.4-2.5 8.5-19.8 4.8-41.9-4.5-27.1-17.9-33.2-35.4-34.9C157.9 0 88.5.2 81.7.1 38.1-.3 18.2-.5 8.1 22.2-3.1 47.6-2.6 91.7 9.1 108c7.7 10.7 19.1 15.3 37.9 15.3 34.5 0 141.3 1.4 165.3 1.8 11-.3 27.9-3.4 29.3-19.7s-6.8-25.2-25.1-29.2z"/><path class="b" d="M202.7 88.6c1.3-.2 6.5-2 10.7-12.6-3-.2-6.3-.5-10.1-1.1.8 11.4-3 14-.6 13.7z"/><path class="b" d="M231.9 56c-7.6 5.5-18.2 1.8-19.8-3.4-2.6-8.6 4.4-10.9 6.7-10.6 7.7.8 7 6.1 4 8.1a1.5 1.5 0 0 1-1.9-2.4c1.8-1.3 0-2.8-2.1-2.7s-5.4 1-3.8 6.7 17.1 7.3 18.9-4.4c1-6.8-5.8-16.4-32.5-15.4a108.5 108.5 0 0 0-30.4 5.2c1.2 8.3-1.9 15.7-8.5 20.1-5.3 11.2-41.6 17.9-48.4-2.7-7.5.8-13.1 10-13.9 14.9a1.4 1.4 0 0 1-1.6 1.2c-6.5-.7-16.7 3.6-17.9 20-1.3 18.3 14.9 29.2 31.7 25.4a21.7 21.7 0 0 1-5-3.5c-5.7-.2-13.7-1.1-17.4-12.1-.6-1.7 2.1-3.2 2.9-.9 2.5 7.8 8.3 9.6 11.8 10a23.3 23.3 0 0 1-4.4-13.3c-.1-2.5 3-2 3-.2-.1 12.3 14.5 29.4 42 13 33.9-20.2 50.8-8.1 55.8-5 1.4.9 9.2 5.2 13.7.1 1.8-2 4.1-10.3-6.4-14.9-4.2 3.7-11.5 3.3-8.9-3-32.1-5.7-50.2 2.7-61.8 10.2s-16.4.3-17-2.5c-1.8-8.4 16.6-26.2 60.2-24.6 1.3-3.9 5.3-5.7 8.1.6 7.4.6 18 3.2 28.9 3.2s18.2-5.3 14-17.1z"/><path class="b" d="M176 81.3l3.8-9.1a107.7 107.7 0 0 0-23.6 1.6c-1.1 15.7-9.6 10.9-13.8 3.6-27.3 10.6-19.1 22.7-10.5 18.6-1.6-15.7 6-15 12.5-7a77.4 77.4 0 0 1 15.1-5.4c1.4-15.6 10-9.6 13.3-2.1zM65.8 101.1c5.2-.4 1.4-10.4 17-26.2 13.1-13.2-7.9-26.6-17.9-13s-4.4 39.6.9 39.2z"/><path class="b" d="M49.8 63.9c-4.7 6.2-6.6 20.2-2.4 30.6 2.9 7 6.9-1.5 9.3-5.4-1.2-8.8 0-20.5 5.2-28.1-5.6-3.5-10.1.3-12.1 2.9zM32.3 74.3c-2.4 10.4-.6 17.3 2.6 18.1s4.7-5.4 7.3-7.6c-.6-7.7.9-15.8 4.2-21.2-8.7-3.1-12.8 5.3-14.1 10.7z"/><path class="b" d="M12.2 39.9c-1.8 22.1 15.2 28 18.9 28.5 1.7-3.6 6.8-11.4 17.2-7.3 5.5-6.4 12-4.8 15.5-2.5C73.9 48.2 92 53.8 89.6 69.3a16.6 16.6 0 0 1 7.9-1.7c1.7-5.9 7.7-14.9 15.9-16.1a18.6 18.6 0 0 1 5.1-15.2c-4 1.6-20.6 10.6-28.1 12.3-1.4.3-2.4-2.4-.3-3 9.3-2.5 26.9-13.5 42.8-17.6 19.5-5.2 34.5 6.7 32.1 22.8 10.1-14.5-5.4-34.6-20.7-36.4-33.4-4.1-53.3 26.5-98.8 28.9-7 .4-11.9-2-13.7-6s-.9-9 3.7-10.6c2.1-.7 3.5 2.3 1.1 2.8s-4.9 9.2 4.8 10.7c12.7 2 14.5-14.3 7.3-21.2s-34-9.4-36.5 20.9zM108.8 156a30.1 30.1 0 0 1 6.8 8.2 45.5 45.5 0 0 1 2-10.6 17.4 17.4 0 0 1-5-5.7 47.5 47.5 0 0 0-3.8 8.1zM40.3 152.4c7.2.6 18.4-6.1 19.7-17.7-20.3-.3-20.5 13-19.7 17.7zM105.5 182.8c-9.5-20.1-30.2-13.6-46.7-2.2-14.8 10.3-29.4 7.7-35.8.1a31.5 31.5 0 0 1-4.6-32.4C5 168 14.6 187.8 24.8 193.5c18.7 10.5 37.8-5 41.6-8.5 12.4-11.2 28.8-11.8 33.4 2.2 4 12.2-7.6 21.6-15.9 18.1-10.7-4.4-6.4-13.5-3.1-15.1a7.4 7.4 0 0 1 8.7 1.9c1.2 1.3-.5 3.6-2.1 2.1s-3.5-2.1-5.1-1.3-4.3 7.6 2.6 9.6c8.9 2.6 14.7-7.1 12-14.4-3.9-10.7-15.2-8.9-19.9-6.6-14.5 7.2-12.8 30 6 30.7 23.2.9 27-19.8 22.5-29.4zM188.4 159.2c11.6 4.5 18.7-15.8 11.7-23.9-4.2 7.6-13.1 10.2-11.7 23.9z"/><path class="b" d="M191.9 172.1c-15.6-.4-20.8-23.1-41.9-20.9-24 2.5-24.8 45.6-13.1 57.6h3.1c-4.1-9.4-6.7-28.1 7.8-38.2 1.7-1.1 3.6 1.3 1.7 2.5-13.6 9.4-10.2 27.6-6.2 35.7h3.5c-4.2-8.4-3.6-21.3 2.4-27.3 18.5-18.3 44.9 16.4 57.1-.5 8-11.1 12.7-17.8 26.8-16.9a13.3 13.3 0 0 0-7-4c-19.7-4.1-20.7 12.4-34.2 12z"/><path class="b" d="M208.6 182.8c-13.7 18.8-40.7-15.8-57.2.7-5.4 5.4-5.6 18-1.2 25.1h6.1c-2-5.6.6-12.1 3.8-14.9 17.6-15 37.6 17.6 54.2-7.3 1-1.5 8.3-14.5 13.9-19.3-10.5.6-14.4 8.6-19.6 15.7z"/><path class="b" d="M238.8 151.3c-4-14.1-13.7-23-25.3-23.2-.3 0-120-1.8-163.5-1.8-40.8 0-44.9 21.4-47.3 34.2-3.8 20.4 3.9 40.1 8.9 46.1 9.4 11.4 25.3 13.6 48 13.6l128.4-.3c35.9 0 44.8-12.6 48.4-23.6 4.7-14 5.7-33.3 2.4-45zm-1.3 15.2c-1.5 1.5-3.3-.7-6.8 2.3.1 26.5-6.3 35.4-19 38.4-16.1 3.8-43.4 4.7-112.7 4.4-5.8 3.8-19.8 6.6-29-1.2-23.1.7-48.8.4-51.7-18.1-4.9-4.8-12.3-15.9-8.2-33.2 5.2-21.3 22.1-24.3 34.6-23.9 4.2-2.6 10-3.9 17-3.4 2 .2 1.4 2.5 1.3 3l59.3.8c.1-2-.9-2.5.1-3.9s8.9 1.7 11.8 4.1l61.1 1c4.2-4.3 3.6-10 9.2 0 12.4.9 25 4.3 26.3 21.8 3.7 1.8 8.1 6.4 6.7 7.9z"/><path class="b" d="M166.6 208.3l15.1-.6c-3.8-8.4-15.4-10.2-15.1.6zM113.3 166.2c-11.1-19.9-33.8-15.2-46.1-8.3-16.4 9.1-28.6 15.1-37.4 5.6-5.7-6.1-4.3-16.7-.5-23.4-12.8 6.6-13.3 28.1-4 38.6 5.7 6.5 18.5 8.7 31.8-.5 16.2-11.4 36.6-18.1 48.8-1.1 5.5 7.7 6.4 22.9-3 31.6h7.1c8-7 11.2-28.4 3.3-42.5z"/><path class="b" d="M137.7 153.6c1.7-13.2-7.4-17.4-12.4-18.8 1.6 11.6-8 17-6.8 36 4.6 13.7 2 29.9-4.4 38h19c-8.6-12.6-10-41.8 4.6-55.2z"/></svg>',ti.SVG_TEXT='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 228.9 29"><defs><style>.a{fill:#f5f5f5}</style></defs><path class="a" d="M9.7 19a3.7 3.7 0 0 1 2.9 1.4 6 6 0 0 1 .9 3.6 4.6 4.6 0 0 1-1.4 3.8c-.9.7-2.5 1-4.7 1L0 28.7V10.1l6.6-.2a9.4 9.4 0 0 1 4.9 1c.9.7 1.4 2 1.4 3.9a5.1 5.1 0 0 1-.7 3A3.3 3.3 0 0 1 9.7 19zm-6.4-1.1h3.4a3.3 3.3 0 0 0 2.3-.6 2.5 2.5 0 0 0 .7-2.1 2.9 2.9 0 0 0-.7-2.1 5.1 5.1 0 0 0-2.6-.5H3.3zm0 8.3h3.5a3.9 3.9 0 0 0 2.6-.6c.5-.3.7-1.1.7-2.2a3 3 0 0 0-.7-2.4 3.8 3.8 0 0 0-2.7-.7H3.3zM22.9 10.1v14.3a2.1 2.1 0 0 0 .3 1.2 2.3 2.3 0 0 0 1.3.3h6.4l.2 2.6c-1.8.2-4.3.2-7.4.2s-4.2-1.2-4.2-3.8V10.1zM46.2 23.4h-6.9l-1.5 5.3h-3.5L39.9 11a1.2 1.2 0 0 1 1.2-.9h3.3a1.2 1.2 0 0 1 1.2.9l5.6 17.7h-3.5zm-.8-2.7l-1.9-6.4c-.2-1-.4-1.5-.4-1.6h-.7l-.4 1.6-1.9 6.4zM68.2 25.8l.3 2.5a18.5 18.5 0 0 1-5.7.7c-2.8 0-4.7-.7-5.8-2.1s-1.7-4-1.7-7.5.5-6 1.7-7.4 3-2.2 5.8-2.2a19.8 19.8 0 0 1 5.3.6l-.3 2.6a39.4 39.4 0 0 0-5-.2c-1.5 0-2.6.4-3.1 1.4s-.9 2.7-.9 5.2.3 4.3.9 5.2a3.2 3.2 0 0 0 3.1 1.5 37.5 37.5 0 0 0 5.4-.3zM79.1 20.3h-1.8a11.1 11.1 0 0 1 .2 1.9v6.5h-3.4V10.1h3.4v5.5a12.5 12.5 0 0 1-.2 2.1h1.8l5.1-7.6h3.7l-5 7.5a4.3 4.3 0 0 1-1.3 1.4 4.5 4.5 0 0 1 1.5 1.6l5.1 8h-3.7zM100 21.4l-3.8-1.2a5.1 5.1 0 0 1-2.8-2 5.9 5.9 0 0 1-.9-3.4c0-2 .5-3.4 1.4-4s2.6-1 5-1a24 24 0 0 1 5.8.6l-.2 2.4H99a4.7 4.7 0 0 0-2.5.4c-.4.2-.6.8-.6 1.7a2.5 2.5 0 0 0 .4 1.7 3.8 3.8 0 0 0 1.7.8l3.5 1.1a5.3 5.3 0 0 1 3 2 5.9 5.9 0 0 1 .9 3.4c0 2.1-.5 3.4-1.5 4.2s-2.7 1-5.1 1a30.8 30.8 0 0 1-6.1-.6L93 26l5.8.2a4.4 4.4 0 0 0 2.5-.5 2.2 2.2 0 0 0 .6-1.8 2.2 2.2 0 0 0-.4-1.6 3.5 3.5 0 0 0-1.5-.9zM126 10.1h3.5a1.2 1.2 0 0 1 1.3 1.4l.8 17.2h-3.3l-.7-15.8h-.5l-3.2 12.3a1.3 1.3 0 0 1-1.4 1.1H120a1.4 1.4 0 0 1-1.5-1.1l-3.2-12.3h-.5l-.6 15.8h-3.3l.7-17.2c.1-.9.5-1.4 1.4-1.4h3.5a1.2 1.2 0 0 1 1.3 1.2l2.7 10 .5 2.6h.4a26.1 26.1 0 0 1 .6-2.6l2.6-10a1.4 1.4 0 0 1 1.4-1.2zM141.4 28.7H138V10.1h3.4zM161.5 13h-5.7v15.7h-3.4V13h-5.7v-2.9h14.8zM180.9 10.1v18.6h-3.4v-8.5h-7.3v8.5h-3.4V10.1h3.4v7.3h7.3v-7.3zM196 13.1l-.2-2.6a24.4 24.4 0 0 1 5.9-.7 8.9 8.9 0 0 1 4.5.9 3.5 3.5 0 0 1 1.5 3.3 6.4 6.4 0 0 1-.7 3.1 13.3 13.3 0 0 1-2.4 3.3l-4.9 5.3 2.8-.2h5.8v3.2h-12.7v-2a2 2 0 0 1 .5-1.4l4.9-5.4c2.2-2.4 3.3-4.2 3.3-5.6a1.3 1.3 0 0 0-.7-1.3 5.7 5.7 0 0 0-2.2-.3 52.9 52.9 0 0 0-5.4.4zM214.3 28.7V10.1l7-.2c2.8 0 4.8.7 5.9 2.1s1.7 3.8 1.7 7.4-.6 6.1-1.7 7.5-3.1 2-5.9 2-4.5 0-7-.2zm3.4-16v13.4h3.6a3.6 3.6 0 0 0 3.2-1.4 12.6 12.6 0 0 0 .8-5.3c0-2.5-.3-4.3-.9-5.3a3.3 3.3 0 0 0-3.1-1.4h-3.6zM.1 8.1v-8h2.7a2.9 2.9 0 0 1 2.1.5 3 3 0 0 1 .5 2 2.9 2.9 0 0 1-.5 1.9 2.5 2.5 0 0 1-1.9.6H1.2v3zm1.1-4h1.6a1.6 1.6 0 0 0 1.1-.3 2.1 2.1 0 0 0 .3-1.2 2.3 2.3 0 0 0-.3-1.3A1.6 1.6 0 0 0 2.8 1H1.2zM9.7 0a3 3 0 0 1 2.5.9 5.2 5.2 0 0 1 .7 3.2 5 5 0 0 1-.7 3.2 3 3 0 0 1-2.5.9 2.8 2.8 0 0 1-2.4-.9 5 5 0 0 1-.7-3.2A5.2 5.2 0 0 1 7.3.9 2.8 2.8 0 0 1 9.7 0zm1.6 1.7A1.7 1.7 0 0 0 9.7 1a1.6 1.6 0 0 0-1.5.7 4.5 4.5 0 0 0-.4 2.4 4.5 4.5 0 0 0 .4 2.4 1.6 1.6 0 0 0 1.5.7 1.7 1.7 0 0 0 1.6-.7 4.5 4.5 0 0 0 .4-2.4 4.5 4.5 0 0 0-.4-2.4zM24.2.1l-1.6 7.6a.4.4 0 0 1-.4.4h-1.3a.4.4 0 0 1-.4-.4l-1.2-5.8a3.4 3.4 0 0 1-.1-.9h-.3l-.2.9-1.1 5.8V8h-1.7c-.3 0-.4-.1-.5-.4L13.9.1h1.2l1.2 6.1a5.1 5.1 0 0 0 .1 1h.3c0-.3.1-.7.1-1L18 .5a.4.4 0 0 1 .4-.4h1.3a.2.2 0 0 1 .2.2.2.2 0 0 1 .2.2l1.1 5.7c.1.3.1.6.2 1h.3v-.5a1.1 1.1 0 0 0 .1-.5L22.9.1zM30.3 7.1V8H27a1.6 1.6 0 0 1-1.2-.4 1.2 1.2 0 0 1-.4-1v-5a1.4 1.4 0 0 1 .4-1.1A2.1 2.1 0 0 1 27 .1h3.4V1h-3.2l-.5.2a.7.7 0 0 0-.1.5v1.7h3.3v1h-3.3v2a1.1 1.1 0 0 0 .1.6h3.6zM37.6 8.1h-1.2l-.7-2.5a1.1 1.1 0 0 0-1-.8h-1.6v3.3h-1.2v-8h2.8a3.4 3.4 0 0 1 2 .5 2.4 2.4 0 0 1 .6 1.8 2.8 2.8 0 0 1-.3 1.4 2 2 0 0 1-1.2.6 1.4 1.4 0 0 1 1 1.2zm-4.5-4.3h1.6a1.6 1.6 0 0 0 1.1-.3 1.4 1.4 0 0 0 .3-1.1 1.6 1.6 0 0 0-.3-1.1 1.6 1.6 0 0 0-1.1-.3h-1.6zM43.9 7.1V8h-3.3a1.6 1.6 0 0 1-1.2-.4 1.2 1.2 0 0 1-.4-1v-5a1.4 1.4 0 0 1 .4-1.1 2.1 2.1 0 0 1 1.2-.4H44V1h-3.2a.6.6 0 0 0-.5.2.8.8 0 0 0-.2.5v1.7h3.4v1h-3.4v2a1.1 1.1 0 0 0 .2.6h3.6zM45.5 8.1v-8h2.9a3 3 0 0 1 2.4.9 5.2 5.2 0 0 1 .7 3.2 5.2 5.2 0 0 1-.7 3.2 3 3 0 0 1-2.4.9zm1.1-7v6h1.8a1.6 1.6 0 0 0 1.5-.7 5.7 5.7 0 0 0 .4-2.4 6.5 6.5 0 0 0-.4-2.4 1.8 1.8 0 0 0-1.5-.6h-1.8zM59.6 3.9a1.5 1.5 0 0 1 1.3.6 2.8 2.8 0 0 1 .3 1.5 2.2 2.2 0 0 1-.5 1.6 3.4 3.4 0 0 1-2 .5h-3v-8h2.6a3.7 3.7 0 0 1 2.1.4 1.8 1.8 0 0 1 .6 1.6 2.3 2.3 0 0 1-.3 1.3 1.4 1.4 0 0 1-1.1.5zm-2.8-.4h1.6a2.9 2.9 0 0 0 1.2-.2 1.3 1.3 0 0 0 .3-1c0-.5-.1-.9-.4-1a1.7 1.7 0 0 0-1.2-.3h-1.5zm0 3.7h1.7a1.7 1.7 0 0 0 1.2-.3c.3-.1.4-.5.4-1a1.7 1.7 0 0 0-.4-1.2 1.9 1.9 0 0 0-1.3-.3h-1.6zM65.6 5.3v2.8h-1.1V5.3L61.8.1h1.3l1.6 3.3a4.2 4.2 0 0 0 .3.9h.1a8.5 8.5 0 0 1 .3-.9L67 .1h1.2z"/></svg>';var ei=function(t){function e(t,i,n){var s,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(m(this,e),s=a(this,h(e).call(this)),e.instance=o(o(s)),console.log("%c                         >>> BLACK <<<                         ","background: #000; color: #fff;"),s.mContainerElementId=t,s.mContainerElement=document.getElementById(s.mContainerElementId),!s.mContainerElement)throw new Error("Container element was not found");return s.mVideoDriverClass=n,s.mSystemClasses=r,s.mStageWidth=s.mContainerElement.clientWidth,s.mStageHeight=s.mContainerElement.clientHeight,s.mLastUpdateTime=0,s.mLastRenderTime=0,s.mSystems=[],s.mGameObject=null,s.mIsRunning=!1,s.mIsStarted=!1,s.mIsPanic=!1,s.mRAFHandle=-1,s.mViewport=null,s.mVideo=null,s.mPaused=!1,s.mUnpausing=!1,s.mPauseOnHide=!0,s.mPauseOnBlur=!0,s.mTagCache={},s.mGameClass=i,s.mGame=null,s.mStage=null,s.mWasStopped=!1,s.mSplashScreen=new ti,s.mFrameTimes=[],s.__bootViewport(),s.__update=s.__update.bind(o(o(s))),s}return l(e,M),f(e,[{key:"pause",value:function(){this.mPaused=!0,this.post("paused")}},{key:"resume",value:function(){!0===this.mPaused&&(this.mUnpausing=!0)}},{key:"__setUnpaused",value:function(){this.mPaused=!1,this.post("unpaused")}},{key:"__bootViewport",value:function(){this.mViewport=new X(this.mContainerElement)}},{key:"__bootSystems",value:function(){if(null!==this.mSystemClasses)for(var t=0;t<this.mSystemClasses.length;t++)this.__addSystem(new this.mSystemClasses[t])}},{key:"__bootStage",value:function(){var t=this;this.mStage=new U,window.onblur=function(e){return t.__onVisibilityChange(e)},window.onfocus=function(e){return t.__onVisibilityChange(e)},window.onpagehide=function(e){return t.__onVisibilityChange(e)},window.onpageshow=function(e){return t.__onVisibilityChange(e)},document.hidden&&!0===this.mPauseOnHide&&this.pause()}},{key:"__onVisibilityChange",value:function(t){var e=t.type;"blur"===e&&!0===this.mPauseOnBlur?this.pause():"pagehide"===e&&!0===this.mPauseOnHide?this.pause():"focus"!==e&&"pageshow"!==e||!1===document.hidden&&this.resume()}},{key:"hasSystem",value:function(t){for(var e=0;e<this.mSystems.length;e++){if(this.mSystems[e]instanceof t)return!0}return!1}},{key:"__addSystem",value:function(t){return this.mSystems.push(t),t}},{key:"getSystem",value:function(t){for(var e=0;e<this.mSystems.length;e++){var i=this.mSystems[e];if(i instanceof t)return i}return null}},{key:"__bootVideo",value:function(){this.mVideo=new this.mVideoDriverClass(this.mContainerElement,this.mStageWidth,this.mStageHeight)}},{key:"start",value:function(){if(!0!==this.mWasStopped){if(e.instance=this,!0!==this.mIsStarted){this.__bootSystems(),this.__bootStage(),this.__bootVideo(),this.mStage.__refresh(),this.post(N.READY),this.mGameObject=new this.mGameClass,this.mStage.addChild(this.mGameObject);var t=this;this.mIsStarted=!0,this.mVideo.start(),this.mRAFHandle=window.requestAnimationFrame(function(e){t.mIsRunning=!0,!0===ti.enabled&&t.mSplashScreen.show(),t.mLastUpdateTime=e,t.mLastRenderTime=t.mLastUpdateTime,t.__update(e,!0)})}}else y.error("Black engine cannot be re-started.")}},{key:"stop",value:function(){this.mIsStarted=!1,this.mIsRunning=!1,window.cancelAnimationFrame(this.mRAFHandle),console.log("%c                        <<< BYE BYE >>>                        ","background: #000; color: #fff;")}},{key:"__update",value:function(t,i){if(!0===this.mPaused&&!0===this.mUnpausing&&(this.mUnpausing=!1,this.mLastUpdateTime=t,this.mLastRenderTime=this.mLastUpdateTime,this.__setUnpaused()),this.mRAFHandle=window.requestAnimationFrame(this.__update),!0!==this.mPaused){var n=Math.floor((t-this.mLastUpdateTime)/H.mDeltaTimeMs);!0===i&&(n=1),n>e.maxUpdatesPerFrame&&(this.post("looped",n),y.warn("Unable to catch up ".concat(n," update(s).")),n=e.maxUpdatesPerFrame),e.numUpdates=n;for(var s=0;s<n;s++)H.mActualTime+=H.delta,H.mTime=H.mActualTime,this.__internalUpdate(),this.__internalSystemPostUpdate();for(var r=t-H.mDeltaTimeMs;this.mLastUpdateTime<r;)this.mLastUpdateTime+=H.mDeltaTimeMs;H.mAlphaTime=0===n?(t-this.mLastUpdateTime)/H.mDeltaTimeMs:0,H.mTime=H.mActualTime+.001*(t-this.mLastUpdateTime)*H.mScale,this.__internalSystemRender(),this.mVideo.beginFrame(),this.mVideo.render(this.mStage),this.mVideo.endFrame(),e.__frameNum++,this.mIsPanic=!1,pt.__dirty=!1,this.mLastRenderTime=t}}},{key:"__internalUpdate",value:function(){this.mViewport.__update();for(var t=0;t<this.mSystems.length;t++)this.mSystems[t].onUpdate();this.mStage.__update()}},{key:"__internalSystemPostUpdate",value:function(){for(var t=0;t<this.mSystems.length;t++)this.mSystems[t].onPostUpdate()}},{key:"__internalSystemRender",value:function(){for(var t=0;t<this.mSystems.length;t++)this.mSystems[t].onRender()}},{key:"onTagUpdated",value:function(t,e,i){if(null!==e){var n=this.mTagCache[e];n.splice(n.indexOf(t),1),0===n.length&&delete this.mTagCache[e]}null!==i&&(!1===this.mTagCache.hasOwnProperty(i)&&(this.mTagCache[i]=[]),this.mTagCache[i].push(t))}},{key:"onChildrenAdded",value:function(t){var e=this;pt.__dirty=!0;for(var i=0;i<this.mSystems.length;i++)this.mSystems[i].onChildrenAdded(t);G.forEach(t,function(t){if(!0!==t.mAdded){e.onTagUpdated(t,null,t.mTag),t.mAdded=!0,t.onAdded();for(var i=0;i<t.mComponents.length;i++){var n=t.mComponents[i];!0!==n.mAdded&&(n.mAdded=!0,n.onAdded(t))}}})}},{key:"onChildrenChanged",value:function(t){pt.__dirty=!0;for(var e=0;e<this.mSystems.length;e++)this.mSystems[e].onChildrenChanged(t)}},{key:"onChildrenRemoved",value:function(t){var e=this;pt.__dirty=!0;for(var i=0;i<this.mSystems.length;i++)this.mSystems[i].onChildrenRemoved(t);G.forEach(t,function(t){if(!0===t.mAdded){e.onTagUpdated(t,null,t.mTag),t.mAdded=!1,t.onRemoved();for(var i=0;i<t.mComponents.length;i++){var n=t.mComponents[i];!1!==n.mAdded&&(n.mAdded=!1,n.onRemoved(t))}}})}},{key:"onComponentAdded",value:function(t,e){pt.__dirty=!0;for(var i=0;i<this.mSystems.length;i++)this.mSystems[i].onComponentAdded(t,e);!0!==e.mAdded&&(e.mAdded=!0,e.onAdded(t))}},{key:"onComponentRemoved",value:function(t,e){pt.__dirty=!0;for(var i=0;i<this.mSystems.length;i++)this.mSystems[i].onComponentRemoved(t,e);!1!==e.mAdded&&(e.mAdded=!1,e.onRemoved(t))}},{key:"ups",get:function(){return.001*H.mDeltaTimeMs},set:function(t){y.isNumber(t),y.assert(t>0),H.mDeltaTimeMs=1e3/t,H.mDeltaTime=.001*H.mDeltaTimeMs}},{key:"viewport",get:function(){return this.mViewport}},{key:"containerElement",get:function(){return this.mContainerElement}},{key:"pauseOnHide",get:function(){return this.mPauseOnHide},set:function(t){this.mPauseOnHide=t}},{key:"pauseOnBlur",get:function(){return this.mPauseOnBlur},set:function(t){this.mPauseOnBlur=t}},{key:"isPaused",get:function(){return this.mPaused}},{key:"stage",get:function(){return this.mStage}},{key:"containerElementId",get:function(){return this.mContainerElementId}},{key:"splashScreen",get:function(){return this.mSplashScreen}}],[{key:"magic",get:function(){return Math.random()}},{key:"driver",get:function(){return e.instance.mVideo}},{key:"stage",get:function(){return e.instance.mStage}},{key:"frameNum",get:function(){return e.__frameNum}}]),e}();function ii(t){return(ii="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ni(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function si(t,e){return!e||"object"!==ii(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function ri(t){return(ri=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ai(t,e){return(ai=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}ei.__frameNum=0,ei.instance=null,ei.numUpdates=0,ei.maxUpdatesPerFrame=60;var oi=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),si(this,ri(e).call(this,t))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ai(t,e)}(e,Vt),function(t,e,i){e&&ni(t.prototype,e),i&&ni(t,i)}(e,[{key:"onAdded",value:function(){this.refresh(),this.stage.on("resize",this.refresh,this)}},{key:"refresh",value:function(){var t=this.width/this.scaleX,e=this.height/this.scaleY,i=this.stage.width+2*this.stage.x,n=this.stage.height+2*this.stage.y,s=t/e>=i/n?n/e:i/t;this.x=-this.stage.x,this.y=-this.stage.y,this.scaleX=this.scaleY=s}}]),e}();function hi(t){return(hi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function li(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ui(t,e){return!e||"object"!==hi(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function ci(t){return(ci=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function mi(t,e){return(mi=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var di=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(i=ui(this,ci(e).call(this))).type=t,i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&mi(t,e)}(e,G),function(t,e,i){e&&li(t.prototype,e),i&&li(t,i)}(e,[{key:"onAdded",value:function(){this.emitter=this.addChild(new ne),this.emitter.emitCount=new Ut(2),this.emitter.emitDelay=new Ut(0),this.emitter.emitInterval=new Ut(0),this.emitter.emitDuration=new Ut(.1),this.emitter.emitNumRepeats=new Ut(0),this.emitter.textures=ft.default.getTextures("particle_ex*"),this.emitter.space=this,this.emitter.blendMode=yt.ADD,this.emitter.add(new Jt(.3)),this.emitter.add(new $t(-300,-300,300,300)),this.emitter.add(new Qt(0,1e3,0,1e3)),this.emitter.add(new Zt(1,0)),this.addChild(this.emitter)}}]),e}();function fi(t){return(fi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function yi(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function vi(t){return(vi=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function pi(t,e){return(pi=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function gi(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var ki=function(t){function e(t,i){var n,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),n=function(t,e){return!e||"object"!==fi(e)&&"function"!=typeof e?gi(t):e}(this,vi(e).call(this)),-1===s&&(s=v.randomBetween(1,5)),n.touchable=!0,n.traversed=!1,n.cx=t,n.cy=i,n.type=s,n.selected=!1,n.selectionTween=null,n.hideTween=null,n.showTween=null,n.shadow=n.addChild(new Vt("shadow")),n.shadow.x=10-Oi.GRID_SIZE,n.shadow.y=10-Oi.GRID_SIZE,n.shadow.alpha=1,n.shadow.alignPivotOffset(),n.fg=n.addChild(new Vt("player-".concat(s))),n.fg.alignPivotOffset(),n.fg.x=-Oi.GRID_SIZE,n.fg.y=-Oi.GRID_SIZE,n.x=n.cx*Oi.GRID_SIZE,n.y=n.cy*Oi.GRID_SIZE,n.alignPivotOffset(),n.fg.touchable=!0,n.fg.on("pointerDown",n.onPointerDown,gi(gi(n))),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&pi(t,e)}(e,Nt),function(t,e,i){e&&yi(t.prototype,e),i&&yi(t,i)}(e,[{key:"onPointerDown",value:function(t){this.scale-=.1,this.post("clicked")}},{key:"metamorphose",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;this.type=-1===e?v.randomBetween(1,5):e;var i=this.parent.addChild(new di);i.x=this.x-25,i.y=this.y-25,this.deselect(),this.playHide().on("complete",function(){t.fg.texture=ft.default.getTexture("player-".concat(t.type)),t.playShow()})}},{key:"playHide",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:he.smootherStep;return this.removeTweens(),this.showTween=this.addComponent(new ue({scale:0},.15,{delay:t,ease:e})),this.showTween}},{key:"playShow",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:he.backOut;return this.removeTweens(),this.hideTween=this.addComponent(new ue({scale:1},.2,{delay:t,ease:e})),this.hideTween}},{key:"removeTweens",value:function(){this.hideTween&&(this.removeComponent(this.hideTween),this.hideTween=null),this.showTween&&(this.removeComponent(this.showTween),this.showTween=null)}},{key:"select",value:function(){this.selected=!0,this.scale=1.1,this.__animateSelect()}},{key:"deselect",value:function(){this.selected=!1,this.scale=1,this.selectionTween&&(this.fg.removeComponent(this.selectionTween),this.fg.rotation=0,this.selectionTween=null)}},{key:"moveDown",value:function(){}},{key:"inRange",value:function(t){return v.distance(this.x-50,this.y-50,t.x-50,t.y-50)<=150}},{key:"__animateSelect",value:function(){var t=new ue({rotation:1.25},.2,{yoyo:!0,repeats:1/0,ease:he.smootherStep});this.selectionTween=this.fg.addComponent(t)}}]),e}();function bi(t){return(bi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function wi(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _i(t,e){return!e||"object"!==bi(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function xi(t){return(xi=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ci(t,e){return(Ci=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Si=function(t){function e(){var t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"middleCenter",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=_i(this,xi(e).call(this))).mAlign=i,t.bounds=n,t.mFillRect=s,t.mIsActive=!0,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ci(t,e)}(e,V),function(t,e,i){e&&wi(t.prototype,e),i&&wi(t,i)}(e,[{key:"updateLayout",value:function(){if(this.gameObject){var t=this.gameObject.stage;this.bounds?this.fitIntoRect(this.gameObject,this.bounds,this.mFillRect,this.mAlign):this.fitIntoRect(this.gameObject,t.bounds,this.mFillRect,this.mAlign)}}},{key:"__onViewResize",value:function(t){this.post("update"),this.updateLayout()}},{key:"onAdded",value:function(t){var e=this;ei.stage.on("resize",this.__onViewResize,this),this.post("update"),this.updateLayout(),t.onRemoved=function(){ei.stage.off("resize",e.__onViewResize)}}},{key:"onRemoved",value:function(t){ei.stage.off("resize",this.__onViewResize,this)}},{key:"fitIntoRect",value:function(t,e,i,n){if(this.mIsActive){var s=t.width/t.scaleX,r=t.height/t.scaleY,a=e.width,o=e.height,h=a/s,l=o/r,u=s/r>=a/o?i?l:h:i?h:l,c=s*u,m=r*u,d=0,f=0;switch(n){case"left":case"topLeft":case"bottomLeft":d=0;break;case"right":case"topRight":case"bottomRight":d=c-a;break;default:d=.5*(c-a)}switch(n){case"top":case"topLeft":case"topRight":f=0;break;case"bottom":case"bottomLeft":case"bottomRight":f=m-o;break;default:f=.5*(m-o)}t.x=e.x-d,t.y=e.y-f,t.scaleX=t.scaleY=u}}},{key:"fillRect",get:function(){return this.mFillRect},set:function(t){this.mFillRect=t,this.updateLayout()}},{key:"isActive",get:function(){return this.mIsActive},set:function(t){this.mIsActive=t,this.updateLayout()}}]),e}();function Ti(t){return(Ti="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Pi(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ai(t){return(Ai=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ri(t,e){return(Ri=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ei(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var Oi=function(t){function e(t,i){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(n=function(t,e){return!e||"object"!==Ti(e)&&"function"!=typeof e?Ei(t):e}(this,Ai(e).call(this))).touchable=!0,n.gridWidth=t,n.gridHeight=i,n.minMatchingCount=3,n.isEnabled=!0,n.firstSelected=null,n.lastSelected=null,n.selectedItems=[],n.removedItems=[],n.grid=[],n.items=[],re.on(re.POINTER_UP,n.onPointerUp,Ei(Ei(n))),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ri(t,e)}(e,G),function(t,e,i){e&&Pi(t.prototype,e),i&&Pi(t,i)}(e,[{key:"onAdded",value:function(){this.prepare(),this.alignPivotOffset()}},{key:"prepare",value:function(){for(var t=0;t<this.gridHeight;t++){this.grid.push([]);for(var e=0;e<this.gridWidth;e++)this.grid[t][e]=this.createItem(e,t,-1)}}},{key:"createItem",value:function(t,e,i){var n=new ki(t,e,i);return this.addChild(n),this.items.push(n),n}},{key:"trySelect",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,s=this.items[Symbol.iterator]();!(t=(n=s.next()).done);t=!0){var r=n.value,a=r.hitTest(re.pointerPosition);!r.selected&&a&&(null===this.firstSelected&&(this.firstSelected=r),r.type===this.firstSelected.type&&(null===this.lastSelected||r.inRange(this.lastSelected))&&this.select(r))}}catch(t){e=!0,i=t}finally{try{t||null==s.return||s.return()}finally{if(e)throw i}}}},{key:"hide",value:function(){this.isEnabled=!1;var t=this.gridHeight/2,e=this.gridWidth/2,i=v.distance(0,0,e,t);this.items.forEach(function(n){var s=v.distance(n.cx,n.cy,e,t),r=v.lerp(.5,0,s/i);n.playHide(r,he.backIn)})}},{key:"select",value:function(t){this.lastSelected=t,t.select(),this.selectedItems.push(t),this.post("selected",t,this.selectedItems)}},{key:"deselect",value:function(t){this.lastSelected=this.selectedItems[this.selectedItems.length-1],t.deselect();var e=this.selectedItems.indexOf(t);this.selectedItems.splice(e,1),this.post("deSelected",t,this.selectedItems)}},{key:"deselectAll",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,s=this.items[Symbol.iterator]();!(t=(n=s.next()).done);t=!0){n.value.deselect()}}catch(t){e=!0,i=t}finally{try{t||null==s.return||s.return()}finally{if(e)throw i}}this.firstSelected=null,this.lastSelected=null,this.selectedItems=[],this.removedItems=[],this.post("allDeselected")}},{key:"removeSelected",value:function(){var t=!0,e=!1,i=void 0;try{for(var n,s=this.items[Symbol.iterator]();!(t=(n=s.next()).done);t=!0){var r=n.value;r.selected&&(this.removedItems.push(r),r.metamorphose())}}catch(t){e=!0,i=t}finally{try{t||null==s.return||s.return()}finally{if(e)throw i}}this.post("kill",this.removedItems)}},{key:"moveDown",value:function(){}},{key:"getMatchingClusters",value:function(){for(var t=[],e=0;e<this.grid.length;e++)for(var i=0;i<this.grid[e].length;i++){var n=this.grid[e][i],s=this.getMatchingItems(n,n.type);s.length>=this.minMatchingCount-1&&(s.unshift(n),t.push(s))}return t}},{key:"getMatchingItems",value:function(t){return this.items.forEach(function(t){return t.traversed=!1}),this.findMatchingClusters(t,t.type)}},{key:"findMatchingClusters",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=this.getItemNeighbors(t),s=null,r=0;t.traversed=!0;for(var a=0;a<n.length;a++){var o=n[a],h=o.cx!==t.cx&&o.cy!==t.cy?1:2;!1===o.traversed&&o.type===e&&h>r&&(s=o,r=h)}return s&&(i.push(s),this.findMatchingClusters(s,e,i)),i}},{key:"getItemNeighbors",value:function(t){for(var e=[{x:0,y:-1},{x:1,y:0},{x:0,y:1},{x:-1,y:0},{x:-1,y:-1},{x:-1,y:1},{x:1,y:-1},{x:1,y:1}],i=[],n=0;n<e.length;n++){var s=t.cx+e[n].x,r=t.cy+e[n].y;s<0||r<0||r>=this.grid.length||s>=this.grid[0].length||i.push(this.grid[r][s])}return i}},{key:"onPointerUp",value:function(t){!1!==this.isEnabled&&(this.selectedItems.length>2?(this.removeSelected(),this.moveDown()):this.deselectAll(),this.removedItems=[],this.firstSelected=null,this.lastSelected=null,this.selectedItems=[])}},{key:"onUpdate",value:function(t){re.isPointerDown&&this.isEnabled&&(this.clicked=!0,this.trySelect())}}]),e}();function Ni(t){return(Ni="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Di(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Mi(t,e){return!e||"object"!==Ni(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Li(t){return(Li=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ii(t,e){return(Ii=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}Oi.GRID_SIZE=95;var Bi=function(t){function e(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=Mi(this,Li(e).call(this))).touchable=!0,document.addEventListener(Yt.isMobile?"touchstart":"mousedown",function(t){window.location.href="http://blacksmith2d.io"}),t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ii(t,e)}(e,G),function(t,e,i){e&&Di(t.prototype,e),i&&Di(t,i)}(e,[{key:"onAdded",value:function(){this.stage.on("resize",this.onResize,this);var t=this.addChild(new Vt("black"));t.alpha=0,t.add(new Si);var e=this.centerContainer=this.addChild(new G);e.x=this.stage.centerX,e.y=this.stage.centerY,e.scale=this.stage.LP(.7,1),e.touchable=!0;var i=new Vt("donut");i.alignPivotOffset(),i.y=-100;var n=new Vt("logo");n.alignPivotOffset(),n.y=100;var s=new Vt("big-shadow");s.alignPivotOffset(),s.x=i.x+30,s.y=i.y+20;var r=new Vt("btn-play");r.alignPivotOffset(),r.touchable=!0,r.on("pointerDown",function(){return r.scale=.95}),document.addEventListener(Yt.isMobile?"touchstart":"mousedown",function(t){return r.scale=1,window.location.href="http://blacksmith2d.io",!1});var a=i.y+i.height/2+r.height/2+50;r.y=a+200,e.add(r,s,i,n);n.scale=0,i.scale=3,s.alpha=0,r.scale=0,r.add(new ue({y:a},.3,{delay:.3,ease:he.backOut}),new ue({scale:1},.4,{delay:.25,ease:he.backOut})),t.add(new ue({alpha:.4},.3)),n.add(new ue({scale:1},.3,{ease:he.backOut,delay:.2})),i.add(new ue({scale:1},.3,{ease:he.backOut})),s.add(new ue({alpha:1},.3))}},{key:"onResize",value:function(){this.centerContainer.x=this.stage.centerX,this.centerContainer.y=this.stage.centerY,this.centerContainer.scale=this.stage.LP(.7,1)}}]),e}();function Hi(t){return(Hi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Fi(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Xi(t,e){return!e||"object"!==Hi(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Vi(t){return(Vi=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Gi(t,e){return(Gi=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var zi=function(t){function e(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=Xi(this,Vi(e).call(this,"hand"))).speed=.005,t.visible=!1,t.inProgress=!1,t.wasShown=!1,t.alignPivotOffset(.4,.2),t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Gi(t,e)}(e,Vt),function(t,e,i){e&&Fi(t.prototype,e),i&&Fi(t,i)}(e,[{key:"show",value:function(t){if(0!==t.length&&!0!==this.inProgress){this.visible=!0,this.wasShown=!0,this.inProgress=!0,this.scale=0;var e=this.getHandPath(t);this.x=e.x.shift(),this.y=e.y.shift();var i=new ue({scale:1},.2,{ease:he.backOut,removeOnComplete:!0}),n=new ue({x:e.x,y:e.y},this.getDurationByPath(e),{ease:he.smootherStep,delay:.2,removeOnComplete:!0});this.add(i,n),n.on("complete",this.hide,this)}}},{key:"hide",value:function(){if(!1!==this.inProgress){this.inProgress=!1;this.add(new ue({scale:0},.2,{ease:he.backIn,removeOnComplete:!0}))}}},{key:"getDurationByPath",value:function(t){for(var e=0,i=1;i<t.x.length;i++)e+=v.distance(t.x[i],t.y[i],t.x[i-1],t.y[i-1]);return e*this.speed}},{key:"getHandPath",value:function(t){var e=this,i={x:[],y:[]};return t.forEach(function(t){var n=t.parent.localToGlobal(new x(t.x,t.y));n=e.parent.globalToLocal(n),i.x.push(n.x),i.y.push(n.y)}),i}}]),e}();function Yi(t){return(Yi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ji(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ui(t,e){return!e||"object"!==Yi(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function Wi(t){return(Wi=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function qi(t,e){return(qi=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Qi=function(t){function e(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=Ui(this,Wi(e).call(this,"table"))).alignPivotOffset(.5,0),t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&qi(t,e)}(e,Vt),function(t,e,i){e&&ji(t.prototype,e),i&&ji(t,i)}(e,[{key:"onAdded",value:function(){var t=this.ss=new Gt("Fredoka One",15226454,34,Gt.FontStyle.NORMAL,Gt.FontWeight.BOLD,4,16776660);t.dropShadow=!0,t.shadowColor=0,t.shadowDistanceX=4,t.shadowDistanceY=4,t.shadowBlur=1,this.style=t,this.textField=new zt,this.textField.setStyle("static",t),this.textField.autoSize=!0,this.textField.align="center",this.textField.x=this.width/2,this.textField.y=this.height/2+22,this.textField.multiline=!0,this.textField.lineHeight=2.5,this.textField.alignPivotOffset(.5,.5),this.addChild(this.textField),this.setText("Match 3 or more!",!1)}},{key:"setText",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.textField.text="~{static}"+t,this.textField.alignPivotOffset(.5,.5),e&&this.add(new ue({scaleY:[1.02,1],scaleX:[1.05,1]},.3,{ease:he.backOut}))}},{key:"setScore",value:function(t){this.setText(t),this.style.size=41,this.textField.y=this.height/2+28,this.textField.alignPivotOffset(.5,.5)}}]),e}();function Ki(t){return(Ki="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Zi(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ji(t,e){return!e||"object"!==Ki(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function $i(t){return($i=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function tn(t,e){return(tn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var en=function(t){function e(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=Ji(this,$i(e).call(this))).isDirty=!1,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&tn(t,e)}(e,Nt),function(t,e,i){e&&Zi(t.prototype,e),i&&Zi(t,i)}(e,[{key:"onAdded",value:function(){this.type=1,this.emitter=this.addChild(new ne),this.emitter.blendMode=yt.ADD,this.emitter.emitCount=new Ut(5),this.emitter.emitDelay=new Ut(0),this.emitter.emitInterval=new Ut(0),this.emitter.emitDuration=new Ut(1/0),this.emitter.emitNumRepeats=new Ut(1/0),this.emitter.textures=ft.default.getTextures("particle_ex*"),this.emitter.x=480,this.emitter.y=320,this.emitter.space=this,this.emitter.add(new Jt(.5)),this.emitter.add(new Zt(.3,.6)),this.emitter.add(new Qt(-600,-600,600,600)),this.emitter.add(new Kt(1,0))}},{key:"onUpdate",value:function(){if(this.emitter)if(re.isPointerDown){var t=this.globalToLocal(re.pointerPosition),e=this.isDirty?1:.2;this.emitter.x=v.lerp(this.emitter.x,t.x,e),this.emitter.y=v.lerp(this.emitter.y,t.y,e),this.isDirty=!1}else this.isDirty=!0,this.emitter.x=2e3}}]),e}();function nn(t){return(nn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function sn(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function rn(t,e){return!e||"object"!==nn(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function an(t){return(an=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function on(t,e){return(on=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var hn=function(t){function e(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(i=rn(this,an(e).call(this))).score=t,i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&on(t,e)}(e,G),function(t,e,i){e&&sn(t.prototype,e),i&&sn(t,i)}(e,[{key:"onAdded",value:function(){var t=new Gt("Fredoka One",15226454,40,Gt.FontStyle.NORMAL,Gt.FontWeight.BOLD,4,16776660),e=new zt;e.setDefaultStyle(t),e.autoSize=!0,e.align="center",e.text=this.score.toString(),e.alignPivotOffset(.5,.5),this.addChild(e),e.scale=0,e.add(new ue({scale:1},.2,{ease:he.backOut}),new ue({y:-40},.5,{ease:he.sinusoidalOut}),new ue({alpha:0},.3,{ease:he.sinusoidalIn,delay:.3}))}}]),e}();function ln(t){return(ln="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function un(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function cn(t,e){return!e||"object"!==ln(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function mn(t){return(mn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function dn(t,e){return(dn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var fn=function(t){function e(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=cn(this,mn(e).call(this))).textField=null,t.inProgress=!1,t.queue=[],t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&dn(t,e)}(e,G),function(t,e,i){e&&un(t.prototype,e),i&&un(t,i)}(e,[{key:"onAdded",value:function(){var t=new Gt("Fredoka One",15226454,100,Gt.FontStyle.NORMAL,Gt.FontWeight.BOLD,16,16776660);t.dropShadow=!0,t.shadowColor=0,t.shadowDistanceX=12,t.shadowDistanceY=12,t.shadowBlur=8,t.shadowAlpha=.5,this.textField=new zt,this.textField.setDefaultStyle(t),this.textField.autoSize=!0,this.textField.align="center",this.textField.x=this.width/2,this.textField.y=this.height/2+22,this.textField.multiline=!0,this.textField.lineHeight=2.5,this.textField.alignPivotOffset(.5,.5),this.textField.visible=!1,this.addChild(this.textField)}},{key:"setText",value:function(t){!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.textField.text=t,this.textField.alignPivotOffset(.5,.5)}},{key:"show",value:function(t){if(this.inProgress)this.queue.push(t);else{this.inProgress=!0,this.setText(t),this.textField.visible=!0,this.scale=3;var e=Math.random()>.5?1:-1;this.addComponent(new ue({scale:1},.2,{ease:he.backOut})),this.addComponent(new ue({rotation:[.1*e,0]},.2,{ease:he.sinusoidalInOut,delay:.2}));this.addComponent(new ue({scale:0},.15,{ease:he.backIn,delay:.65})).on("complete",this._onComplete,this)}}},{key:"_onComplete",value:function(){this.textField.visible=!1,this.inProgress=!1;var t=this.queue.pop();t?this.show(t):this.post("complete")}}]),e}();function yn(t){return(yn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function vn(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function pn(t,e){return!e||"object"!==yn(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function gn(t){return(gn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function kn(t,e){return(kn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var bn=function(t){function e(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=pn(this,gn(e).call(this))).touchable=!0,t.score=0,t.targetScore=500,t.tutorialVisible=!1,t.ctaInited=!1,t.hintOnIdleTime=6,t.lastActionTime=0,t.selectSounds=["select-1","select-2","select-3","select-4","select-5","select-6","select-7","select-8","select-9"],t.textPopupPraises=["Awesome","Good","Amazing","Impressive"],t.praiseOn=5,t.load(),t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&kn(t,e)}(e,G),function(t,e,i){e&&vn(t.prototype,e),i&&vn(t,i)}(e,[{key:"load",value:function(){var t=ft.default;t.enqueueImage("bg",i(0)),t.enqueueAtlas("assets",i(1),i(2)),t.enqueueGoogleFont("Fredoka One"),t.enqueueSound("background",i(3)),t.enqueueSound("itemKill",i(4)),t.enqueueSound("select-1",i(5)),t.enqueueSound("select-2",i(6)),t.enqueueSound("select-3",i(7)),t.enqueueSound("select-4",i(8)),t.enqueueSound("select-5",i(9)),t.enqueueSound("select-6",i(10)),t.enqueueSound("select-7",i(11)),t.enqueueSound("select-8",i(12)),t.enqueueSound("select-9",i(13)),t.on("complete",this.onAssetsLoadded,this),ei.instance.splashScreen.on(N.COMPLETE,function(e){t.loadQueue()})}},{key:"onAssetsLoadded",value:function(){var t=this;ce.play("background","master",1,!0),this.addChild(new oi("bg")),this.board=this.addChild(new Oi(this.stage.LP(7,6),this.stage.LP(5,8))),this.board.x=this.stage.centerX+15,this.board.y=this.stage.centerY+50,this.board.on("pointerDown",function(e){return t.hint.hide()},this),this.board.on("kill",this.onItemsKilled,this),this.board.on("selected",this.onItemSelected,this),this.board.on("allDeselected",this.onAllDeselected,this),this.fxTrail=this.addChild(new en),this.textTable=this.addChild(new Qi),this.selection=this.addChild(new Mt),this.textPopup=this.addChild(new fn),this.textPopup.x=this.stage.centerX,this.textPopup.y=this.stage.centerY,this.hint=this.addChild(new zi),this.stage.on("resize",this.onResize,this),this.onResize();this.textTable.y=-200;var e=new ue({y:5},.5,{delay:.5,ease:he.cubicOut});e.on("start",this.showHint,this),this.textTable.add(e)}},{key:"onItemsKilled",value:function(t,e){this.hint.hide(),ce.play("itemKill"),this.selection.clear(),this.addScore(this.getScore(e.length));for(var i=0;i<e.length;i++){var n=new hn(~~(this.getScore(e.length)/e.length)),s=e[i],r=s.parent.localToGlobal(new x(s.x-25,s.y-25));r=this.parent.globalToLocal(r),n.x=r.x,n.y=r.y,this.addChild(n)}e.length>=this.praiseOn&&this.textPopup.show(this.textPopupPraises[v.randomBetween(0,this.textPopupPraises.length-1)]),this.score>=this.targetScore&&this.showCTA()}},{key:"getScore",value:function(t){var e=1*(10*t+(10*t-30)*Math.sqrt(t));return~~(e/=2)}},{key:"addScore",value:function(t){this.score+=~~t,this.score>this.targetScore&&(this.score=this.targetScore),this.textTable.setScore("Score: ".concat(this.score,"/").concat(this.targetScore))}},{key:"onItemSelected",value:function(t,e,i){var n=i[0].x,s=i[0].y;this.selection.clear(),this.selection.beginPath(),this.selection.lineStyle(40,16777215,.7,Ht.ROUND,Ft.ROUND),this.selection.moveTo(n-25,s-25);for(var r=1;r<i.length;r++){var a=i[r];this.selection.lineTo(a.x-25,a.y-25)}this.selection.stroke();var o=this.selectSounds[Math.min(this.selectSounds.length-1,i.length-1)];ce.play(o)}},{key:"onAllDeselected",value:function(){this.selection.clear()}},{key:"showCTA",value:function(){var t=this;this.ctaInited||(this.ctaInited=!0,this.textPopup.show("WELL DONE"),this.textPopup.on("complete",function(){t.textTable.addComponent(new ue({y:t.textTable.y-200},.5,{delay:.5,ease:he.cubicOut})).on("complete",function(){return t.textTable.visible=!1}),t.fxTrail.visible=!1,setTimeout(function(){return t.board.hide()},300),setTimeout(function(){return t.addChild(new Bi)},700)}))}},{key:"onResize",value:function(){this.board.x=this.stage.centerX+15,this.board.y=this.stage.centerY+50,this.textPopup.x=this.stage.centerX,this.textPopup.y=this.stage.centerY,this.selection.x=this.board.x,this.selection.y=this.board.y,this.selection.pivotOffsetX=this.board.pivotX,this.selection.pivotOffsetY=this.board.pivotY,this.textTable.x=this.stage.centerX,this.textTable.y=-this.stage.y}},{key:"onUpdate",value:function(){re.isPointerDown?this.lastActionTime=H.now:this.hint&&H.now-this.lastActionTime>this.hintOnIdleTime&&!1===this.hint.inProgress&&this.board.isEnabled&&this.showHint()}},{key:"showHint",value:function(){var t=this.board.getMatchingClusters();if(t.length>0){var e=t.sort(function(t,e){return e.length-t.length})[0];this.hint.show(e)}}}]),e}();function wn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function xn(t,e,i){return e&&_n(t.prototype,e),i&&_n(t,i),t}var Cn=function(){function t(){var e=this;wn(this,t),this.beginTime=(performance||Date).now(),this.prevTime=this.beginTime,this.refreshRate=250,this.mCounters=[],this.mContainer=document.createElement("div"),this.mContainer.style.cssText="position:fixed; top:8px; left:8px; cursor:pointer; opacity:0.95; z-index:999; max-width: ".concat(t.BASE_WIDTH,"px"),this.mContainer.className="perf-monitor",document.body.appendChild(this.mContainer);for(var i=0;i<this.mCounters.length;i++){this.mCounters[i].prevTime=this.beginTime}requestAnimationFrame(function(t){e.update()})}return xn(t,[{key:"update",value:function(){var t=this;this.beginTime=this.__end(),requestAnimationFrame(function(e){t.update()})}},{key:"__begin",value:function(){this.beginTime=(performance||Date).now()}},{key:"__end",value:function(){for(var t=(performance||Date).now(),e=0;e<this.mCounters.length;e++){var i=this.mCounters[e];i.frames++,t>=i.prevTime+this.refreshRate&&(i.update(t,this.beginTime),i.prevTime=t,i.frames=0)}return t}},{key:"add",value:function(t){this.mContainer.appendChild(t.__dom),this.mCounters.push(t)}}]),t}();Cn.BASE_WIDTH=128,Cn.BASE_HEIGHT=48;var Sn=function(){function t(e){wn(this,t),this.name=e,this.min=1/0,this.max=0,this.prevTime=0,this.frames=0,this.mValue=0,this.maxValue=60,this.mCanvas=document.createElement("canvas"),this.mCanvas.width=t.WIDTH,this.mCanvas.height=t.HEIGHT,this.mCanvas.className="perf-counter",this.mCanvas.style.cssText="width:".concat(Cn.BASE_WIDTH,"px;height:").concat(Cn.BASE_HEIGHT,"px; box-shadow: 0px 4px 10px -3px rgba(0,0,0,0.75);"),this.mCtx=this.mCanvas.getContext("2d"),this.mCtx.font="bold "+9*t.DPR+"px Helvetica,Arial,sans-serif",this.mCtx.textBaseline="top",this.mCtx.fillStyle=t.BG,this.mCtx.globalAlpha=1,this.mCtx.fillRect(t.GRAPH_X,t.GRAPH_Y,t.GRAPH_WIDTH,t.GRAPH_HEIGHT)}return xn(t,[{key:"update",value:function(t,e,i){this.value=1e3*this.frames/(t-this.prevTime),this.draw()}},{key:"draw",value:function(){var e=this.value,i=this.maxValue;this.mCtx.fillStyle=t.BG,this.mCtx.globalAlpha=1,this.mCtx.fillRect(0,0,t.WIDTH,t.GRAPH_Y),this.mCtx.fillStyle=t.FG,this.mCtx.fillText(Math.round(e)+" "+this.name+" ("+Math.round(this.min)+"-"+Math.round(this.max)+")",t.TEXT_X,t.TEXT_Y),this.mCtx.drawImage(this.mCanvas,t.GRAPH_X+t.DPR,t.GRAPH_Y,t.GRAPH_WIDTH-t.DPR,t.GRAPH_HEIGHT,t.GRAPH_X,t.GRAPH_Y,t.GRAPH_WIDTH-t.DPR,t.GRAPH_HEIGHT),this.mCtx.fillRect(t.GRAPH_X+t.GRAPH_WIDTH-t.DPR,t.GRAPH_Y,t.DPR,t.GRAPH_HEIGHT),this.mCtx.fillStyle=t.BG,this.mCtx.globalAlpha=1,this.mCtx.fillRect(t.GRAPH_X+t.GRAPH_WIDTH-t.DPR,t.GRAPH_Y,t.DPR,Math.round((1-e/i)*t.GRAPH_HEIGHT))}},{key:"value",set:function(t){t>this.maxValue?this.mValue=this.maxValue:this.mValue=t,this.min=Math.min(this.min,this.mValue),this.max=Math.max(this.max,this.mValue)},get:function(){return this.mValue}},{key:"__dom",get:function(){return this.mCanvas}}]),t}();Sn.DPR=Math.round(window.devicePixelRatio||1),Sn.WIDTH=Cn.BASE_WIDTH*Sn.DPR,Sn.HEIGHT=Cn.BASE_HEIGHT*Sn.DPR,Sn.BG="black",Sn.FG="#f9b623",Sn.GRAPH_X=0,Sn.GRAPH_Y=15*Sn.DPR,Sn.GRAPH_WIDTH=Cn.BASE_WIDTH*Sn.DPR,Sn.GRAPH_HEIGHT=33*Sn.DPR,Sn.TEXT_X=3*Sn.DPR,Sn.TEXT_Y=2*Sn.DPR;var Tn=new ei("container",bn,Ot,[re,ce]);Tn.enableFixedTimeStep=!1,Tn.pauseOnBlur=!1,Tn.pauseOnHide=!1,Tn.start(),Tn.stage.scaleMode=Y.LETTERBOX,Tn.stage.setSize(960,640),Tn.stage.orientation=j.UNIVERSAL;var Pn=~~(1001*Math.random());Math.random=function(){var t=1e4*Math.sin(Pn++);return t-Math.floor(t)}}]);